!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function placeHoldersCount(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===b64[len-2]?2:"="===b64[len-1]?1:0}function byteLength(b64){return 3*b64.length/4-placeHoldersCount(b64)}function toByteArray(b64){var i,j,l,tmp,placeHolders,arr,len=b64.length;placeHolders=placeHoldersCount(b64),arr=new Arr(3*len/4-placeHolders),l=placeHolders>0?len-4:len;var L=0;for(i=0,j=0;i<l;i+=4,j+=3)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[L++]=tmp>>16&255,arr[L++]=tmp>>8&255,arr[L++]=255&tmp;return 2===placeHolders?(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[L++]=255&tmp):1===placeHolders&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[L++]=tmp>>8&255,arr[L++]=255&tmp),arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]}function encodeChunk(uint8,start,end){for(var tmp,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output.push(tripletToBase64(tmp));return output.join("")}function fromByteArray(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,output="",parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(encodeChunk(uint8,i,i+16383>len2?len2:i+16383));return 1===extraBytes?(tmp=uint8[len-1],output+=lookup[tmp>>2],output+=lookup[tmp<<4&63],output+="=="):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],output+=lookup[tmp>>10],output+=lookup[tmp>>4&63],output+=lookup[tmp<<2&63],output+="="),parts.push(output),parts.join("")}exports.byteLength=byteLength,exports.toByteArray=toByteArray,exports.fromByteArray=fromByteArray;for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},{}],2:[function(require,module,exports){},{}],3:[function(require,module,exports){"use strict";function createBuffer(length){if(length>K_MAX_LENGTH)throw new RangeError("Invalid typed array length");var buf=new Uint8Array(length);return buf.__proto__=Buffer.prototype,buf}function Buffer(arg,encodingOrOffset,length){if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}function from(value,encodingOrOffset,length){if("number"==typeof value)throw new TypeError('"value" argument must not be a number');return value instanceof ArrayBuffer?fromArrayBuffer(value,encodingOrOffset,length):"string"==typeof value?fromString(value,encodingOrOffset):fromObject(value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be a number');if(size<0)throw new RangeError('"size" argument must not be negative')}function alloc(size,fill,encoding){return assertSize(size),size<=0?createBuffer(size):void 0!==fill?"string"==typeof encoding?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill):createBuffer(size)}function allocUnsafe(size){return assertSize(size),createBuffer(size<0?0:0|checked(size))}function fromString(string,encoding){if("string"==typeof encoding&&""!==encoding||(encoding="utf8"),!Buffer.isEncoding(encoding))throw new TypeError('"encoding" must be a valid string encoding');var length=0|byteLength(string,encoding),buf=createBuffer(length),actual=buf.write(string,encoding);return actual!==length&&(buf=buf.slice(0,actual)),buf}function fromArrayLike(array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(length),i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError("'offset' is out of bounds");if(array.byteLength<byteOffset+(length||0))throw new RangeError("'length' is out of bounds");var buf;return buf=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length),buf.__proto__=Buffer.prototype,buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length),buf=createBuffer(len);return 0===buf.length?buf:(obj.copy(buf,0,0,len),buf)}if(obj){if(isArrayBufferView(obj)||"length"in obj)return"number"!=typeof obj.length||numberIsNaN(obj.length)?createBuffer(0):fromArrayLike(obj);if("Buffer"===obj.type&&Array.isArray(obj.data))return fromArrayLike(obj.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=K_MAX_LENGTH)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|length}function SlowBuffer(length){return+length!=length&&(length=0),Buffer.alloc(+length)}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(isArrayBufferView(string)||string instanceof ArrayBuffer)return string.byteLength;"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case void 0:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if(end>>>=0,start>>>=0,end<=start)return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),byteOffset=+byteOffset,numberIsNaN(byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}var indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length))>remaining&&(length=remaining):length=remaining;var strLen=string.length;if(strLen%2!=0)throw new TypeError("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&(tempCodePoint=(31&firstByte)<<6|63&secondByte)>127&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return decodeCodePointsArray(res)}function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);for(var res="",i=0;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);for(var out="",i=start;i<end;++i)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){if((str=str.trim().replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str}function toHex(n){return n<16?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if((codePoint=string.charCodeAt(i))>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)hi=(c=str.charCodeAt(i))>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isArrayBufferView(obj){return"function"==typeof ArrayBuffer.isView&&ArrayBuffer.isView(obj)}function numberIsNaN(obj){return obj!==obj}var base64=require("base64-js"),ieee754=require("ieee754");exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH,Buffer.TYPED_ARRAY_SUPPORT=function(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()}catch(e){return!1}}(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)},Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)},Buffer.isBuffer=function(b){return null!=b&&!0===b._isBuffer},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function(){var length=this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target))throw new TypeError("Argument must be a Buffer");if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(start>>>=0,end>>>=0,thisStart>>>=0,thisEnd>>>=0,this===target)return 0;for(var x=thisEnd-thisStart,y=end-start,len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset>>>=0,isFinite(length)?(length>>>=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,start<0?(start+=len)<0&&(start=0):start>len&&(start=len),end<0?(end+=len)<0&&(end=0):end>len&&(end=len),end<start&&(end=start);var newBuf=this.subarray(start,end);return newBuf.__proto__=Buffer.prototype,newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,byteLength>>>=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,byteLength>>>=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value,offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24,offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var i,len=end-start;if(this===target&&start<targetStart&&targetStart<end)for(i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else if(len<1e3)for(i=0;i<len;++i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),1===val.length){var code=val.charCodeAt(0);code<256&&(val=code)}if(void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding)}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0);var i;if("number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:new Buffer(val,encoding),len=bytes.length;for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g},{"base64-js":1,ieee754:6}],4:[function(require,module,exports){(function(Buffer){function isArray(arg){return Array.isArray?Array.isArray(arg):"[object Array]"===objectToString(arg)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return"[object Date]"===objectToString(d)}function isError(e){return"[object Error]"===objectToString(e)||e instanceof Error}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||void 0===arg}function objectToString(o){return Object.prototype.toString.call(o)}exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=Buffer.isBuffer}).call(this,{isBuffer:require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":8}],5:[function(require,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((er=arguments[1])instanceof Error)throw er;var err=new Error('Uncaught, unspecified "error" event. ('+er+")");throw err.context=er,err}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1),handler.apply(this,args)}else if(isObject(handler))for(args=Array.prototype.slice.call(arguments,1),len=(listeners=handler.slice()).length,i=0;i<len;i++)listeners[i].apply(this,args);return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned&&(m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners)&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace()),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-- >0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(position<0)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else if(listeners)for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){return this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;if(evlistener)return evlistener.length}return 0},EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)}},{}],6:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],7:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],8:[function(require,module,exports){function isBuffer(obj){return!!obj.constructor&&"function"==typeof obj.constructor.isBuffer&&obj.constructor.isBuffer(obj)}function isSlowBuffer(obj){return"function"==typeof obj.readFloatLE&&"function"==typeof obj.slice&&isBuffer(obj.slice(0,0))}module.exports=function(obj){return null!=obj&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer)}},{}],9:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},{}],10:[function(require,module,exports){(function(process){"use strict";function nextTick(fn,arg1,arg2,arg3){if("function"!=typeof fn)throw new TypeError('"callback" argument must be a function');var args,i,len=arguments.length;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function(){fn.call(null,arg1)});case 3:return process.nextTick(function(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function(){fn.call(null,arg1,arg2,arg3)});default:for(args=new Array(len-1),i=0;i<args.length;)args[i++]=arguments[i];return process.nextTick(function(){fn.apply(null,args)})}}!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?module.exports=nextTick:module.exports=process.nextTick}).call(this,require("_process"))},{_process:11}],11:[function(require,module,exports){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,runClearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var cachedSetTimeout,cachedClearTimeout,process=module.exports={};!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],12:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":13}],13:[function(require,module,exports){"use strict";function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options),Writable.call(this,options),options&&!1===options.readable&&(this.readable=!1),options&&!1===options.writable&&(this.writable=!1),this.allowHalfOpen=!0,options&&!1===options.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||processNextTick(onEndNT,this)}function onEndNT(self){self.end()}var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};module.exports=Duplex;var processNextTick=require("process-nextick-args"),util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable"),Writable=require("./_stream_writable");util.inherits(Duplex,Readable);for(var keys=objectKeys(Writable.prototype),v=0;v<keys.length;v++){var method=keys[v];Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])}},{"./_stream_readable":15,"./_stream_writable":17,"core-util-is":4,inherits:7,"process-nextick-args":10}],14:[function(require,module,exports){"use strict";function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}module.exports=PassThrough;var Transform=require("./_stream_transform"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(PassThrough,Transform),PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":16,"core-util-is":4,inherits:7}],15:[function(require,module,exports){(function(process){"use strict";function prependListener(emitter,event,fn){if("function"==typeof emitter.prependListener)return emitter.prependListener(event,fn);emitter._events&&emitter._events[event]?isArray(emitter._events[event])?emitter._events[event].unshift(fn):emitter._events[event]=[fn,emitter._events[event]]:emitter.on(event,fn)}function ReadableState(options,stream){Duplex=Duplex||require("./_stream_duplex"),options=options||{},this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.readableObjectMode);var hwm=options.highWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=~~this.highWaterMark,this.buffer=new BufferList,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=options.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,options.encoding&&(StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this.decoder=new StringDecoder(options.encoding),this.encoding=options.encoding)}function Readable(options){if(Duplex=Duplex||require("./_stream_duplex"),!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this),this.readable=!0,options&&"function"==typeof options.read&&(this._read=options.read),Stream.call(this)}function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er)stream.emit("error",er);else if(null===chunk)state.reading=!1,onEofChunk(stream,state);else if(state.objectMode||chunk&&chunk.length>0)if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var _e=new Error("stream.unshift() after end event");stream.emit("error",_e)}else{var skipAdd;!state.decoder||addToFront||encoding||(chunk=state.decoder.write(chunk),skipAdd=!state.objectMode&&0===chunk.length),addToFront||(state.reading=!1),skipAdd||(state.flowing&&0===state.length&&!state.sync?(stream.emit("data",chunk),stream.read(0)):(state.length+=state.objectMode?1:chunk.length,addToFront?state.buffer.unshift(chunk):state.buffer.push(chunk),state.needReadable&&emitReadable(stream))),maybeReadMore(stream,state)}else addToFront||(state.reading=!1);return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||0===state.length)}function computeNewHighWaterMark(n){return n>=MAX_HWM?n=MAX_HWM:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n}function howMuchToRead(n,state){return n<=0||0===state.length&&state.ended?0:state.objectMode?1:n!==n?state.flowing&&state.length?state.buffer.head.data.length:state.length:(n>state.highWaterMark&&(state.highWaterMark=computeNewHighWaterMark(n)),n<=state.length?n:state.ended?state.length:(state.needReadable=!0,0))}function chunkInvalid(state,chunk){var er=null;return Buffer.isBuffer(chunk)||"string"==typeof chunk||null===chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk")),er}function onEofChunk(stream,state){if(!state.ended){if(state.decoder){var chunk=state.decoder.end();chunk&&chunk.length&&(state.buffer.push(chunk),state.length+=state.objectMode?1:chunk.length)}state.ended=!0,emitReadable(stream)}}function emitReadable(stream){var state=stream._readableState;state.needReadable=!1,state.emittedReadable||(debug("emitReadable",state.flowing),state.emittedReadable=!0,state.sync?processNextTick(emitReadable_,stream):emitReadable_(stream))}function emitReadable_(stream){debug("emit readable"),stream.emit("readable"),flow(stream)}function maybeReadMore(stream,state){state.readingMore||(state.readingMore=!0,processNextTick(maybeReadMore_,stream,state))}function maybeReadMore_(stream,state){for(var len=state.length;!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark&&(debug("maybeReadMore read 0"),stream.read(0),len!==state.length);)len=state.length;state.readingMore=!1}function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain),state.awaitDrain&&state.awaitDrain--,0===state.awaitDrain&&EElistenerCount(src,"data")&&(state.flowing=!0,flow(src))}}function nReadingNextTick(self){debug("readable nexttick read 0"),self.read(0)}function resume(stream,state){state.resumeScheduled||(state.resumeScheduled=!0,processNextTick(resume_,stream,state))}function resume_(stream,state){state.reading||(debug("resume read 0"),stream.read(0)),state.resumeScheduled=!1,state.awaitDrain=0,stream.emit("resume"),flow(stream),state.flowing&&!state.reading&&stream.read(0)}function flow(stream){var state=stream._readableState;for(debug("flow",state.flowing);state.flowing&&null!==stream.read(););}function fromList(n,state){if(0===state.length)return null;var ret;return state.objectMode?ret=state.buffer.shift():!n||n>=state.length?(ret=state.decoder?state.buffer.join(""):1===state.buffer.length?state.buffer.head.data:state.buffer.concat(state.length),state.buffer.clear()):ret=fromListPartial(n,state.buffer,state.decoder),ret}function fromListPartial(n,list,hasStrings){var ret;return n<list.head.data.length?(ret=list.head.data.slice(0,n),list.head.data=list.head.data.slice(n)):ret=n===list.head.data.length?list.shift():hasStrings?copyFromBufferString(n,list):copyFromBuffer(n,list),ret}function copyFromBufferString(n,list){var p=list.head,c=1,ret=p.data;for(n-=ret.length;p=p.next;){var str=p.data,nb=n>str.length?str.length:n;if(nb===str.length?ret+=str:ret+=str.slice(0,n),0===(n-=nb)){nb===str.length?(++c,p.next?list.head=p.next:list.head=list.tail=null):(list.head=p,p.data=str.slice(nb));break}++c}return list.length-=c,ret}function copyFromBuffer(n,list){var ret=Buffer.allocUnsafe(n),p=list.head,c=1;for(p.data.copy(ret),n-=p.data.length;p=p.next;){var buf=p.data,nb=n>buf.length?buf.length:n;if(buf.copy(ret,ret.length-n,0,nb),0===(n-=nb)){nb===buf.length?(++c,p.next?list.head=p.next:list.head=list.tail=null):(list.head=p,p.data=buf.slice(nb));break}++c}return list.length-=c,ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');state.endEmitted||(state.ended=!0,processNextTick(endReadableNT,state,stream))}function endReadableNT(state,stream){state.endEmitted||0!==state.length||(state.endEmitted=!0,stream.readable=!1,stream.emit("end"))}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++)if(xs[i]===x)return i;return-1}module.exports=Readable;var Duplex,processNextTick=require("process-nextick-args"),isArray=require("isarray");Readable.ReadableState=ReadableState;require("events").EventEmitter;var EElistenerCount=function(emitter,type){return emitter.listeners(type).length},Stream=require("./internal/streams/stream"),Buffer=require("safe-buffer").Buffer,util=require("core-util-is");util.inherits=require("inherits");var debugUtil=require("util"),debug=void 0;debug=debugUtil&&debugUtil.debuglog?debugUtil.debuglog("stream"):function(){};var StringDecoder,BufferList=require("./internal/streams/BufferList");util.inherits(Readable,Stream);var kProxyEvents=["error","close","destroy","pause","resume"];Readable.prototype.push=function(chunk,encoding){var state=this._readableState;return state.objectMode||"string"!=typeof chunk||(encoding=encoding||state.defaultEncoding)!==state.encoding&&(chunk=Buffer.from(chunk,encoding),encoding=""),readableAddChunk(this,state,chunk,encoding,!1)},Readable.prototype.unshift=function(chunk){return readableAddChunk(this,this._readableState,chunk,"",!0)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(enc){return StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this._readableState.decoder=new StringDecoder(enc),this._readableState.encoding=enc,this};var MAX_HWM=8388608;Readable.prototype.read=function(n){debug("read",n),n=parseInt(n,10);var state=this._readableState,nOrig=n;if(0!==n&&(state.emittedReadable=!1),0===n&&state.needReadable&&(state.length>=state.highWaterMark||state.ended))return debug("read: emitReadable",state.length,state.ended),0===state.length&&state.ended?endReadable(this):emitReadable(this),null;if(0===(n=howMuchToRead(n,state))&&state.ended)return 0===state.length&&endReadable(this),null;var doRead=state.needReadable;debug("need readable",doRead),(0===state.length||state.length-n<state.highWaterMark)&&debug("length less than watermark",doRead=!0),state.ended||state.reading?debug("reading or ended",doRead=!1):doRead&&(debug("do read"),state.reading=!0,state.sync=!0,0===state.length&&(state.needReadable=!0),this._read(state.highWaterMark),state.sync=!1,state.reading||(n=howMuchToRead(nOrig,state)));var ret;return ret=n>0?fromList(n,state):null,null===ret?(state.needReadable=!0,n=0):state.length-=n,0===state.length&&(state.ended||(state.needReadable=!0),nOrig!==n&&state.ended&&endReadable(this)),null!==ret&&this.emit("data",ret),ret},Readable.prototype._read=function(n){this.emit("error",new Error("_read() is not implemented"))},Readable.prototype.pipe=function(dest,pipeOpts){function onunpipe(readable){debug("onunpipe"),readable===src&&cleanup()}function onend(){debug("onend"),dest.end()}function cleanup(){debug("cleanup"),dest.removeListener("close",onclose),dest.removeListener("finish",onfinish),dest.removeListener("drain",ondrain),dest.removeListener("error",onerror),dest.removeListener("unpipe",onunpipe),src.removeListener("end",onend),src.removeListener("end",unpipe),src.removeListener("data",ondata),cleanedUp=!0,!state.awaitDrain||dest._writableState&&!dest._writableState.needDrain||ondrain()}function ondata(chunk){debug("ondata"),increasedAwaitDrain=!1,!1!==dest.write(chunk)||increasedAwaitDrain||((1===state.pipesCount&&state.pipes===dest||state.pipesCount>1&&-1!==indexOf(state.pipes,dest))&&!cleanedUp&&(debug("false write response, pause",src._readableState.awaitDrain),src._readableState.awaitDrain++,increasedAwaitDrain=!0),src.pause())}function onerror(er){debug("onerror",er),unpipe(),dest.removeListener("error",onerror),0===EElistenerCount(dest,"error")&&dest.emit("error",er)}function onclose(){dest.removeListener("finish",onfinish),unpipe()}function onfinish(){debug("onfinish"),dest.removeListener("close",onclose),unpipe()}function unpipe(){debug("unpipe"),src.unpipe(dest)}var src=this,state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest)}state.pipesCount+=1,debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var endFn=(!pipeOpts||!1!==pipeOpts.end)&&dest!==process.stdout&&dest!==process.stderr?onend:unpipe;state.endEmitted?processNextTick(endFn):src.once("end",endFn),dest.on("unpipe",onunpipe);var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);var cleanedUp=!1,increasedAwaitDrain=!1;return src.on("data",ondata),prependListener(dest,"error",onerror),dest.once("close",onclose),dest.once("finish",onfinish),dest.emit("pipe",src),state.flowing||(debug("pipe resume"),src.resume()),dest},Readable.prototype.unpipe=function(dest){var state=this._readableState;if(0===state.pipesCount)return this;if(1===state.pipesCount)return dest&&dest!==state.pipes?this:(dest||(dest=state.pipes),state.pipes=null,state.pipesCount=0,state.flowing=!1,dest&&dest.emit("unpipe",this),this);if(!dest){var dests=state.pipes,len=state.pipesCount;state.pipes=null,state.pipesCount=0,state.flowing=!1;for(var i=0;i<len;i++)dests[i].emit("unpipe",this);return this}var index=indexOf(state.pipes,dest);return-1===index?this:(state.pipes.splice(index,1),state.pipesCount-=1,1===state.pipesCount&&(state.pipes=state.pipes[0]),dest.emit("unpipe",this),this)},Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if("data"===ev)!1!==this._readableState.flowing&&this.resume();else if("readable"===ev){var state=this._readableState;state.endEmitted||state.readableListening||(state.readableListening=state.needReadable=!0,state.emittedReadable=!1,state.reading?state.length&&emitReadable(this):processNextTick(nReadingNextTick,this))}return res},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var state=this._readableState;return state.flowing||(debug("resume"),state.flowing=!0,resume(this,state)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(stream){var state=this._readableState,paused=!1,self=this;stream.on("end",function(){if(debug("wrapped end"),state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&self.push(chunk)}self.push(null)}),stream.on("data",function(chunk){debug("wrapped data"),state.decoder&&(chunk=state.decoder.write(chunk)),(!state.objectMode||null!==chunk&&void 0!==chunk)&&(state.objectMode||chunk&&chunk.length)&&(self.push(chunk)||(paused=!0,stream.pause()))});for(var i in stream)void 0===this[i]&&"function"==typeof stream[i]&&(this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i));for(var n=0;n<kProxyEvents.length;n++)stream.on(kProxyEvents[n],self.emit.bind(self,kProxyEvents[n]));return self._read=function(n){debug("wrapped _read",n),paused&&(paused=!1,stream.resume())},self},Readable._fromList=fromList}).call(this,require("_process"))},{"./_stream_duplex":13,"./internal/streams/BufferList":18,"./internal/streams/stream":19,_process:11,"core-util-is":4,events:5,inherits:7,isarray:9,"process-nextick-args":10,"safe-buffer":24,"string_decoder/":26,util:2}],16:[function(require,module,exports){"use strict";function TransformState(stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null,ts.writecb=null,null!==data&&void 0!==data&&stream.push(data),cb(er);var rs=stream._readableState;rs.reading=!1,(rs.needReadable||rs.length<rs.highWaterMark)&&stream._read(rs.highWaterMark)}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options),this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=!0,this._readableState.sync=!1,options&&("function"==typeof options.transform&&(this._transform=options.transform),"function"==typeof options.flush&&(this._flush=options.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(er,data){done(stream,er,data)}):done(stream)})}function done(stream,er,data){if(er)return stream.emit("error",er);null!==data&&void 0!==data&&stream.push(data);var ws=stream._writableState,ts=stream._transformState;if(ws.length)throw new Error("Calling transform done when ws.length != 0");if(ts.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}module.exports=Transform;var Duplex=require("./_stream_duplex"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(Transform,Duplex),Transform.prototype.push=function(chunk,encoding){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,chunk,encoding)},Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("_transform() is not implemented")},Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;if(ts.writecb=cb,ts.writechunk=chunk,ts.writeencoding=encoding,!ts.transforming){var rs=this._readableState;(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}},Transform.prototype._read=function(n){var ts=this._transformState;null!==ts.writechunk&&ts.writecb&&!ts.transforming?(ts.transforming=!0,this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)):ts.needTransform=!0}},{"./_stream_duplex":13,"core-util-is":4,inherits:7}],17:[function(require,module,exports){(function(process){"use strict";function nop(){}function WriteReq(chunk,encoding,cb){this.chunk=chunk,this.encoding=encoding,this.callback=cb,this.next=null}function WritableState(options,stream){Duplex=Duplex||require("./_stream_duplex"),options=options||{},this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.writableObjectMode);var hwm=options.highWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var noDecode=!1===options.decodeStrings;this.decodeStrings=!noDecode,this.defaultEncoding=options.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(er){onwrite(stream,er)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(options){if(Duplex=Duplex||require("./_stream_duplex"),!(realHasInstance.call(Writable,this)||this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this),this.writable=!0,options&&("function"==typeof options.write&&(this._write=options.write),"function"==typeof options.writev&&(this._writev=options.writev)),Stream.call(this)}function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er),processNextTick(cb,er)}function validChunk(stream,state,chunk,cb){var valid=!0,er=!1;return null===chunk?er=new TypeError("May not write null values to stream"):"string"==typeof chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk")),er&&(stream.emit("error",er),processNextTick(cb,er),valid=!1),valid}function decodeChunk(state,chunk,encoding){return state.objectMode||!1===state.decodeStrings||"string"!=typeof chunk||(chunk=Buffer.from(chunk,encoding)),chunk}function writeOrBuffer(stream,state,isBuf,chunk,encoding,cb){isBuf||(chunk=decodeChunk(state,chunk,encoding),Buffer.isBuffer(chunk)&&(encoding="buffer"));var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(ret||(state.needDrain=!0),state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest=new WriteReq(chunk,encoding,cb),last?last.next=state.lastBufferedRequest:state.bufferedRequest=state.lastBufferedRequest,state.bufferedRequestCount+=1}else doWrite(stream,state,!1,len,chunk,encoding,cb);return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len,state.writecb=cb,state.writing=!0,state.sync=!0,writev?stream._writev(chunk,state.onwrite):stream._write(chunk,encoding,state.onwrite),state.sync=!1}function onwriteError(stream,state,sync,er,cb){--state.pendingcb,sync?processNextTick(cb,er):cb(er),stream._writableState.errorEmitted=!0,stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=!1,state.writecb=null,state.length-=state.writelen,state.writelen=0}function onwrite(stream,er){var state=stream._writableState,sync=state.sync,cb=state.writecb;if(onwriteStateUpdate(state),er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);finished||state.corked||state.bufferProcessing||!state.bufferedRequest||clearBuffer(stream,state),sync?asyncWrite(afterWrite,stream,state,finished,cb):afterWrite(stream,state,finished,cb)}}function afterWrite(stream,state,finished,cb){finished||onwriteDrain(stream,state),state.pendingcb--,cb(),finishMaybe(stream,state)}function onwriteDrain(stream,state){0===state.length&&state.needDrain&&(state.needDrain=!1,stream.emit("drain"))}function clearBuffer(stream,state){state.bufferProcessing=!0;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount,buffer=new Array(l),holder=state.corkedRequestsFree;holder.entry=entry;for(var count=0;entry;)buffer[count]=entry,entry=entry.next,count+=1;doWrite(stream,state,!0,state.length,buffer,"",holder.finish),state.pendingcb++,state.lastBufferedRequest=null,holder.next?(state.corkedRequestsFree=holder.next,holder.next=null):state.corkedRequestsFree=new CorkedRequest(state)}else{for(;entry;){var chunk=entry.chunk,encoding=entry.encoding,cb=entry.callback;if(doWrite(stream,state,!1,state.objectMode?1:chunk.length,chunk,encoding,cb),entry=entry.next,state.writing)break}null===entry&&(state.lastBufferedRequest=null)}state.bufferedRequestCount=0,state.bufferedRequest=entry,state.bufferProcessing=!1}function needFinish(state){return state.ending&&0===state.length&&null===state.bufferedRequest&&!state.finished&&!state.writing}function prefinish(stream,state){state.prefinished||(state.prefinished=!0,stream.emit("prefinish"))}function finishMaybe(stream,state){var need=needFinish(state);return need&&(0===state.pendingcb?(prefinish(stream,state),state.finished=!0,stream.emit("finish")):prefinish(stream,state)),need}function endWritable(stream,state,cb){state.ending=!0,finishMaybe(stream,state),cb&&(state.finished?processNextTick(cb):stream.once("finish",cb)),state.ended=!0,stream.writable=!1}function CorkedRequest(state){var _this=this;this.next=null,this.entry=null,this.finish=function(err){var entry=_this.entry;for(_this.entry=null;entry;){var cb=entry.callback;state.pendingcb--,cb(err),entry=entry.next}state.corkedRequestsFree?state.corkedRequestsFree.next=_this:state.corkedRequestsFree=_this}}module.exports=Writable;var Duplex,processNextTick=require("process-nextick-args"),asyncWrite=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:processNextTick;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var internalUtil={deprecate:require("util-deprecate")},Stream=require("./internal/streams/stream"),Buffer=require("safe-buffer").Buffer;util.inherits(Writable,Stream),WritableState.prototype.getBuffer=function(){for(var current=this.bufferedRequest,out=[];current;)out.push(current),current=current.next;return out},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(_){}}();var realHasInstance;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(realHasInstance=Function.prototype[Symbol.hasInstance],Object.defineProperty(Writable,Symbol.hasInstance,{value:function(object){return!!realHasInstance.call(this,object)||object&&object._writableState instanceof WritableState}})):realHasInstance=function(object){return object instanceof this},Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState,ret=!1,isBuf=Buffer.isBuffer(chunk);return"function"==typeof encoding&&(cb=encoding,encoding=null),isBuf?encoding="buffer":encoding||(encoding=state.defaultEncoding),"function"!=typeof cb&&(cb=nop),state.ended?writeAfterEnd(this,cb):(isBuf||validChunk(this,state,chunk,cb))&&(state.pendingcb++,ret=writeOrBuffer(this,state,isBuf,chunk,encoding,cb)),ret},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var state=this._writableState;state.corked&&(state.corked--,state.writing||state.corked||state.finished||state.bufferProcessing||!state.bufferedRequest||clearBuffer(this,state))},Writable.prototype.setDefaultEncoding=function(encoding){if("string"==typeof encoding&&(encoding=encoding.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);return this._writableState.defaultEncoding=encoding,this},Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("_write() is not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;"function"==typeof chunk?(cb=chunk,chunk=null,encoding=null):"function"==typeof encoding&&(cb=encoding,encoding=null),null!==chunk&&void 0!==chunk&&this.write(chunk,encoding),state.corked&&(state.corked=1,this.uncork()),state.ending||state.finished||endWritable(this,state,cb)}}).call(this,require("_process"))},{"./_stream_duplex":13,"./internal/streams/stream":19,_process:11,"core-util-is":4,inherits:7,"process-nextick-args":10,"safe-buffer":24,"util-deprecate":27}],18:[function(require,module,exports){"use strict";function BufferList(){this.head=null,this.tail=null,this.length=0}var Buffer=require("safe-buffer").Buffer;module.exports=BufferList,BufferList.prototype.push=function(v){var entry={data:v,next:null};this.length>0?this.tail.next=entry:this.head=entry,this.tail=entry,++this.length},BufferList.prototype.unshift=function(v){var entry={data:v,next:this.head};0===this.length&&(this.tail=entry),this.head=entry,++this.length},BufferList.prototype.shift=function(){if(0!==this.length){var ret=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,ret}},BufferList.prototype.clear=function(){this.head=this.tail=null,this.length=0},BufferList.prototype.join=function(s){if(0===this.length)return"";for(var p=this.head,ret=""+p.data;p=p.next;)ret+=s+p.data;return ret},BufferList.prototype.concat=function(n){if(0===this.length)return Buffer.alloc(0);if(1===this.length)return this.head.data;for(var ret=Buffer.allocUnsafe(n>>>0),p=this.head,i=0;p;)p.data.copy(ret,i),i+=p.data.length,p=p.next;return ret}},{"safe-buffer":24}],19:[function(require,module,exports){module.exports=require("events").EventEmitter},{events:5}],20:[function(require,module,exports){module.exports=require("./readable").PassThrough},{"./readable":21}],21:[function(require,module,exports){(exports=module.exports=require("./lib/_stream_readable.js")).Stream=exports,exports.Readable=exports,exports.Writable=require("./lib/_stream_writable.js"),exports.Duplex=require("./lib/_stream_duplex.js"),exports.Transform=require("./lib/_stream_transform.js"),exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":13,"./lib/_stream_passthrough.js":14,"./lib/_stream_readable.js":15,"./lib/_stream_transform.js":16,"./lib/_stream_writable.js":17}],22:[function(require,module,exports){module.exports=require("./readable").Transform},{"./readable":21}],23:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":17}],24:[function(require,module,exports){module.exports=require("buffer")},{buffer:3}],25:[function(require,module,exports){function Stream(){EE.call(this)}module.exports=Stream;var EE=require("events").EventEmitter;require("inherits")(Stream,EE),Stream.Readable=require("readable-stream/readable.js"),Stream.Writable=require("readable-stream/writable.js"),Stream.Duplex=require("readable-stream/duplex.js"),Stream.Transform=require("readable-stream/transform.js"),Stream.PassThrough=require("readable-stream/passthrough.js"),Stream.Stream=Stream,Stream.prototype.pipe=function(dest,options){function ondata(chunk){dest.writable&&!1===dest.write(chunk)&&source.pause&&source.pause()}function ondrain(){source.readable&&source.resume&&source.resume()}function onend(){didOnEnd||(didOnEnd=!0,dest.end())}function onclose(){didOnEnd||(didOnEnd=!0,"function"==typeof dest.destroy&&dest.destroy())}function onerror(er){if(cleanup(),0===EE.listenerCount(this,"error"))throw er}function cleanup(){source.removeListener("data",ondata),dest.removeListener("drain",ondrain),source.removeListener("end",onend),source.removeListener("close",onclose),source.removeListener("error",onerror),dest.removeListener("error",onerror),source.removeListener("end",cleanup),source.removeListener("close",cleanup),dest.removeListener("close",cleanup)}var source=this;source.on("data",ondata),dest.on("drain",ondrain),dest._isStdio||options&&!1===options.end||(source.on("end",onend),source.on("close",onclose));var didOnEnd=!1;return source.on("error",onerror),dest.on("error",onerror),source.on("end",cleanup),source.on("close",cleanup),dest.on("close",cleanup),dest.emit("pipe",source),dest}},{events:5,inherits:7,"readable-stream/duplex.js":12,"readable-stream/passthrough.js":20,"readable-stream/readable.js":21,"readable-stream/transform.js":22,"readable-stream/writable.js":23}],26:[function(require,module,exports){"use strict";function _normalizeEncoding(enc){if(!enc)return"utf8";for(var retried;;)switch(enc){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return enc;default:if(retried)return;enc=(""+enc).toLowerCase(),retried=!0}}function normalizeEncoding(enc){var nenc=_normalizeEncoding(enc);if("string"!=typeof nenc&&(Buffer.isEncoding===isEncoding||!isEncoding(enc)))throw new Error("Unknown encoding: "+enc);return nenc||enc}function StringDecoder(encoding){this.encoding=normalizeEncoding(encoding);var nb;switch(this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,nb=4;break;case"utf8":this.fillLast=utf8FillLast,nb=4;break;case"base64":this.text=base64Text,this.end=base64End,nb=3;break;default:return this.write=simpleWrite,void(this.end=simpleEnd)}this.lastNeed=0,this.lastTotal=0,this.lastChar=Buffer.allocUnsafe(nb)}function utf8CheckByte(byte){return byte<=127?0:byte>>5==6?2:byte>>4==14?3:byte>>3==30?4:-1}function utf8CheckIncomplete(self,buf,i){var j=buf.length-1;if(j<i)return 0;var nb=utf8CheckByte(buf[j]);return nb>=0?(nb>0&&(self.lastNeed=nb-1),nb):--j<i?0:(nb=utf8CheckByte(buf[j]))>=0?(nb>0&&(self.lastNeed=nb-2),nb):--j<i?0:(nb=utf8CheckByte(buf[j]),nb>=0?(nb>0&&(2===nb?nb=0:self.lastNeed=nb-3),nb):0)}function utf8CheckExtraBytes(self,buf,p){if(128!=(192&buf[0]))return self.lastNeed=0,"".repeat(p);if(self.lastNeed>1&&buf.length>1){if(128!=(192&buf[1]))return self.lastNeed=1,"".repeat(p+1);if(self.lastNeed>2&&buf.length>2&&128!=(192&buf[2]))return self.lastNeed=2,"".repeat(p+2)}}function utf8FillLast(buf){var p=this.lastTotal-this.lastNeed,r=utf8CheckExtraBytes(this,buf,p);return void 0!==r?r:this.lastNeed<=buf.length?(buf.copy(this.lastChar,p,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(buf.copy(this.lastChar,p,0,buf.length),void(this.lastNeed-=buf.length))}function utf8Text(buf,i){var total=utf8CheckIncomplete(this,buf,i);if(!this.lastNeed)return buf.toString("utf8",i);this.lastTotal=total;var end=buf.length-(total-this.lastNeed);return buf.copy(this.lastChar,0,end),buf.toString("utf8",i,end)}function utf8End(buf){var r=buf&&buf.length?this.write(buf):"";return this.lastNeed?r+"".repeat(this.lastTotal-this.lastNeed):r}function utf16Text(buf,i){if((buf.length-i)%2==0){var r=buf.toString("utf16le",i);if(r){var c=r.charCodeAt(r.length-1);if(c>=55296&&c<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=buf[buf.length-2],this.lastChar[1]=buf[buf.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=buf[buf.length-1],buf.toString("utf16le",i,buf.length-1)}function utf16End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed){var end=this.lastTotal-this.lastNeed;return r+this.lastChar.toString("utf16le",0,end)}return r}function base64Text(buf,i){var n=(buf.length-i)%3;return 0===n?buf.toString("base64",i):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=buf[buf.length-1]:(this.lastChar[0]=buf[buf.length-2],this.lastChar[1]=buf[buf.length-1]),buf.toString("base64",i,buf.length-n))}function base64End(buf){var r=buf&&buf.length?this.write(buf):"";return this.lastNeed?r+this.lastChar.toString("base64",0,3-this.lastNeed):r}function simpleWrite(buf){return buf.toString(this.encoding)}function simpleEnd(buf){return buf&&buf.length?this.write(buf):""}var Buffer=require("safe-buffer").Buffer,isEncoding=Buffer.isEncoding||function(encoding){switch((encoding=""+encoding)&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};exports.StringDecoder=StringDecoder,StringDecoder.prototype.write=function(buf){if(0===buf.length)return"";var r,i;if(this.lastNeed){if(void 0===(r=this.fillLast(buf)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<buf.length?r?r+this.text(buf,i):this.text(buf,i):r||""},StringDecoder.prototype.end=utf8End,StringDecoder.prototype.text=utf8Text,StringDecoder.prototype.fillLast=function(buf){if(this.lastNeed<=buf.length)return buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,buf.length),this.lastNeed-=buf.length}},{"safe-buffer":24}],27:[function(require,module,exports){(function(global){function deprecate(fn,msg){function deprecated(){if(!warned){if(config("throwDeprecation"))throw new Error(msg);config("traceDeprecation")?console.trace(msg):console.warn(msg),warned=!0}return fn.apply(this,arguments)}if(config("noDeprecation"))return fn;var warned=!1;return deprecated}function config(name){try{if(!global.localStorage)return!1}catch(_){return!1}var val=global.localStorage[name];return null!=val&&"true"===String(val).toLowerCase()}module.exports=deprecate}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],28:[function(require,module,exports){var jsgui=require("../html/html"),Resource_Pool=require("../resource/pool");jsgui.stringify,jsgui.each,jsgui.arrayify,jsgui.tof,jsgui.filter_map_by_regex,jsgui.Class,jsgui.Data_Object,jsgui.fp,jsgui.is_defined,jsgui.Collection,String;class Client_Resource_Pool extends Resource_Pool{constructor(spec){super(spec)}start(callback){callback(null,!0)}}module.exports=Client_Resource_Pool},{"../html/html":85,"../resource/pool":102}],29:[function(require,module,exports){var jsgui=require("../html/html");jsgui.Resource_Pool=require("./client-resource-pool"),jsgui.Client_Page_Context=require("./page-context"),jsgui.Selection_Scope=require("./selection-scope"),module.exports=jsgui},{"../html/html":85,"./client-resource-pool":28,"./page-context":30,"./selection-scope":31}],30:[function(require,module,exports){var jsgui=require("../html/html"),Client_Resource_Pool=(jsgui.stringify,jsgui.each,jsgui.arrayify,jsgui.tof,jsgui.filter_map_by_regex,jsgui.Class,jsgui.Data_Object,jsgui.Enhanced_Data_Object,jsgui.fp,jsgui.is_defined,jsgui.Collection,require("./client-resource-pool")),Selection_Scope=require("./selection-scope");class Client_Page_Context extends jsgui.Page_Context{constructor(spec){super(spec=spec||{}),this.document=spec.document||document,this.resource_pool=new Client_Resource_Pool({}),this.map_els={},this.selection_scopes={},this.selection_scope_id_counter=0}new_selection_scope(){return new Selection_Scope({context:this,id:this.selection_scope_id_counter++})}get_selection_scope_by_id(id){return this.selection_scopes[id]||(this.selection_scopes[id]=new Selection_Scope({context:this,id:id})),this.selection_scopes[id]}body(){var bod_id=this.document.childNodes[0].childNodes[1].getAttribute("data-jsgui-id");return this.map_controls[bod_id]}}module.exports=Client_Page_Context},{"../html/html":85,"./client-resource-pool":28,"./selection-scope":31}],31:[function(require,module,exports){var jsgui=require("../html-core/html-core"),each=jsgui.eac,tof=jsgui.tof;class Selection_Scope extends jsgui.Data_Object{constructor(spec){spec.context&&(this.context=spec.context),void 0!==spec.id&&(this.is=spec.id),spec.control&&(this.control=spec.control),this.map_selected_controls={}}select_only(ctrl){var currently_selected,selected,count_deselected=0;each(this.map_selected_controls,function(v,i){v&&v!==ctrl&&(selected=v.get("selected").value())&&(v.set("selected",!1),v.remove_class("selected"),v.trigger("deselect"),count_deselected++),v===ctrl&&(currently_selected=v.get("selected").value())}),this.map_selected_controls={},this.map_selected_controls[ctrl._id()]=ctrl,currently_selected||(ctrl.set("selected",!0),ctrl.trigger("select"),ctrl.add_class("selected")),count_deselected>0&!currently_selected&&this.trigger("change")}deselect_ctrl_content(ctrl){ctrl.get("selection_scope");var msc=this.map_selected_controls,that=this;ctrl.get("content").each(function(i,v){if("control"==tof(v)){v.remove_class("selected"),v.set("selected",!1);var id=v._id();msc[id]&&(msc[id]=!1),that.deselect_ctrl_content(v)}}),this.trigger("change")}select_toggle(ctrl){var sel=ctrl.get("selected").value(),msc=this.map_selected_controls,id=ctrl._id();if(sel){var tsel=tof(sel);if("data_value"==tsel&&(sel.get()?(ctrl.remove_class("selected"),ctrl.set("selected",!1),msc[id]=!1):(sel_anc=ctrl.find_selected_ancestor_in_scope())?console.log("2) not selecting because a selected ancestor in the selection scope has been found."):(ctrl.set("selected",!0),this.deselect_ctrl_content(ctrl),ctrl.add_class("selected"),msc[id]=ctrl)),"boolean"==tsel)if(sel)ctrl.remove_class("selected"),ctrl.set("selected",!1),msc[id]=!1;else{var sel_anc=ctrl.find_selected_ancestor_in_scope();sel_anc?console.log("2) not selecting because a selected ancestor in the selection scope has been found."):(this.deselect_ctrl_content(ctrl),ctrl.set("selected",!0),ctrl.add_class("selected"),msc[id]=ctrl)}}else(sel_anc=ctrl.find_selected_ancestor_in_scope())?console.log("1) not selecting because a selected ancestor in the selection scope has been found."):(ctrl.set("selected",!0),this.deselect_ctrl_content(ctrl),ctrl.add_class("selected"),msc[id]=ctrl);this.trigger("change")}}module.exports=Selection_Scope},{"../html-core/html-core":83}],32:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Audio_Volume=require("./audio-volume"),Media_Scrubber=require("./media-scrubber"),Control=jsgui.Control;class Audio_Player extends Control{constructor(spec,add,make){super(spec),this.__type_name="audio_player",this.add_class("audio-player");var site_audio=this.context.resource_pool.get_resource("Site Audio");console.log("site_audio",site_audio);if(!spec.abstract&&!spec.el){var albums=site_audio.meta.get("albums");console.log("albums",albums);var div_relative=add(Control({class:"relative"})),titlebar=make(Control({class:"titlebar"})),h1=make(jsgui.h1({}));titlebar.add(h1),h1.add(albums[0].artist);var h2=make(jsgui.h2({}));titlebar.add(h2),h2.add(albums[0].name),div_relative.add(titlebar);var ctrl_tracks=make(Control({class:"tracks"}));this.set("ctrl_tracks",ctrl_tracks),div_relative.add(ctrl_tracks);var tracks=albums[0].tracks;console.log("tracks",tracks),each(tracks,function(track,i){console.log("track",track);var div_track=make(Control({class:"track"}));ctrl_tracks.add(div_track);var div_number=make(Control({class:"number"}));div_track.add(div_number);var str_number=""+(i+1);div_number.add(str_number);var div_name=make(Control({class:"name"}));div_track.add(div_name),div_name.add(track.name);var div_length=make(Control({class:"length"}));div_track.add(div_length);var ms_duration=track.ms_duration;console.log("ms_duration",ms_duration);var s_duration=ms_duration/1e3,mins=Math.floor(s_duration/60),str_secs=Math.floor(s_duration%60).toString();1==str_secs.length&&(str_secs="0"+str_secs);var str_time=mins+":"+str_secs;div_length.add(str_time);var dca=make(Control({class:"clearall"}));div_track.add(dca)});var ctrl_audio=make(jsgui.audio({}));div_relative.add(ctrl_audio);var ctrl_source_mp3=make(Control({tagName:"source"})),ctrl_source_ogg=make(Control({tagName:"source"}));ctrl_source_mp3.dom.attributes.type="audio/mp3",ctrl_source_ogg.dom.attributes.type="audio/ogg",ctrl_audio.add(ctrl_source_mp3),ctrl_audio.add(ctrl_source_ogg);var controls=make(Control({class:"controls"}));div_relative.add(controls);var buttons=make(Control({class:"buttons"}));controls.add(buttons);var btn_previous=make(Control({class:"previous button"})),btn_play_stop=make(Control({class:"play button"})),btn_next=make(Control({class:"next button"}));buttons.add(btn_previous),buttons.add(btn_play_stop),buttons.add(btn_next);var volume=make(Audio_Volume({}));controls.add(volume);var scrubber=make(Media_Scrubber({ms_duration:tracks[0].ms_duration}));controls.add(scrubber);var ctrl_fields={ctrl_relative:div_relative._id(),ctrl_audio:ctrl_audio._id(),btn_previous:btn_previous._id(),btn_play_stop:btn_play_stop._id(),btn_next:btn_next._id(),scrubber:scrubber._id(),ctrl_volume:volume._id(),ctrl_tracks:ctrl_tracks._id(),ctrl_source_mp3:ctrl_source_mp3._id(),ctrl_source_ogg:ctrl_source_ogg._id()};this.set("dom.attributes.data-jsgui-ctrl-fields",stringify(ctrl_fields).replace(/"/g,"'"));var c_albums=jsgui.clone(albums);c_albums[0].path="/audio/albums/01/",this.set("dom.attributes.data-jsgui-fields",stringify({albums:c_albums}).replace(/"/g,"[DBL_QT]").replace(/'/g,"[SNG_QT]"))}}resizable(){this.set("resizable","right-bottom"),this.set("dom.attributes.data-jsgui-fields","{'resizable': 'right-bottom'}")}activate(){super.activate();var ctrl_relative=this.ctrl_relative,ctrl_audio=this.ctrl_audio,ctrl_source_mp3=this.ctrl_source_mp3,ctrl_source_ogg=this.ctrl_source_ogg,btn_previous=this.btn_previous,btn_play_stop=this.btn_play_stop,btn_next=this.btn_next,scrubber=this.scrubber,ctrl_tracks=(this.ctrl_volume,this.ctrl_tracks),el_audio=ctrl_audio.dom.el,tracks_content=ctrl_tracks.content;ctrl_tracks.set_i_track=function(i_track){tracks_content.each(function(ctrl_track,i){tracks[i];i_track==i?ctrl_track.add_class("current"):ctrl_track.remove_class("current")})};var albums=this.albums,that=this,tracks=albums[0].tracks,album_path=albums[0].path;ctrl_relative.on("touchstart",function(e_touchstart){console.log("e_touchstart",e_touchstart)});var i_track=0;tracks_content.each(function(ctrl_track,i){var track=tracks[i];ctrl_track.set("track",track),ctrl_track.on("click",function(e_click){i_track=i;var track_num_str=i+1+"";1==track_num_str.length&&(track_num_str="0"+track_num_str);var mp3_path=album_path+track_num_str+".mp3",ogg_path=album_path+track_num_str+".ogg";ctrl_source_mp3.dom.attributes.src=mp3_path,ctrl_source_ogg.dom.attributes.src=ogg_path,scrubber.ms_duration=track.ms_duration,ctrl_tracks.set_i_track(i),el_audio.load()})}),el_audio.load();var initial=!0,state="loading";ctrl_audio.on("canplaythrough",function(e_canplaythrough){initial?(el_audio.play(),state="playing",initial=!1,console.log("el_audio.duration",el_audio.duration),console.log("el_audio.duration mins",Math.floor(el_audio.duration/60)),console.log("el_audio.duration seconds",Math.floor(el_audio.duration%60))):(el_audio.play(),state="playing")}),ctrl_audio.on("timeupdate",function(e_timeupdate){var ms_time=1e3*el_audio.currentTime;scrubber.ms_time=ms_time});var play_track_by_index=function(i){var track=tracks[i_track],track_num_str=i+1+"";1==track_num_str.length&&(track_num_str="0"+track_num_str);var mp3_path=album_path+track_num_str+".mp3",ogg_path=album_path+track_num_str+".ogg";ctrl_source_mp3.dom.attributes.src=mp3_path,ctrl_source_ogg.dom.attributes.src=ogg_path,scrubber.ms_duration=track.ms_duration,el_audio.load(),ctrl_tracks.set_i_track(i)};ctrl_audio.on("ended",function(e_ended){console.log("e_ended",e_ended),i_track<tracks.length&&play_track_by_index(++i_track)}),scrubber.on("change",function(e_change){e_change.name;var value=e_change.value;if(e_change.source!=that){var val,nct=(val=value.value?value.value():value)/1e3;console.log("nct",nct),el_audio.currentTime=nct}}),btn_previous.on("click",function(e_click){play_track_by_index(--i_track)}),btn_next.on("click",function(e_click){play_track_by_index(++i_track),ctrl_tracks.set_i_track(i_track),"playing"==state&&(state="paused")}),btn_play_stop.on("click",function(e_click){"playing"==state?(el_audio.pause(),state="paused"):"paused"==state&&(el_audio.play(),state="playing")})}}module.exports=Audio_Player},{"../html-core/html-core":83,"./audio-volume":33,"./media-scrubber":52}],33:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Horizontal_Slider=require("./horizontal-slider");jsgui.stringify,jsgui.each,jsgui.tof,jsgui.Control,jsgui.v_subtract;class Audio_Volume extends jsgui.Control{constructor(spec,add,make){if(super(spec),this.__type_name="audio_volume",!spec.abstract&&!spec.el){this.add_class("audio-volume");add(Horizontal_Slider({min:0,max:100,value:100}))._id();this.active()}}activate(){super.activate(),console.log("Audio Volume activate");this.h_slider}}module.exports=Audio_Volume},{"../html-core/html-core":83,"./horizontal-slider":46}],34:[function(require,module,exports){var Control=require("../html-core/html-core").Control;class Button extends Control{constructor(spec,add,make){super(spec);this.__type_name="button",this.add_class("button"),spec.text&&(this.text=spec.text),spec.no_compose||this._abstract||spec.el||spec.text&&this.add(spec.text)}activate(){super.activate()}}module.exports=Button},{"../html-core/html-core":83}],35:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Menu_Node=require("./menu-node"),each=(jsgui.stringify,jsgui.each),tof=jsgui.tof,Control=(jsgui.is_defined,jsgui.Control);class Context_Menu extends Control{constructor(spec,add,make){if(super(spec),this.__type_name="context_menu",this.add_class("context menu"),console.log("Context_Menu init spec.el",spec.el),!spec.abstract){var obj=spec.value;console.log("menu obj",obj);var that=this,tobj=tof(obj);"object"==tobj&&each(obj,function(v,key){var menu_node=make(Menu_Node({text:key,value:v,menu:that}));that.add(menu_node)}),"array"==tobj&&each(obj,function(v,index){tof(v);if("[s,f]"==jsgui.get_item_sig(v,1)){var text=v[0],menu_node=(v[1],make(Menu_Node({text:text,value:text,menu:that})));that.add(menu_node)}})}}activate(){super.activate()}close_all(){console.log("menu close_all"),this.content.each(function(v,i){v.close_all()})}}module.exports=Context_Menu},{"../html-core/html-core":83,"./menu-node":53}],36:[function(require,module,exports){var controls={Audio_Player:require("./audio-player"),Audio_Volume:require("./audio-volume"),Button:require("./button"),Context_Menu:require("./context-menu"),File_Upload:require("./file-upload"),Grid:require("./grid"),Horizontal_Menu:require("./horizontal-menu"),Horizontal_Slider:require("./horizontal-slider"),Item:require("./item"),Item_View:require("./item-view"),Line_Chart:require("./line-chart"),List:require("./list"),Login:require("./login"),Media_Scrubber:require("./media-scrubber"),Menu_Node:require("./menu-node"),Multi_Layout_Mode:require("./multi-layout-mode"),Object_Editor:require("./editor/object"),Panel:require("./panel"),Plus_Minus_Toggle_Button:require("./plus-minus-toggle-button"),Popup_Menu_Button:require("./popup-menu-button"),Radio_Button:require("./radio-button"),Radio_Button_Group:require("./radio-button-group"),Scroll_View:require("./scroll-view"),Scrollbar:require("./scrollbar"),Single_Line:require("./single-line"),Start_Stop_Toggle_Button:require("./start-stop-toggle-button"),Tabs:require("./tabs"),Text_Field:require("./text-field"),Title_Bar:require("./title-bar"),Titled_Panel:require("./titled-panel"),Toggle_Button:require("./toggle-button"),Tree_Node:require("./tree-node"),Vertical_Expander:require("./vertical-expander"),Window:require("./window")};module.exports=controls},{"./audio-player":32,"./audio-volume":33,"./button":34,"./context-menu":35,"./editor/object":41,"./file-upload":43,"./grid":44,"./horizontal-menu":45,"./horizontal-slider":46,"./item":48,"./item-view":47,"./line-chart":49,"./list":50,"./login":51,"./media-scrubber":52,"./menu-node":53,"./multi-layout-mode":54,"./panel":55,"./plus-minus-toggle-button":56,"./popup-menu-button":57,"./radio-button":59,"./radio-button-group":58,"./scroll-view":60,"./scrollbar":61,"./single-line":62,"./start-stop-toggle-button":63,"./tabs":64,"./text-field":65,"./title-bar":67,"./titled-panel":68,"./toggle-button":69,"./tree-node":70,"./vertical-expander":72,"./window":79}],37:[function(require,module,exports){var jsgui=require("../../html-core/html-core"),Array_Viewer=require("../viewer/array"),factory=require("./factory");jsgui.stringify,jsgui.each,jsgui.tof,jsgui.is_defined,jsgui.Control;class Array_Editor extends Array_Viewer{constructor(spec){super();this.make;this.factory=factory,this.add_class("array-editor"),this.__type_name="array_editor"}refresh_internal(){this.super.refresh_internal()}}module.exports=Array_Editor},{"../../html-core/html-core":83,"../viewer/array":73,"./factory":38}],38:[function(require,module,exports){var jsgui=require("../../html-core/html-core"),Object_Editor=require("./object"),Array_Editor=require("./array"),String_Editor=require("./string"),Number_Editor=require("./number"),tof=(jsgui.stringify,jsgui.each,jsgui.tof),create=(jsgui.is_defined,jsgui.Control,jsgui.group,function(obj,context){var tobj=tof(obj);if("object"==tobj)return res=new Object_Editor({context:context,value:obj});if("array"==tobj)return res=new Array_Editor({context:context,value:obj});if("string"==tobj)return res=new String_Editor({context:context,value:obj});if("number"==tobj)return res=new Number_Editor({context:context,value:obj});if("data_value"==tobj){var val=obj.value(),tval=tof(val);if("string"==tval)res=new String_Editor({context:context,value:obj});if("array"==tval)var res=new Array_Editor({context:context,value:obj});return res}});module.exports=create},{"../../html-core/html-core":83,"./array":37,"./number":39,"./object":41,"./string":42}],39:[function(require,module,exports){var jsgui=require("../../lang/lang"),Number_Viewer=require("../viewer/number"),Up_Down_Arrow_Buttons=(jsgui.stringify,jsgui.each,jsgui.tof,jsgui.is_defined,jsgui.Control,require("../up-down-arrow-buttons"));class Number_Editor extends Number_Viewer{constructor(spec){this.make;this._super(spec),this.add_class("number-editor"),this.__type_name="number_editor";var udab=new Up_Down_Arrow_Buttons({context:this._context});this.add(udab),this.set("up_down_arrow_buttons",udab)}activate(){this._super();var udab=this.get("up_down_arrow_buttons"),that=this;udab.on("up",function(){var val=that.get("value");that.set("value",val+1)}),udab.on("down",function(){var val=that.get("value");that.set("value",val-1)})}}module.exports=Number_Editor},{"../../lang/lang":94,"../up-down-arrow-buttons":71,"../viewer/number":75}],40:[function(require,module,exports){var jsgui=require("../../lang/lang"),Object_KVP_Viewer=require("../viewer/object-kvp"),factory=require("./factory"),String_Editor=require("./string"),Number_Editor=require("./number");jsgui.stringify,jsgui.each,jsgui.tof,jsgui.is_defined,jsgui.Control;class Object_KVP_Editor extends Object_KVP_Viewer{constructor(spec){this.factory=factory,this.String=String_Editor,this.Number=Number_Editor,this._super(spec),this.add_class("object-kvp-editor"),this.add_class(this.mode),this.__type_name="object_kvp_editor"}refresh_internal(){this._super()}activate(){this._super()}}module.exports=Object_KVP_Editor},{"../../lang/lang":94,"../viewer/object-kvp":76,"./factory":38,"./number":39,"./string":42}],41:[function(require,module,exports){var jsgui=require("../../html-core/html-core"),Object_Viewer=require("../viewer/object"),Object_KVP_Editor=require("./object-kvp"),factory=require("./factory");jsgui.stringify,jsgui.each,jsgui.tof,jsgui.is_defined,jsgui.Control;class Object_Editor extends Object_Viewer{constructor(spec){super(spec);this.make;this.factory=factory,this.Object_KVP=Object_KVP_Editor,this.add_class("object-editor"),this.__type_name="object_editor"}refresh_internal(){super.refresh_internal()}}module.exports=Object_Editor},{"../../html-core/html-core":83,"../viewer/object":77,"./factory":38,"./object-kvp":40}],42:[function(require,module,exports){var jsgui=require("../../html-core/html-core"),String_Viewer=require("../viewer/string");jsgui.stringify,jsgui.each,jsgui.tof,jsgui.is_defined,jsgui.Control;class String_Editor extends String_Viewer{constructor(spec){super(spec);this.make;this.add_class("string-editor"),this.__type_name="string_editor"}refresh_internal(){this.super.refresh_internal()}_edit(){var input=this.get("input");if(!input){var content=this.content,span=this.get("span"),el=this.dom.el,span_bcr=span.dom.el.getBoundingClientRect(),this_bcr=el.getBoundingClientRect(),span_x_offset=span_bcr.left-this_bcr.left,w=span_bcr.width,value=this.get("value");(input=new jsgui.input({context:this._context})).set("dom.attributes.value",value);span.style("font-size");var font=span.style("font");input.style({position:"absolute","margin-left":span_x_offset+"px",width:w+"px",outline:"0",border:"0px solid",font:font}),content.insert(input,0);var iel=input.dom.el;span.dom.el;iel.focus();var sync_size=function(e){console.log("e",e),setTimeout(function(){var scrollWidth=iel.scrollWidth;console.log("scrollWidth",scrollWidth),input.style({width:scrollWidth+"px"})},0)};input.on("keypress",function(e_keydown){sync_size()}),console.log("has inserted input."),this.set("editing",!0)}}activate(){this._super();var that=this,span=this.get("span");span.on("blur",function(e_blur){console.log("e_blur",e_blur)});var selected_on_mousedown;this.on("mousedown",function(e_down){console.log("mousedown");var span_selected=this.get("span.selected");console.log("md span_selected",span_selected),selected_on_mousedown=span_selected}),this.on("click",function(e_click){that.get("selected")&!that.get("editing")&&console.log("selected and not editing");var span_selected=this.get("span.selected");console.log("span_selected",span_selected),span.dom.el.setAttribute("contenteditable",!0)});var elSpan=span.dom.el;span.on("keyup",function(e_keyup){console.log("span keyup");var cns=elSpan.childNodes;if(console.log("cns.length "+cns.length),cns.length>1)for(var i=0;i<cns.length;i++){var cn=cns[i];3==cn.nodeType||(elSpan.removeChild(cn),i--)}})}}module.exports=String_Editor},{"../../html-core/html-core":83,"../viewer/string":78}],43:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Button=(require("./text-field"),require("./button")),Control=(jsgui.stringify,jsgui.each,jsgui.tof,jsgui.Control);class File_Upload extends Control{constructor(spec){this.make,spec.autosubmit;super(spec);var mode="medium";spec.mode&&(mode=spec.mode),this.__type_name="file_upload";this.context.req;var frm=new jsgui.form({context:this.context});spec.action?this.action=spec.action:this.action="/upload/";var da=this.dom.attrs;da.action=this.action,da.method="POST",da.enctype="multipart/form-data",this.add(frm);var input_file=new jsgui.input({context:this.context});if(input_file.set("dom.attributes.type","file"),input_file.set("dom.attributes.name","file"),frm.add(input_file),"normal"===mode||"large"===mode){var btn=new Button({context:this.context}),bda=btn.dom.attrs;bda.type="submit",bda.value="submit",bda.class="upload",btn.add("Upload"),frm.add(btn)}input_file._id(),frm._id()}activate(){super.activate(),console.log("activate File_Upload");this.mode;var autosubmit=this.autosubmit,input_file=this.input_file,form=this.form;autosubmit&&input_file.add_event_listener("change",function(e_change){console.log("e_change",e_change),form.dom.el.submit()})}}module.exports=File_Upload},{"../html-core/html-core":83,"./button":34,"./text-field":65}],44:[function(require,module,exports){var jsgui=require("../html-core/html-core"),tof=(jsgui.stringify,jsgui.each,jsgui.tof),Control=(jsgui.is_defined,jsgui.Control);jsgui.group;class Grid extends Control{constructor(spec,add,make){super(spec),this.__type_name="grid",this.add_class("grid");spec.data;if(!spec.abstract&&!spec.el){this.full_compose_as_table()}}full_compose_as_table(){this.dom.tagName=table;var value,data=this.data,range=data.range;if("data_grid"!==tof(data))throw"Unexpected data type. Expected data_grid, got "+tof(data);var x,y,ctrl_cell,ctrl_row,max_x=range[0],max_y=range[1],size=this.size().value(),tbody_params={context:this.context,tagName:"tbody"};size&&(tbody_params.size=[size[0][0],size[1][0]]);var tbody=new Control(tbody_params);for(this.add(tbody),y=0;y<=max_y;y++)for(ctrl_row=new jsgui.tr({context:this.context}),tbody.add(ctrl_row),x=0;x<=max_x;x++)ctrl_cell=new jsgui.td({context:this.context}),ctrl_row.add(ctrl_cell),value=data.get(x,y),ctrl_cell.add_text(value)}activate(){this.__active||super.activate()}}module.exports=Grid},{"../html-core/html-core":83}],45:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Menu_Node=require("./menu-node"),each=(jsgui.stringify,jsgui.each),tof=jsgui.tof,Control=(jsgui.is_defined,jsgui.Control);jsgui.group;class Horizontal_Menu extends Control{constructor(spec,add,make){if(super(spec),this.__type_name="horizontal_menu",this.dom.attrs.class="horizontal menu",!spec.abstract&&!spec.el){var obj=spec.value,that=this;"object"==tof(obj)&&each(obj,function(v,key){var menu_node=make(Menu_Node({text:key,value:v,menu:that}));that.add(menu_node)})}}activate(){if(!this.__active){super.activate();this.content.each(function(v,i){v.on("click",function(e_click){v.get("state");v.open(),v.one_mousedown_anywhere(function(e_mousedown){e_mousedown.within_this||v.close()})}),v.on("mouseup",function(e_mouseup){})})}}close_all(){console.log("menu close_all"),this.content.each(function(v,i){v.close_all()})}}module.exports=Horizontal_Menu},{"../html-core/html-core":83,"./menu-node":53}],46:[function(require,module,exports){var jsgui=require("../html-core/html-core"),stringify=jsgui.stringify,Control=(jsgui.each,jsgui.tof,jsgui.Control);jsgui.v_subtract;class Horizontal_Slider extends Control{constructor(spec,add,make){if(super(spec),this.__type_name="horizontal_slider",!spec.abstract&&!spec.el){var div_relative=add(Control({class:"relative"}));this.add_class("horizontal slider");var h_bar=make(Control({class:"h-bar"})),v_bar=make(Control({class:"v-bar"}));div_relative.add(h_bar),div_relative.add(v_bar);var ctrl_fields={div_relative:div_relative._id(),h_bar:h_bar._id(),v_bar:v_bar._id()};this.set("dom.attributes.data-jsgui-ctrl-fields",stringify(ctrl_fields).replace(/"/g,"'"));var obj_fields={min:this.get("min").value(),max:this.get("max").value(),value:this.value},drag_mode=this.get("drag_mode");drag_mode&&(obj_fields.drag_mode=drag_mode.value()),this.set("dom.attributes.data-jsgui-fields",stringify(obj_fields).replace(/"/g,"[DBL_QT]").replace(/'/g,"[SNG_QT]")),this.active()}}activate(){super.activate(),console.log("Horizontal Slider activate");var that=this,h_bar=this.h_bar,v_bar=this.v_bar,size=this.size(),h_w_v_bar=this.v_bar.size()[0]/2,h_bar_width=size[0]-10;this.h_bar.style({width:h_bar_width+"px"});var pos_down,drag_mode,prop,ctrl_ghost_v_bar,v_bar_center_pos,v_bar_center_pos_when_pressed,ctrl_html_root=this.context.ctrl_document,orig_v_bar_l=parseInt(this.v_bar.style("left"),10),ensure_ctrl_ghost_v_bar=(this.context,function(){ctrl_ghost_v_bar?div_relative.add(ctrl_ghost_v_bar):(ctrl_ghost_v_bar=new Control({context:this.context,class:"ghost v-bar"}),div_relative.add(ctrl_ghost_v_bar),ctrl_ghost_v_bar.activate())}),fn_mousemove=function(e_mousemove){var bcr_h_bar=h_bar.bcr(),bcr_h_bar_x=bcr_h_bar[0][0],bcr_h_bar_w=bcr_h_bar[2][0],up_offset_from_bcr_h_bar_x=e_mousemove.pageX-bcr_h_bar_x;up_offset_from_bcr_h_bar_x<0&&(up_offset_from_bcr_h_bar_x=0),up_offset_from_bcr_h_bar_x>bcr_h_bar_w&&(up_offset_from_bcr_h_bar_x=bcr_h_bar_w),"ghost"==drag_mode?(ensure_ctrl_ghost_v_bar(),ctrl_ghost_v_bar.style("left",up_offset_from_bcr_h_bar_x+"px")):v_bar.style("left",up_offset_from_bcr_h_bar_x+"px")},fn_mouseup=function(e_mouseup){console.log("e_mouseup",e_mouseup),ctrl_html_root.off("mousemove",fn_mousemove),ctrl_html_root.off("mouseup",fn_mouseup);var bcr_h_bar=h_bar.bcr();console.log("bcr_h_bar",bcr_h_bar);var bcr_h_bar_x=bcr_h_bar[0][0],bcr_h_bar_w=bcr_h_bar[2][0],up_offset_from_bcr_h_bar_x=e_mouseup.pageX-bcr_h_bar_x;console.log("up_offset_from_bcr_h_bar_x",up_offset_from_bcr_h_bar_x),up_offset_from_bcr_h_bar_x<0&&(up_offset_from_bcr_h_bar_x=0),up_offset_from_bcr_h_bar_x>bcr_h_bar_w&&(up_offset_from_bcr_h_bar_x=bcr_h_bar_w);var prop=up_offset_from_bcr_h_bar_x/bcr_h_bar_w;if(console.log("prop",prop),"ghost"==drag_mode){ctrl_ghost_v_bar.remove();var min=that.min;min.value&&(min=min.value());var max=that.max;max.value&&(max=max.value()),console.log("pos_down",pos_down);var new_val=prop*max;console.log("new_val",new_val),that.value=new_val}else orig_v_bar_l=void 0};v_bar.on("mousedown",function(e_mousedown){var dm=that.drag_mode;dm&&(drag_mode=dm.value()),v_bar_center_pos_when_pressed=v_bar_center_pos,ctrl_html_root.on("mousemove",fn_mousemove),ctrl_html_root.on("mouseup",fn_mouseup),ctrl_html_root.add_class("dragging"),pos_down=[e_mousedown.pageX,e_mousedown.pageY]}),this.on("change",function(e_change){var name=e_change.name,value=e_change.value;if("value"==name){that.min;var max=that.max;prop=value/max;var size_h_bar=h_bar.size;v_bar_center_pos=Math.round(size_h_bar[0]*prop+5-h_w_v_bar),v_bar.style("left",v_bar_center_pos+"px")}})}}module.exports=Horizontal_Slider},{"../html-core/html-core":83}],47:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Plus_Minus_Toggle_Button=require("./plus-minus-toggle-button"),Control=(require("./vertical-expander"),jsgui.stringify,jsgui.each,jsgui.tof,jsgui.Control);class Item_View extends Control{constructor(spec){super(spec);var that=this;this.__type_name="item_view",this.add_class("item item-view");var ctrl_expand_contract=new Plus_Minus_Toggle_Button({context:this.context,state:"+"});ctrl_expand_contract.active(),this.set("expand_contract",ctrl_expand_contract),this.add(ctrl_expand_contract);var ctrl_icon=new Control({context:this.context});ctrl_icon.add_class("icon"),this.add(ctrl_icon);var ctrl_item_info=new Control({context:this.context});ctrl_item_info.add_class("info"),this.add(ctrl_item_info);var ctrl_name=new Control({context:this.context});ctrl_name.add_class("name");var name=this.get("name"),ctrl_tn_name=new jsgui.textNode({text:name,context:this.context});ctrl_name.add(ctrl_tn_name);var ctrl_clearall_0=new Control({context:this.context});ctrl_clearall_0.add_class("clearall"),this.add(ctrl_clearall_0);var ctrl_subitems=new Control({context:this.context});ctrl_subitems.add_class("subitems"),this.add(ctrl_subitems),ctrl_subitems.active(),this.set("ctrl_subitems",ctrl_subitems);var ctrl_clearall=new Control({context:this.context});ctrl_clearall.add_class("clearall"),this.add(ctrl_clearall),this.ctrl_subitems=ctrl_subitems,ctrl_item_info.add(ctrl_name),"undefined"==typeof document&&(that._fields=that._fields||{},that._fields.name=name,spec.path&&(that._fields.path=spec.path))}activate(){if(!this.__active){super.activate();var that=this;this.expand_contract.on("change",function(e_change){"state"===e_change.name&&("-"===e_change.value&&that.trigger("expand"),"+"===e_change.value&&that.trigger("contract"))})}}}module.exports=Item_View},{"../html-core/html-core":83,"./plus-minus-toggle-button":56,"./vertical-expander":72}],48:[function(require,module,exports){var jsgui=require("../html-core/html-core"),stringify=jsgui.stringify,each=jsgui.each,tof=jsgui.tof,Control=jsgui.Control,Data_Value=jsgui.Data_Value;class Item extends Control{constructor(spec,add,make){super(spec),this.__type_name="item",this.add_class("item");var value=this.value=spec.value||spec.item;this.states=["closed","open"],this.state=new Data_Value("closed"),this.i_state=0;var active_fields=this.active_fields={};active_fields.states=this.states,active_fields.state=this.state,active_fields.i_state=this.i_state;var that=this;if(!spec.abstract&&!spec.el){var ctrl_primary=new Control({context:this.context});this.add(ctrl_primary);var set_value=function(value){var t_value=tof(value);if("collection"===t_value)set_value(value._arr[0]),"function"===tof(value._arr[1])&&(console.log("adding on click"),that.on("click",value._arr[1]));else if("data_value"===t_value)ctrl_primary.add(value.value());else if("string"===t_value||"number"===t_value)ctrl_primary.add(value);else if(value.keys){var id,key,value_keys=value.keys(),map_keys=mapify(value_keys),has_id=map_keys.id,has_name=map_keys.name,has_key=map_keys.key;if(has_id&&has_key&&!has_name){id=value.id,key=value.key;var ctrl_id=new Control({context:this.context});ctrl_id.add_class("id");var ctrl_key=new Control({context:this.context});ctrl_id.add_class("key"),ctrl_id.add(id.value),ctrl_key.add(key.value),ctrl_primary.add(ctrl_id),ctrl_primary.add(ctrl_key)}}};set_value(value),this.inner=new Control({context:this.context,class:"inner hidden"}),this.add(this.inner);var ctrl_fields={inner:this.inner._id()};this.dom.attrs["data-jsgui-fields"]=stringify(active_fields).replace(/"/g,"'"),this.dom.attrs["data-jsgui-ctrl-fields"]=stringify(ctrl_fields).replace(/"/g,"'")}}iterate_sub_items(cb_item,depth){depth=depth||0;each(this.inner.content,sub_item=>{cb_item(sub_item,depth);sub_item.iterate_sub_items(cb_item,depth+1)})}activate(){if(!this.__active){super.activate();var ui_open=()=>{this.inner.show()},ui_close=()=>{this.inner.hide()};this.state.on("change",e_change=>{var val=e_change.value;"open"===val&&ui_open();"closed"===val&&ui_close()}),this.iterate_sub_items((sub_item,depth)=>{})}}open(){this.state.set("open")}close(){this.state.set("closed")}}module.exports=Item},{"../html-core/html-core":83}],49:[function(require,module,exports){var jsgui=require("../html-core/html-core"),extend=(jsgui.stringify,jsgui.each,jsgui.tof,jsgui.extend),Control=jsgui.Control;jsgui.Collection;class Line_Chart extends Control{constructor(spec){if(super(spec),this.__type_name="line_chart",!spec.abstract&&!spec.el){this.add_class("line-chart no-select");var vert_margin=10,left_margin=80,right_margin=24,axis_thickness=2,x_major_notch_spacing=spec.x_major_notch_spacing||spec.major_notch_spacing||50,y_major_notch_spacing=spec.y_major_notch_spacing||spec.major_notch_spacing||50,x_minor_notch_spacing=spec.x_minor_notch_spacing||spec.major_minor_spacing||10,y_minor_notch_spacing=spec.y_minor_notch_spacing||spec.major_minor_spacing||10,suppress_0_axes_labels=!0;this.set({vert_margin:vert_margin,left_margin:left_margin,right_margin:right_margin,axis_thickness:axis_thickness,x_major_notch_spacing:x_major_notch_spacing,y_major_notch_spacing:y_major_notch_spacing,x_minor_notch_spacing:x_minor_notch_spacing,y_minor_notch_spacing:y_minor_notch_spacing,suppress_0_axes_labels:suppress_0_axes_labels}),this.add_full_axes()}this.get("num_days");"undefined"==typeof window&&extend(this._fields=this._fields||{},{vert_margin:vert_margin,left_margin:left_margin,right_margin:right_margin,axis_thickness:axis_thickness,x_major_notch_spacing:x_major_notch_spacing,y_major_notch_spacing:y_major_notch_spacing,x_minor_notch_spacing:x_minor_notch_spacing,y_minor_notch_spacing:y_minor_notch_spacing,suppress_0_axes_labels:suppress_0_axes_labels,range:this.get("range").value(),x_origin:this.get("x_origin").value(),y_origin:this.get("y_origin").value()})}add_full_axes(){var vert_margin=this.get("vert_margin"),left_margin=this.get("left_margin"),right_margin=this.get("right_margin"),x_major_notch_spacing=(this.get("axis_thickness"),this.get("x_major_notch_spacing")),y_major_notch_spacing=this.get("y_major_notch_spacing"),x_minor_notch_spacing=this.get("x_minor_notch_spacing"),y_minor_notch_spacing=this.get("y_minor_notch_spacing"),suppress_0_axes_labels=this.get("suppress_0_axes_labels"),size=this.get("size").value(),w=size[0][0],h=size[1][0],range=this.get("range").value();console.log("range",range);var y_axis_x,x_axis_y,x_origin,y_origin,x_min=range[0][0],y_min=range[0][1],x_max=range[1][0],y_max=range[1][1],x_range=x_max-x_min,y_range=y_max-y_min,y_axis_is_at_origin=x_min<=0&&x_max>=0,x_axis_is_at_origin=y_min<=0&&y_max>=0,x_axis_left=left_margin,x_axis_right=w-right_margin,x_chart_distance=x_axis_right-x_axis_left,y_chart_distance=(y_axis_bottom=h-vert_margin)-(y_axis_top=vert_margin),x_scale=x_range/(w-left_margin-right_margin),y_scale=y_range/(h-2*vert_margin),x_location_from_value=function(x_value){return Math.round(x_origin+1*x_value/x_scale)},y_location_from_value=function(y_value){return Math.round(y_origin+-1*y_value/y_scale)},svg=new Control({context:this.context,tag_name:"svg"});if(svg.set("dom.attributes",{width:w,height:h,viewPort:"0 0 "+w+" "+h,version:"1.1",xmlns:"http://www.w3.org/2000/svg"}),this.add(svg),this.set("svg",svg),!y_axis_is_at_origin)throw"stop";if(y_axis_x=x_origin=x_axis_left+(distance_through=x_chart_distance*(prop_through=-1*x_min/x_range)),!x_axis_is_at_origin)throw"stop";var prop_through=-1*y_min/y_range,distance_through=y_chart_distance*prop_through;x_axis_y=y_origin=y_axis_bottom-distance_through,this.x_origin=x_origin,this.y_origin=y_origin;var y_axis_top=vert_margin,y_axis_bottom=h-vert_margin,add_x_notch_group=function(spacing,height){for(var num_notches_left_of_origin=Math.floor(-1*x_min/spacing),notch_x_value=(Math.floor(x_max/spacing),num_notches_left_of_origin*spacing*-1);notch_x_value<=x_max;){var x_notch=new Control({context:this.context,tag_name:"line"}),x_location=x_location_from_value(notch_x_value);x_notch.set("dom.attributes",{width:2,height:height,x1:x_location,y1:y_origin,x2:x_location,y2:y_origin+height,stroke:"#AAAAAA","stroke-width":2}),svg.add(x_notch),notch_x_value+=spacing}},add_x_label_group=function(spacing){for(var num_notches_left_of_origin=Math.floor(-1*x_min/spacing),notch_x_value=(Math.floor(x_max/spacing),num_notches_left_of_origin*spacing*-1);notch_x_value<=x_max;){if(!suppress_0_axes_labels||0!==notch_x_value){var x_location=x_location_from_value(notch_x_value),x_notch_label=new Control({context:this.context,tag_name:"text"});x_notch_label.set("dom.attributes",{x:x_location-4,y:y_origin+28,"font-family":"Verdana","font-size":14}),x_notch_label.add(notch_x_value+""),svg.add(x_notch_label)}notch_x_value+=spacing}},add_y_label_group=function(spacing){for(var num_notches_below_origin=Math.floor(-1*y_min/spacing),notch_y_value=(Math.floor(y_max/spacing),num_notches_below_origin*spacing*-1);notch_y_value<=y_max;){if(!suppress_0_axes_labels||0!==notch_y_value){new Control({context:this.context,tag_name:"line"});var y_location=y_location_from_value(notch_y_value),y_notch_label=new Control({context:this.context,tag_name:"text"});y_notch_label.set("dom.attributes",{x:x_origin-48,y:y_location+6,"font-family":"Verdana","font-size":14}),y_notch_label.add(notch_y_value+""),svg.add(y_notch_label)}notch_y_value+=spacing}},add_y_notch_group=function(spacing,length){for(var num_notches_below_origin=Math.floor(-1*y_min/spacing),notch_y_value=(Math.floor(y_max/spacing),num_notches_below_origin*spacing*-1);notch_y_value<=y_max;){var y_notch=new Control({context:this.context,tag_name:"line"}),y_location=y_location_from_value(notch_y_value);y_notch.set("dom.attributes",{width:length,height:2,x1:x_origin-length,y1:y_location,x2:x_origin,y2:y_location,stroke:"#AAAAAA","stroke-width":2}),svg.add(y_notch),notch_y_value+=spacing}},add_major_x_axis_labels=function(){add_x_label_group(x_major_notch_spacing)},add_major_y_axis_labels=function(){add_y_label_group(y_major_notch_spacing)};!function(){add_x_notch_group(x_minor_notch_spacing,10)}(),function(){add_x_notch_group(x_major_notch_spacing,20)}(),function(){console.log("x_minor_notch_spacing",y_minor_notch_spacing),add_y_notch_group(y_minor_notch_spacing,10)}(),function(){add_y_notch_group(y_major_notch_spacing,20)}(),function(){var x_axis=new Control({context:this.context,tag_name:"line"});x_axis.set("dom.attributes",{width:10,height:h,x1:x_axis_left,y1:x_axis_y,x2:x_axis_right,y2:x_axis_y,stroke:"#000000","stroke-width":2}),svg.add(x_axis)}(),function(){var y_axis=new Control({context:this.context,tag_name:"line"});y_axis.set("dom.attributes",{width:10,height:h,x1:y_axis_x,y1:y_axis_top,x2:y_axis_x,y2:y_axis_bottom,stroke:"#000000","stroke-width":2}),svg.add(y_axis)}(),function(){add_major_x_axis_labels(),add_major_y_axis_labels()}(),function(){var origin_label=new Control({context:this.context,tag_name:"text"});origin_label.set("dom.attributes",{x:x_origin-14,y:y_origin+14,"font-family":"Verdana","font-size":14}),origin_label.add("0"),svg.add(origin_label)}()}render_axes(){}values_from_pixel_location(px_loc){var el=this.dom.el,w=el.clientWidth,h=el.clientHeight,x_origin=this.x_origin,y_origin=this.y_origin,vert_margin=this.vert_margin,x_axis_length=w-this.left_margin-this.right_margin,y_axis_length=h-2*vert_margin,range=this.range,x_min=range[0][0],y_min=range[0][1],x_scale=(range[1][0]-x_min)/x_axis_length,y_scale=(range[1][1]-y_min)/y_axis_length,vect_from_origin=[px_loc[0]-x_origin,px_loc[1]-y_origin];return[Math.round(vect_from_origin[0]*x_scale),Math.round(vect_from_origin[1]*y_scale*-1)]}pixel_location_from_values(values){var w,h,el=this.dom.el;if(el)w=el.clientWidth,h=el.clientHeight;else{var size=this.size();w=size._[0][0],h=size._[1][0]}var x_origin=this.x_origin,y_origin=this.y_origin,vert_margin=this.vert_margin,x_axis_length=w-this.left_margin-this.right_margin,y_axis_length=h-2*vert_margin,range=this.range,x_min=range[0][0],y_min=range[0][1],x_scale=(range[1][0]-x_min)/x_axis_length,y_scale=(range[1][1]-y_min)/y_axis_length;return[Math.round(x_origin+1*values[0]/x_scale),Math.round(y_origin+-1*values[1]/y_scale)]}activate(){if(!this.__active){super.activate();var el=this.dom.el,w=el.clientWidth,h=el.clientHeight,vert_margin=this.vert_margin,left_margin=this.left_margin,right_margin=this.right_margin,x_origin=(this.axis_thickness,this.x_major_notch_spacing,this.y_major_notch_spacing,this.x_minor_notch_spacing,this.y_minor_notch_spacing,this.suppress_0_axes_labels,this.x_origin),y_origin=this.y_origin,range=this.range,x_min=range[0][0],y_min=range[0][1],x_max=range[1][0],y_max=range[1][1],x_range=x_max-x_min,y_range=y_max-y_min,x_scale=x_range/(w-left_margin-right_margin),y_scale=y_range/(h-2*vert_margin),values_from_pixel_location=(this.context,function(px_loc){var vect_from_origin=[px_loc[0]-x_origin,px_loc[1]-y_origin];return[Math.round(vect_from_origin[0]*x_scale),Math.round(vect_from_origin[1]*y_scale*-1)]}),findPos=function(obj){var curleft=curtop=0;if(obj.offsetParent)do{curleft+=obj.offsetLeft,curtop+=obj.offsetTop}while(obj=obj.offsetParent);return[curleft,curtop]};this.add_event_listener("mousemove",function(e_mousemove){var click_x,click_y,pos=findPos(el);(e_mousemove.pageX||e_mousemove.pageY)&&(click_x=e_mousemove.pageX,click_y=e_mousemove.pageY);var click_pos=[click_x,click_y],pos_within_this=jsgui.v_subtract(click_pos,pos),values=values_from_pixel_location(pos_within_this);e_mousemove.chart_position=values}),this.add_event_listener("click",function(e_click){var click_x,click_y,pos=findPos(el);(e_click.pageX||e_click.pageY)&&(click_x=e_click.pageX,click_y=e_click.pageY);var click_pos=[click_x,click_y],pos_within_this=jsgui.v_subtract(click_pos,pos),values=values_from_pixel_location(pos_within_this);e_click.chart_position=values})}}}module.exports=Line_Chart},{"../html-core/html-core":83}],50:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Item=require("./item"),Control=(jsgui.stringify,jsgui.each,jsgui.tof,jsgui.Control),Collection=jsgui.Collection;class List extends Control{constructor(spec,add,make){console.log("init list"),super(spec);var that=this;this.__type_name="list",this.add_class("list"),this.items=new Collection,spec.items&&this.items.set(spec.items),this.items.each(function(item){var ctrl_item=new Item({context:that.context,value:item});that.add(ctrl_item)}),this.items.on("change",evt_change=>{if("insert"===evt_change.type){var ctrl_item=new Item({context:that.context,value:evt_change.item});that.add(ctrl_item)}}),!this._abstract&&spec.el}activate(){super.activate(),this.context_menu({Delete:function(){console.log("context_menu Delete")},Edit:function(){console.log("context_menu Edit")}})}}module.exports=List},{"../html-core/html-core":83,"./item":48}],51:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Text_Field=require("./text-field"),stringify=jsgui.stringify,Control=(jsgui.each,jsgui.tof,jsgui.Control);class Login extends Control{constructor(spec){this.make;super(spec),this.add_class("login-control");var req=this.context.req;console.log("--- Within Login Control ---");var headers=req.headers;console.log("headers "+stringify(headers));var auth=this.context.auth;if(console.log("auth "+stringify(auth)),auth&&auth.verified){var div_logged_in=new jsgui.div({context:this.context}),span_logged_in=new jsgui.span({context:this.context});span_logged_in.add("Logged in as: "+auth.username),div_logged_in.add(span_logged_in),(frm=new jsgui.form({context:this.context})).dom.attrs.set({action:"/logout/?returnurl=%2F",method:"POST"}),div_logged_in.add(frm),(btn=new jsgui.button({context:this.context})).dom.attrs.set({type:"submit",value:"submit",class:"logout"}),btn.add("Logout"),frm.add(btn),this.add(div_logged_in)}else{var frm=new jsgui.form({context:this.context});frm.dom.attrs.set({action:"/logout/?returnurl=%2F",method:"POST"}),this.add(frm);var tf_username=new Text_Field({text:"Username",name:"username",value:"",type:"text",context:this.context});frm.add(tf_username);var tf_password=new Text_Field({text:"Password",name:"password",value:"",type:"password",context:this.context});frm.add(tf_password);var btn=new jsgui.button({context:this.context});btn.dom.attrs.set({type:"submit",value:"submit",class:"login"}),btn.add("Login"),frm.add(btn)}}}module.exports=Login},{"../html-core/html-core":83,"./text-field":65}],52:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Horizontal_Slider=require("./horizontal-slider"),stringify=jsgui.stringify,Control=(jsgui.each,jsgui.tof,jsgui.Control);jsgui.v_subtract;class Media_Scrubber extends Control{constructor(spec,add,make){if(super(spec),this.__type_name="media_scrubber",spec.ms_duration&&this.set("ms_duration",spec.ms_duration),!spec.abstract&&!spec.el){this.add_class("scrubber");var time_display=add(Control({}));time_display.add_class("time-display");var ms_duration=this.get("ms_duration"),s_duration=Math.round(ms_duration/1e3),mins=Math.floor(s_duration/60),str_secs=(s_duration%60).toString();1==str_secs.length&&(str_secs+="0");var str_time_display="0:00 / "+(mins+":"+str_secs);time_display.add(str_time_display);var ctrl_fields={h_slider:add(Horizontal_Slider({min:0,max:ms_duration,value:0,drag_mode:"ghost"}))._id(),time_display:time_display._id()};this.set("dom.attributes.data-jsgui-ctrl-fields",stringify(ctrl_fields).replace(/"/g,"'")),this.set("dom.attributes.data-jsgui-fields",stringify({ms_duration:ms_duration}).replace(/"/g,"[DBL_QT]").replace(/'/g,"[SNG_QT]")),this.active()}spec.abstract||this.set("ms_time",new jsgui.Data_Value({contect:this.context}))}activate(){super.activate();var that=this;console.log("Media_Scrubber activate");var h_slider=this.get("h_slider"),el_time_display=this.get("time_display").dom.el,dv_ms_duration=(this.get("ms_time"),this.get("ms_duration")),ms_duration=dv_ms_duration.value(),s_duration=Math.round(ms_duration/1e3),mins_d=Math.floor(s_duration/60),str_secs_d=(s_duration%60).toString();1==str_secs_d.length&&(str_secs_d="0"+str_secs_d);this.on("change",function(e_change){var field_name=e_change.name,value=e_change.value;if(value.value&&(value=value.value()),"ms_duration"==field_name&&h_slider.set("max",value,that),"ms_time"==field_name){var s_time=value/1e3,mins=Math.floor(s_time/60),str_secs=Math.floor(s_time%60).toString();1==str_secs.length&&(str_secs="0"+str_secs);var str_time=mins+":"+str_secs;dv_ms_duration=that.get("ms_duration");var s_duration=(ms_duration=dv_ms_duration.value?dv_ms_duration.value():dv_ms_duration)/1e3,mins_d=Math.floor(s_duration/60),str_secs_d=Math.floor(s_duration%60).toString();1==str_secs_d.length&&(str_secs_d="0"+str_secs_d);var str_duration=mins_d+":"+str_secs_d;el_time_display.innerHTML=str_time+" / "+str_duration;h_slider.value=value}}),h_slider.on("change",function(e_change){var name=e_change.name,value=e_change.value,source=e_change.source;source!=that&&that.set(name,value,source)})}}module.exports=Media_Scrubber},{"../html-core/html-core":83,"./horizontal-slider":46}],53:[function(require,module,exports){var jsgui=require("../html-core/html-core"),stringify=jsgui.stringify,each=jsgui.each,tof=jsgui.tof,Control=jsgui.Control;class Menu_Node extends Control{constructor(spec,add,make){super(spec),this.__type_name="menu_node";if(!this._abstract&&!spec.el){this.add_class("menu-node");var spec_state=spec.state,main_control=make(Control({class:"main"}));if(this.add(main_control),spec.img_src,spec.text){this.text=spec.text;var span=make(jsgui.span({}));span.add(spec.text),main_control.add(span)}var menu=spec.menu;menu&&this.set("menu",menu);var inner_control=this.inner_control=make(Control({class:"inner hidden"}));if(this.add(inner_control),spec.value){var obj_menu=spec.value,t_obj_menu=tof(obj_menu);console.log("t_obj_menu",t_obj_menu),"array"==t_obj_menu&&each(obj_menu,function(v){if("string"==tof(v)){var nested_menu_node=make(Menu_Node({text:v,menu:menu}));inner_control.add(nested_menu_node)}})}var ctrl_fields={inner_control:inner_control._id(),main_control:main_control._id(),menu:spec.menu._id()};if(this.set("dom.attributes.data-jsgui-ctrl-fields",stringify(ctrl_fields).replace(/"/g,"'")),spec_state){if("open"!=spec_state&&"closed"!=spec_state)throw'spec.state expects "open" or "closed".';this.set("state",spec_state)}else this.set("state","open")}}activate(){if(!this.__active){super.activate();this.inner_control,this.main_control,this.menu}}close_all(){console.log("menu-node close_all");var inner_control=this.inner_control;inner_control.content.each(function(v,i){"menu_node"==v.__type_name&&v.close_all()}),inner_control.hide(),this.set("state","closed",!0)}close(){this.inner_control.hide(),this.set("state","closed",!0)}open(){this.inner_control.show(),this.set("state","open",!0)}}module.exports=Menu_Node},{"../html-core/html-core":83}],54:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Panel=require("./panel"),Control=(jsgui.stringify,jsgui.each,jsgui.tof,jsgui.is_defined,jsgui.Control);jsgui.group,String;class Multi_Layout_Mode extends Control{constructor(spec){super(spec);this.context.make;var context=this.context;if(this.__type_name="multi_layout_mode",this.add_class("multi-layout-mode"),!spec.abstract&&!spec.el){var layout_mode=this.layout_mode;layout_mode&&this.add_class(layout_mode);var panel_title=new Panel({context:context,name:"title"});panel_title.add_class("title");var panel_navigation=new Panel({context:context,name:"navigation"});panel_navigation.add_class("navigation");var panel_main=new Panel({context:context,name:"main"});panel_main.add_class("main");var panel_misc=new Panel({context:context,name:"misc"});if(panel_misc.add_class("misc"),"fluid-fixed"==layout_mode){var panel_top=new Panel({context:context,name:"top"});panel_top.add_class("top");var panel_left_wrapper=new Panel({context:context,name:"left-wrapper"});panel_left_wrapper.add_class("left-wrapper");var panel_left=new Panel({context:context,name:"left"});panel_left.add_class("left");var panel_right=new Panel({context:context,name:"right"});panel_right.add_class("right");var panel_bottom=new Panel({context:context,name:"bottom"});panel_bottom.add_class("bottom"),this.add(panel_top),this.add(panel_left_wrapper),panel_left_wrapper.add(panel_left),this.add(panel_right),this.add(panel_bottom),panel_top.add(panel_title),panel_bottom.add(panel_navigation),panel_left.add(panel_main),panel_right.add(panel_misc)}else this.add(panel_title),this.add(panel_navigation),this.add(panel_main),this.add(panel_misc);this.title=panel_title,this.navigation=panel_navigation,this.main=panel_main,this.misc=panel_misc}}activate(){super.activate()}}module.exports=Multi_Layout_Mode},{"../html-core/html-core":83,"./panel":55}],55:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Control=(jsgui.stringify,jsgui.each,jsgui.tof,jsgui.is_defined,jsgui.Control);class Panel extends Control{constructor(spec,add,make){if(super(spec),this.__type_name="panel",this.add_class("panel"),!spec.abstract&&!spec.el);}activate(){super.activate()}}module.exports=Panel},{"../html-core/html-core":83}],56:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Toggle_Button=require("./toggle-button");jsgui.stringify,jsgui.each,jsgui.tof,jsgui.Control;class Plus_Minus_Toggle_Button extends Toggle_Button{constructor(spec,add,make){spec.states=["+","-"],spec.state=spec.state||"-",super(spec),this.add_class("plus-minus toggle-button");this.set("state",spec.state)}}module.exports=Plus_Minus_Toggle_Button},{"../html-core/html-core":83,"./toggle-button":69}],57:[function(require,module,exports){var jsgui=require("../html-core/html-core"),stringify=jsgui.stringify,each=jsgui.each,Button=(jsgui.tof,jsgui.is_defined,jsgui.Control,require("./button")),Item=require("./item"),Collection=jsgui.Collection,Data_Value=jsgui.Data_Value;class Popup_Menu_Button extends Button{constructor(spec,add,make){spec.no_compose=!0,super(spec),this.__type_name="popup_menu_button",this.add_class("popup-menu-button");var context=this.context,that=this;this.states=["closed","open"],this.state=new Data_Value("closed"),this.i_state=0;var active_fields=this.active_fields={};active_fields.states=this.states,active_fields.state=this.state,active_fields.i_state=this.i_state;var compose=()=>{this.text=spec.text||spec.label||"";var root_menu_item=new Item({context:context,item:this.text});that.add(root_menu_item);that.root_menu_item=root_menu_item;spec.items&&(this.items=new Collection(spec.items),each(this.items,item=>{var menu_item=new Item({context:context,item:item});root_menu_item.inner.add(menu_item)}));var ctrl_fields={root_menu_item:root_menu_item._id()};this.dom.attrs["data-jsgui-fields"]=stringify(active_fields).replace(/"/g,"'");this.dom.attrs["data-jsgui-ctrl-fields"]=stringify(ctrl_fields).replace(/"/g,"'")};spec.abstract||spec.el||compose(),spec.el&&compose()}activate(){if(!this.__active){super.activate();var root_menu_item=this.root_menu_item;console.log("Popup_Menu_Button activate");var that=this;this.state.on("change",function(e_change){var val=e_change.value;root_menu_item.state.set(val)}),root_menu_item.on("click",function(e_click){var new_i_state=that.i_state+1;new_i_state===that.states.length&&(new_i_state=0),that.i_state=new_i_state,that.state.set(that.states[new_i_state])})}}}module.exports=Popup_Menu_Button},{"../html-core/html-core":83,"./button":34,"./item":48}],58:[function(require,module,exports){var jsgui=require("../html-core/html-core"),each=(jsgui.stringify,jsgui.each),Control=(jsgui.tof,jsgui.is_defined,jsgui.Control),Radio_Button=(jsgui.group,require("./radio-button"));class Radio_Button_Group extends Control{constructor(spec,add,make){super(spec),this.__type_name="radio_button_group",this.add_class("radio-button-group");var context=this.context,that=this;if(!spec.abstract&&!spec.el){var id=this._id(),items=this.get("items").value();each(items,function(v,i){var radio_button=new Radio_Button({context:context,name:id,text:v,value:v});that.add(radio_button)})}}activate(){if(console.log("1) Activate radio_button_group"),!this.__active){var that=this;super.activate();var ctrl_checked;console.log("2) Activate radio_button_group"),this.content.each(function(ctrl,i){ctrl.on("change",!1,function(e_change){ctrl_checked=ctrl,that.raise("change",{checked:ctrl_checked})})})}}}module.exports=Radio_Button_Group},{"../html-core/html-core":83,"./radio-button":59}],59:[function(require,module,exports){var jsgui=require("../html-core/html-core"),stringify=jsgui.stringify,is_defined=(jsgui.each,jsgui.tof,jsgui.is_defined),Control=jsgui.Control;jsgui.group,String,String,String,Boolean;class Radio_Button extends Control{constructor(spec,add,make){super(spec),this.__type_name="radio_button",this.add_class("radio-button");var context=this.context,that=this;if(!spec.abstract&&!spec.el){var name=this.get("name").value(),html_radio=new Control({context:context});html_radio.set("dom.tagName","input"),html_radio.set("dom.attributes.type","radio"),html_radio.set("dom.attributes.name",name),html_radio.set("dom.attributes.id",html_radio._id());var html_label=new Control({context:context});html_label.set("dom.tagName","label");var text_value=that.get("text").value();is_defined(text_value)&&html_label.add(text_value),html_label.set("dom.attributes.for",html_radio._id()),that.add(html_radio),that.add(html_label),that.set("radio",html_radio),that.set("label",html_label),that.set("dom.attributes.data-jsgui-fields",stringify({value:that.get("value")}).replace(/"/g,"[DBL_QT]").replace(/'/g,"[SNG_QT]"))}}activate(){if(!this.__active){super.activate();var radio=this.get("radio"),el_radio=radio.dom.el.value(),that=(this.get("label"),this);radio.on("change",function(e_change){el_radio.checked&&that.raise("change")})}}}module.exports=Radio_Button},{"../html-core/html-core":83}],60:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Control=(jsgui.stringify,jsgui.each,jsgui.tof,jsgui.Control),Scrollbar=require("./scrollbar"),H_Scrollbar=Scrollbar.H,V_Scrollbar=Scrollbar.V;class Scroll_View extends Control{constructor(spec,add,make){if(super(spec),this.__type_name="toggle_button",this.add_class("scrollbar"),!spec.abstract&&!spec.el){var inner_view=new Control({context:this.context}),h_scrollbar=new H_Scrollbar({context:this.context}),v_scrollbar=new V_Scrollbar({context:this.context});this.add(inner_view),this.add(h_scrollbar),this.add(v_scrollbar),this.active()}}activate(){if(!this.__active){super.activate()}}}module.exports=Scroll_View},{"../html-core/html-core":83,"./scrollbar":61}],61:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Control=(jsgui.stringify,jsgui.each,jsgui.tof,jsgui.Control),Button=require("./button");class Scrollbar extends Control{constructor(spec,add,make){super(spec),this.__type_name="scrollbar",this.active();var context=this.context;if(!spec.abstract&&!spec.el){this.add_class("scrollbar");var btn_negitive=new Button({context:context}),scroll_area=new Control({context:context}),draggable_scroller=new Control({context:context}),btn_positive=new Button({context:context});this.add(btn_negitive),scroll_area.add(draggable_scroller),this.add(scroll_area),this.add(btn_positive)}}activate(){if(!this.__active){super.activate()}}}class Horizontal_Scrollbar extends Scrollbar{constructor(spec){this.__direction="horizontal",super(spec)}}class Vertical_Scrollbar extends Scrollbar{constructor(spec){this.__direction="vertical",super(spec)}}Scrollbar.H=Scrollbar.Horizontal=Horizontal_Scrollbar,Scrollbar.V=Scrollbar.Vertical=Vertical_Scrollbar,module.exports=Scrollbar},{"../html-core/html-core":83,"./button":34}],62:[function(require,module,exports){Object,String,String;var jsgui=require("../html-core/html-core"),Control=(jsgui.stringify,jsgui.each,jsgui.tof,jsgui.Control);class Single_Line extends Control{constructor(spec){super(spec),this.add_class("single-line"),this.__type_name="single_line";var display_value,value=this.value,meta_field=this.get("meta_field");if(meta_field&&(display_value=value.meta.get(meta_field.value())),!this.dom.el){var span=new jsgui.span({context:this.context});display_value&&span.add(display_value),this.add(span),this.set("span",span)}}activate(){super.activate();var val=this.content.get(0).dom.el.innerHTML;this.value=val}}module.exports=Single_Line},{"../html-core/html-core":83}],63:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Toggle_Button=require("./toggle-button");jsgui.stringify,jsgui.each,jsgui.tof,jsgui.Control;class Start_Stop_Toggle_Button extends Toggle_Button{constructor(spec,add,make){spec.states=["start","stop"],spec.state=spec.state||"start",super(spec),this.__type_name="start_stop_toggle_button",this.add_class("start-stop toggle-button"),this.state=spec.state}activate(){if(!this.__active){super.activate(),console.log("activate Start_Stop_Toggle_Button");var that=this;this.on("change",function(e_change){var name=e_change.name,value=e_change.value;"state"===name&&("stop"===value&&that.raise("start"),"start"===value&&that.raise("stop"))})}}}module.exports=Start_Stop_Toggle_Button},{"../html-core/html-core":83,"./toggle-button":69}],64:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Radio_Button_Group=require("./radio-button-group"),Panel=require("./panel"),each=(jsgui.stringify,jsgui.each),tof=jsgui.tof,Control=(jsgui.is_defined,jsgui.Control);jsgui.fp,jsgui.group;class Tabs extends Control{constructor(spec,add,make){super(spec),this.__type_name="tabs",this.add_class("tabs");var context=this.context,that=this;if(!spec.abstract&&!spec.el){var t_panel,tabs=this.get("tabs").value(),rbg_items=[],panels=[];each(tabs,function(tab){"string"===tof(tab)&&(rbg_items.push(tab),(t_panel=new Panel({context:context,name:tab})).add_class("hidden"),panels.push(t_panel))});var rbg=new Radio_Button_Group({context:context,items:rbg_items});rbg.add_class("horizontal"),this.set("rbg",rbg),this.add(rbg),each(panels,function(panel){that.add(panel)})}}activate(){if(console.log("1) Activate Tabs"),!this.__active){console.log("2) Activate Tabs");var that=this;super.activate();var prev_showing_panel,showing_panel;this.get("rbg").on("change",!1,function(e_change){var checked_index=e_change.checked._index;prev_showing_panel=showing_panel,showing_panel=that.panel(checked_index),prev_showing_panel&&prev_showing_panel.hide(),showing_panel.show();var panel_name=showing_panel.get("name");e_change.tab_name=panel_name+"",that.raise("change",e_change)})}}}module.exports=Tabs},{"../html-core/html-core":83,"./panel":55,"./radio-button-group":58}],65:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Text_Input=require("./text-input"),Control=(jsgui.stringify,jsgui.each,jsgui.tof,jsgui.Control);String,String,String,String;class Text_Field extends Control{constructor(spec){super(spec),this.add_class("field");var left=new jsgui.div({context:this.context});left.add_class("left");var right=new jsgui.div({context:this.context});right.add_class("right"),this.add(left),this.add(right);var clearall=new jsgui.div({context:this.context});clearall.add_class("clearall"),this.add(clearall);var label=new jsgui.label({context:this.context}),text=this.get("text");label.add(text.value());var textInput=new Text_Input({context:this.context}),tiid=textInput._id();textInput.dom.attributes.id=tiid,textInput.dom.attributes.name=this.name,label.dom.attributes.for=tiid,textInput.dom.attributes.type=spec.type,left.add(label),right.add(textInput)}}module.exports=Text_Field},{"../html-core/html-core":83,"./text-input":66}],66:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Control=(jsgui.stringify,jsgui.each,jsgui.tof,jsgui.Control);String,String;class Text_Input extends Control{constructor(spec){this._super(spec),this.set("dom.tagName","input"),this.set("dom.attributes.type","input")}}module.exports=Text_Input},{"../html-core/html-core":83}],67:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Control=(jsgui.stringify,jsgui.each,jsgui.tof,jsgui.Control);String;class Title_Bar extends Control{constructor(spec){super(spec),this.add_class("title bar");var span=new jsgui.span({context:this.context});span.add(this.text),this.add(span)}}module.exports=Title_Bar},{"../html-core/html-core":83}],68:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Control=(jsgui.stringify,jsgui.each,jsgui.tof,jsgui.is_defined,jsgui.Control),Panel=require("./panel"),Title_Bar=require("./title-bar");String;class Titled_Panel extends Panel{constructor(spec){if(super(spec),this.__type_name="titled_panel",!spec.abstract&&!spec.el){var title_bar=new Title_Bar({context:this.context,text:this.title});title_bar.active(),this.add(title_bar);var inner_control=new Control({context:this.context});inner_control.active(),this.add(inner_control)}}activate(){super.activate();var title_bar=this.title_bar,inner_control=this.inner_control;console.log("title_bar",title_bar),console.log("inner_control",inner_control)}}module.exports=Titled_Panel},{"../html-core/html-core":83,"./panel":55,"./title-bar":67}],69:[function(require,module,exports){var jsgui=require("../html-core/html-core"),stringify=jsgui.stringify,each=jsgui.each,tof=jsgui.tof,Control=jsgui.Control;String,String,Array;class Toggle_Button extends Control{constructor(spec,add,make){(spec=spec||{}).__type_name=spec.__type_name||"toggle_button",super(spec),this.add_class("toggle-button"),this.active();var state,states,active_fields,spec_state=spec.state,spec_states=spec.states,that=this;if(spec_state&&(state=this.state=spec.state,active_fields||(active_fields={}),active_fields.state=state,!spec.abstract&&!spec.el)){var span_state=new jsgui.span({context:this.context});span_state.active(),span_state.add(state+""),that.add(span_state),that.span_state=span_state}spec_states&&(states=this.states=spec_states,active_fields||(active_fields={}),active_fields.states=states),active_fields&&"undefined"==typeof document&&(this.dom.attributes["data-jsgui-fields"]=stringify(active_fields).replace(/"/g,"'"),this.dom.attributes["data-jsgui-ctrl-fields"]=stringify({span_state:this.span_state._id()}).replace(/"/g,"'"))}get state(){return this._state}set state(value){var span_state=this.span_state;this._state=value;var that=this;if(span_state){span_state.clear();var tn_new_value=new jsgui.textNode({context:that.context,text:value});span_state.add(tn_new_value)}}activate(){if(!this.__active){super.activate(),console.log("toggle button activate");var that=this;this.on("click",function(e_click){console.log("toggle button clicked");var i_current_state,state=that.state,states=that.states;if("array"!==tof(states))throw"stop";each(states,function(i_state,i){i_state==state&&(i_current_state=i)});var i_next_state=i_current_state+1;i_next_state==states.length&&(i_next_state=0);var str_next_state=states[i_next_state];console.log("str_next_state",str_next_state),that.state=str_next_state})}}}module.exports=Toggle_Button},{"../html-core/html-core":83}],70:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Plus_Minus_Toggle_Button=require("./plus-minus-toggle-button"),Vertical_Expander=require("./vertical-expander"),stringify=jsgui.stringify,Control=(jsgui.each,jsgui.tof,jsgui.Control);class Tree_Node extends Control{constructor(spec,add,make){if(super(spec),this.__type_name="tree_node",!this._abstract&&"undefined"==typeof document){this.add_class("tree-node");var spec_state=spec.state;if(spec.img_src)img_src=this.img_src;if(spec.text&&this.set("text",spec.text),spec_state){if("expanded"!=spec_state&&"contracted"!=spec_state)throw'spec.state expects "expanded" or "contracted".';this.state=spec_state}else this.state="expanded";var top_line=add(Control({class:"top-line"})),plus_minus=make(Plus_Minus_Toggle_Button({}));top_line.add(plus_minus),plus_minus.hide();var img_src=this.img_src,img=make(jsgui.img({}));img.dom.attributes.src=img_src,top_line.add(img);var span=make(jsgui.span({})),text=this.text;span.add(text),top_line.add(span);add(Control({class:"clearall"}));var expander=add(Vertical_Expander({})),inner_control=make(Control({class:"inner"}));expander.add(inner_control);var inner_control_content=inner_control.content;inner_control_content.on("change",function(e_change){inner_control_content.length()>0&&plus_minus.show()}),this.toggle_button=plus_minus,this.inner_control=inner_control,this.expander=expander;var ctrl_fields={toggle_button:plus_minus._id(),inner_control:inner_control._id(),expander:expander._id()};this.set("dom.attributes.data-jsgui-ctrl-fields",stringify(ctrl_fields).replace(/"/g,"'")),this.active()}}activate(){super.activate();var toggle_button=this.toggle_button,expander=(this.inner_control,this.expander);toggle_button.on("toggle",function(e_toggle){console.log("tree-node toggle",e_toggle),expander.toggle()})}}module.exports=Tree_Node},{"../html-core/html-core":83,"./plus-minus-toggle-button":56,"./vertical-expander":72}],71:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Control=(jsgui.stringify,jsgui.each,jsgui.tof,jsgui.is_defined,jsgui.Control),Button=(jsgui.group,require("./button"));class Up_Down_Arrow_Buttons extends Control{constructor(spec){this.make;this._super(spec),this.add_class("up-down arrow buttons"),this.__type_name="up_down_arrow_buttons";var btn_up=new Button({context:this.context,text:"up"}),btn_down=new Button({context:this.context,text:"down"});this.add(btn_up),this.add(btn_down),this.set("btn_up",btn_up),this.set("btn_down",btn_down)}activate(){super.activate();var that=this,btn_up=this.btn_up,btn_down=this.btn_down,that=this;btn_up.on("click",function(e_click){that.raise("up")}),btn_down.on("click",function(e_click){that.raise("down")})}}module.exports=Up_Down_Arrow_Buttons},{"../html-core/html-core":83,"./button":34}],72:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Control=(jsgui.stringify,jsgui.each,jsgui.tof,jsgui.Control);class Vertical_Expander extends Control{constructor(spec){super(spec),this.add_class("vertical expander"),this.__type_name="vertical_expander",this.set("states",["open","closed"]),this.set("state",spec.state||"open")}activate(){console.log("Vertical Expander activate"),super.activate();var orig_height,el=this.dom.el,ui_close=function(){var h=el.childNodes[0].offsetHeight;console.log("h",h),orig_height=h,el.style.height=orig_height+"px",el.style.overflow="hidden",el.style.transition="height 0.08s linear",setTimeout(function(){el.style.height="0px"},0)},ui_open=function(){el.style.height=orig_height+"px";var fnTransitionEnd=function(e_end){console.log("fnTransitionEnd"),el.style.overflow="visible",el.removeEventListener("transitionend",fnTransitionEnd)};el.addEventListener("transitionend",fnTransitionEnd,!1)};this.get("state").on("change",function(e_change){console.log("Vertical_Expander state change",e_change);var val=e_change.value;"closed"==val&&ui_close(),"open"==val&&ui_open()})}toggle(){console.log("vertical-expander toggle");var state=this.state,v_state=state.value();console.log("state",state),"open"==v_state&&state.set("closed"),"closed"==v_state&&state.set("open")}}module.exports=Vertical_Expander},{"../html-core/html-core":83}],73:[function(require,module,exports){var jsgui=require("../../html-core/html-core"),factory=require("./factory"),each=(jsgui.stringify,jsgui.each),is_defined=(jsgui.tof,jsgui.is_defined),Control=jsgui.Control;jsgui.group;class Array_Viewer extends Control{constructor(spec){this.make;this._super(spec),this.add_class("array-viewer"),this.__type_name="array_viewer",this.factory||(this.factory=factory);this._context.req;is_defined(spec.value)&&this.set("value",spec.value);var that=this;if(!spec.el){var ctrlOpen=new Control({context:this._context});ctrlOpen.set("dom.attributes.class","array-open"),ctrlOpen.content.add("[");var ctrlInner=new Control({context:this._context});ctrlInner.set("dom.attributes.class","array-inner");var ctrlClose=new Control({context:this._context});ctrlClose.set("dom.attributes.class","array-close"),ctrlClose.content.add("]"),this.add(ctrlOpen),this.add(ctrlInner),this.add(ctrlClose),this.set("inner",ctrlInner),this.refresh_internal()}this.add_event_listener("change",function(e){e[0],e[1];that.refresh_internal()})}refresh_internal(){var inner=this.get("inner"),value=this.get("value"),first=!0,context=this._context,that=this;each(value,function(i,v){var comma_space;first||((comma_space=new jsgui.span({context:that._context})).content.push(", "),inner.add(comma_space));var ctrl=that.factory(v,context);inner.add(ctrl),first=!1})}activate(){this._super();var content=this.content,ctrl_open=this.set("open",content.get(0)),ctrl_close=this.set("close",content.get(2));jsgui.group_hover_class([ctrl_open,ctrl_close],"bg-light-yellow").selectable(this);var prev_comma_space;content.get(1).content.each(function(i,v){i%2?prev_comma_space=v:prev_comma_space&&prev_comma_space.selectable(v)})}}module.exports=Array_Viewer},{"../../html-core/html-core":83,"./factory":74}],74:[function(require,module,exports){var jsgui=require("../../html-core/html-core"),Object_Viewer=require("./object"),Array_Viewer=require("./array"),String_Viewer=require("./string"),Number_Viewer=require("./number"),tof=(jsgui.stringify,jsgui.each,jsgui.tof),create=(jsgui.is_defined,jsgui.Control,jsgui.group,function(obj,context){var tobj=tof(obj);if("object"==tobj)return res=new Object_Viewer({context:context,value:obj});if("array"==tobj)return res=new Array_Viewer({context:context,value:obj});if("string"==tobj)return res=new String_Viewer({context:context,value:obj});if("number"==tobj){var res=new Number_Viewer({context:context,value:obj});return res}if("data_value"==tobj){tof(val);return create(val,context)}});module.exports=create},{"../../html-core/html-core":83,"./array":73,"./number":75,"./object":77,"./string":78}],75:[function(require,module,exports){var jsgui=require("../../html-core/html-core"),tof=(jsgui.stringify,jsgui.each,jsgui.tof),is_defined=jsgui.is_defined,Control=jsgui.Control;class Number_Viewer extends Control{constructor(spec){super(spec);this.make;this.add_class("number-viewer"),this.__type_name="number_viewer";var span=new jsgui.span({context:this.context});is_defined(spec.value)&&this.set("value",spec.value),this.add(span),this.set("span",span),this.refresh_internal()}refresh_internal(){var value=this.get("value"),span_content=this.get("span").content,tval=tof(value);this._context,this.content;"data_value"==tval&&(span_content.clear(),span_content.push(value.value())),"number"==tval&&(span_content.clear(),span_content.push(value))}activate(){this._super();var that=this,content_val=this.get("span").content.get(0).value(),num=JSON.parse(content_val);this.set("value",num),that.selectable(),jsgui.hover_class(this,"bg-light-yellow")}}module.exports=Number_Viewer},{"../../html-core/html-core":83}],76:[function(require,module,exports){var jsgui=require("../../html-core/html-core"),tof=(require("./factory"),jsgui.stringify,jsgui.each,jsgui.tof),is_defined=jsgui.is_defined,Control=jsgui.Control;class Object_KVP_Viewer extends Control{constructor(spec){super(spec),this.add_class("object-kvp-viewer"),this.__type_name="object_kvp_viewer";var that=this;is_defined(spec.key)&&this.set("key",spec.key);var val;is_defined(spec.value)&&(val=spec.value,this.set("value",spec.value));var mode=this.mode;if(spec.mode||(spec.mode="json"),mode||(mode=spec.mode,this.mode=mode),this.add_class(mode),!spec.el){var ctrl_string_key=new that.String({context:this._context,text:spec.key,mode:mode}),ctrl_value_container=new Control({context:this.context});ctrl_value_container.add_class("object-kvp-value-viewer");var ctrl_value;if(is_defined(val)){var t_val=tof(val);"string"==t_val&&(ctrl_value=new that.String({context:this.context,value:val})),"number"==t_val&&(ctrl_value=new that.Number({context:this.context,value:val})),ctrl_value&&ctrl_value_container.add(ctrl_value)}var ctrlClose=new Control({context:this.context});if(ctrlClose.add_class("object-close"),ctrlClose.content.add("}"),this.ctrl_key=ctrl_string_key,this.ctrl_value=ctrl_value,this.add(ctrl_string_key),"json"==mode){var span_key_colon_space=new jsgui.span({context:this.context});span_key_colon_space.content.add(": "),this.add(span_key_colon_space)}this.add(ctrl_value_container)}}refresh_internal(){var key=this.key,value=this.value,key_content=(this.content,ctrl_key.span);if(key){key_content.add(key);var vcon=ctrl_value.content;vcon.clear();var ctrl_viewer=this.factory(value,this.context);vcon.push(ctrl_viewer)}}activate(el){var mode=this.mode;this._super(el);(el=el||this.dom.el).childNodes;var ctrl_key,ctrl_value,content=this.content,clength=content.length;if("json"===mode){if(3===clength||4===clength){var content_key=content.get(0);ctrl_key=this.ctrl_key=content_key,ctrl_value=this.ctrl_value=content.get(2)}4==clength&&(this.ctrl_comma=content.get(4))}else ctrl_key=this.ctrl_key,ctrl_value=this.ctrl_value;if(clength>4)throw"stop";console.log("ctrl_key",ctrl_key);var key_content=ctrl_key.content,value_value=ctrl_value.value;console.log("value_value",value_value);var ctrl_key_open_quote,ctrl_key_content,ctrl_key_close_quote,ctrl_key_colon_space;if(4===key_content.length){ctrl_key_open_quote=key_content.get(0),ctrl_key_content=key_content.get(1),ctrl_key_close_quote=key_content.get(2),ctrl_key_colon_space=key_content.get(3);jsgui.group_hover_class([ctrl_key_open_quote,ctrl_key_close_quote],"bg-light-yellow").click_to_select(this),jsgui.hover_class(ctrl_key_content,"bg-light-yellow"),ctrl_key_content.click_to_select(),ctrl_key_colon_space.click_to_select(this)}}}module.exports=Object_KVP_Viewer},{"../../html-core/html-core":83,"./factory":74}],77:[function(require,module,exports){var jsgui=require("../../html-core/html-core"),Object_KVP_Viewer=require("./object-kvp"),factory=require("./factory"),stringify=jsgui.stringify,each=jsgui.each,is_defined=(jsgui.tof,jsgui.is_defined),Control=jsgui.Control;class Object_Viewer extends Control{constructor(spec){this.make;super(spec),this.factory||(this.factory=factory),this.add_class("object-viewer"),this.__type_name="object_viewer";this.context.req;if(is_defined(spec.value)&&(this.value=spec.value),!spec.el){var ctrlOpen=new Control({context:this.context});ctrlOpen.add_class("object-open"),ctrlOpen.content.add("{");var ctrlOpenID=ctrlOpen._id(),ctrlInner=new Control({context:this.context});ctrlInner.add_class("object-inner");var ctrlClose=new Control({context:this.context});ctrlClose.add_class("object-close"),ctrlClose.content.add("}");var ctrlCloseID=ctrlClose._id();this.add(ctrlOpen),this.add(ctrlInner),this.add(ctrlClose),this.inner=ctrlInner;var ctrl_fields={open:ctrlOpenID,close:ctrlCloseID,inner:ctrlInner._id()};this.set("dom.attributes.data-jsgui-ctrl-fields",stringify(ctrl_fields).replace(/"/g,"'")),this.refresh_internal()}}refresh_internal(){var value=this.value,inner=this.inner;inner.clear();var prev_kvp,context=this._context,that=this,first=!0;each(value,function(v,i){if(!first){var comma=new jsgui.span({context:context});comma.content.push(","),prev_kvp.content.push(comma)}var kvp_viewer=new Object_KVP_Viewer({context:context,key:i,value:v});that.factory(v,context);inner.add(kvp_viewer),first=!1,prev_kvp=kvp_viewer})}activate(){super.activate();var ctrl_open=this.open,ctrl_close=this.close,ctrl_inner=this.inner,that=this;jsgui.group_hover_class([ctrl_open,ctrl_close],"bg-light-yellow").selectable(this);var prev_comma;ctrl_inner.content.each(function(ctrl_kvp,i){var ckvp=ctrl_kvp.content;if(prev_comma&&prev_comma.click(function(e){ctrl_kvp.action_select_only()}),3==ckvp.length()){var comma=ckvp.get(2);prev_comma=comma}}),this.on("change",function(e_change){that.refresh_internal()}),console.log("this._bound_events",this._bound_events)}}module.exports=Object_Viewer},{"../../html-core/html-core":83,"./factory":74,"./object-kvp":76}],78:[function(require,module,exports){var jsgui=require("../../html-core/html-core"),tof=(jsgui.stringify,jsgui.each,jsgui.tof),is_defined=jsgui.is_defined,Control=jsgui.Control,extend=(jsgui.group,jsgui.extend);class String_Viewer extends Control{constructor(spec){this.make;this._super(spec),this.add_class("string-viewer"),this.__type_name="string_viewer";var el=spec.el;console.log("string viewer init el",el),is_defined(spec.value)&&this.set("value",spec.value);var mode=spec.mode=spec.mode||"json";if(!el){if("json"==mode){var span_open=new jsgui.span({context:this._context});span_open.add('"'),this.add(span_open)}var span=new jsgui.span({context:this._context});if(span.set("dom.attributes.class","single-line"),this.add(span),this.set("span",span),span.add(spec.text),"json"==mode){var span_close=new jsgui.span({context:this._context});span_close.add('"'),this.add(span_close)}"undefined"==typeof document&&extend(this._fields=this._fields||{},{mode:mode})}}refresh_internal(){var value=this.get("value"),span_content=this.get("span").content,tval=tof(value);this._context,this.content;"data_value"==tval&&(span_content.clear(),span_content.push(value.value()))}activate(){this._super();var that=this,content=this.content,mode=this.get("mode");if(console.log("mode",mode),console.log("mode "+mode),"json"==mode){var ctrl_open=this.set("open",content.get(0));console.log("ctrl_open",ctrl_open);var span=this.set("span",content.get(1));console.log("span",span);value=span.dom.el.innerHTML;jsgui.hover_class(span,"bg-light-yellow");var ctrl_close=this.set("close",content.get(2));jsgui.group_hover_class([ctrl_open,ctrl_close],"bg-light-yellow").click(function(e){e.ctrlKey?that.action_select_toggle():that.action_select_only()}),span.selectable()}if("tabular"==mode)var value=(span=this.get("span")).dom.el.innerHTML;this.set("value",value)}}module.exports=String_Viewer},{"../../html-core/html-core":83}],79:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Horizontal_Menu=require("./horizontal-menu"),Control=(jsgui.stringify,jsgui.each,jsgui.tof,jsgui.is_defined,jsgui.Control);String;class Window extends Control{constructor(spec,add,make){if(super(spec),this.__type_name="window",this.add_class("window"),!spec.abstract&&!spec.el){var div_relative=add(Control({class:"relative"})),title_bar=div_relative.add(make(Control({class:"title bar"}))),dv_title=this.title,title_h2=make(jsgui.h2());if(title_bar.add(title_h2),dv_title){var title=dv_title.value();title_h2.add(title)}var inner_control=div_relative.add(make(Control({class:"inner"})));this.inner_control=inner_control,this.title_bar=title_bar,this.ctrl_relative=div_relative}}resizable(){this.set("resizable","right-bottom"),this.set("dom.attributes.data-jsgui-fields","{'resizable': 'right-bottom'}")}activate(){if(!this.__active){super.activate();var context=this.context;this.get("ctrl_relative");this.title_bar.drag_handle_to(this);var resizable=this.get("resizable");if(resizable&&resizable.value&&(resizable=resizable.value()),"right-bottom"==resizable){var resize_handle=new Control({class:"right-bottom resize-handle",context:context}),size=this.size(),x=size[0]-16,y=size[1]-16;resize_handle.style({left:x+"px",top:y+"px"})}}}menu(menu_spec){var h_menu_spec={value:menu_spec,context:this.context},h_menu=new Horizontal_Menu(h_menu_spec),ic=this.inner_control;ic.parent;h_menu.insert_before(ic),h_menu.active()}}module.exports=Window},{"../html-core/html-core":83,"./horizontal-menu":45}],80:[function(require,module,exports){jsgui=require("../../client/client"),page_context=new jsgui.Client_Page_Context({document:document}),window.onload=function(){}},{"../../client/client":29}],81:[function(require,module,exports){var jsgui=require("../lang/lang"),get_a_sig=jsgui.get_a_sig,remove_sig_from_arr_shell=jsgui.remove_sig_from_arr_shell,each=jsgui.each,clone=jsgui.clone,Evented_Class=jsgui.Evented_Class,Data_Value=jsgui.Data_Value,Data_Object=jsgui.Data_Object,Collection=jsgui.Collection,tof=jsgui.tof,stringify=jsgui.stringify;class DOM_Attributes extends Evented_Class{constructor(spec){super(spec)}set(key,value){var old=this[key];this[key]=value,this.raise("change",{key:key,old:old,new:value})}}class Control_DOM{constructor(){this.attrs=this.attributes=new DOM_Attributes}}class Control_Core extends Data_Object{constructor(spec){(spec=spec||{}).__type_name=spec.__type_name||"control",super(spec),this.mapListeners={},this.__type="control";var spec_content;if(this.dom=new Control_DOM,!this._abstract){var tagName=spec.tagName||spec.tag_name||"div";if(this.dom.tagName=tagName,this._icss={},spec_content=spec.content){var tsc=tof(spec_content);if("array"==tsc)throw"Content array not yet supported here.";"string"!=tsc&&"control"!=tsc||this.content.add(spec_content)}spec.el&&(this.dom.el=spec.el);var context=this.context;context&&context.register_control&&context.register_control(this),spec.class&&this.dom.attrs.set("class",spec.class);this.content=new Collection({})}}get size(){}set size(value){}get color(){}set color(value){}post_init(spec){spec&&!0===spec.id&&this.set("dom.attributes.id",this._id())}_get_amalgamated_style(arr_contexts){return clone(this._.style)}_get_rendered_inline_css_dict(){var ast=this.get_amalgamated_style();return get_inline_css_dict_from_style(ast)}property_css_transition_duration(style_property_name){if(this.has("_.s.transition")){var tr=this._.s.transition;if(tr[style_property_name])return tr[style_property_name][0]}}has(item_name){for(var s,arr=item_name.split("."),c=0,l=arr.length,i=this;c<l;){if(s=arr[c],void 0===i[s])return!1;i=i[s],c++}return i}renderDomAttributes(){this.beforeRenderDomAttributes&&this.beforeRenderDomAttributes();var dom_attrs=this.dom.attributes;if(dom_attrs){if(this._ctrl_fields){for(var obj_ctrl_fields={},keys=Object.keys(this._ctrl_fields),c=0,l=keys.length;c<l;c++)"_bound_events"!==(key=keys[c])&&(obj_ctrl_fields[key]=this._ctrl_fields[key]._id());dom_attrs.set("data-jsgui-ctrl-fields",stringify(obj_ctrl_fields).replace(/"/g,"'"))}this._fields&&dom_attrs.set("data-jsgui-fields",stringify(this._fields).replace(/"/g,"[DBL_QT]").replace(/'/g,"[SNG_QT]"));for(var key,item,arr=[],dom_attrs_keys=Object.keys(dom_attrs),c=0,l=dom_attrs_keys.length;c<l;c++)"_bound_events"!==(key=dom_attrs_keys[c])&&(item=dom_attrs[key],arr.push(" ",key,'="',item,'"'));return arr.join("")}throw"expecting dom_attrs"}renderBeginTagToHtml(){var tagName=this.dom.tagName;return!1===tagName?"":["<",tagName,this.renderDomAttributes(),">"].join("")}renderEndTagToHtml(){var tagName=this.dom.tagName,noClosingTag=this.dom.noClosingTag;return!1===tagName||noClosingTag?"":["</",tagName,">"].join("")}renderHtmlAppendment(){return this.htmlAppendment||""}renderEmptyNodeJqo(){return[this.renderBeginTagToHtml(),this.renderEndTagToHtml(),this.renderHtmlAppendment()].join("")}iterate_this_and_subcontrols(ctrl_callback){ctrl_callback(this);var tv;this.content.each(function(v){"string"==(tv=tof(v))||"data_value"==tv||v&&v.iterate_this_and_subcontrols&&v.iterate_this_and_subcontrols.call(v,ctrl_callback)})}all_html_render(callback){if(callback){var that=this,arr_waiting_controls=[];if(this.iterate_this_and_subcontrols(function(control){"waiting"==control.__status&&arr_waiting_controls.push(control)}),0==arr_waiting_controls.length){var html=this.all_html_render();callback(null,html)}else{var c=arr_waiting_controls.length,complete=function(){if(that.pre_all_html_render(),that.dom){var html=[that.renderBeginTagToHtml(),that.all_html_render_internal_controls(),that.renderEndTagToHtml(),that.renderHtmlAppendment()].join("");callback(null,html)}};each(arr_waiting_controls,function(control,i){control.on("ready",function(e_ready){0==--c&&complete()})})}}else if(this.pre_all_html_render(),this.dom)return[this.renderBeginTagToHtml(),this.all_html_render_internal_controls(),this.renderEndTagToHtml(),this.renderHtmlAppendment()].join("")}render_content(){var content=this.content;if(!content.length)throw console.log("!!!no content length!!!"),console.log(""),console.log(this),console.log(""),console.trace(),console.log("content",content),console.log("tof(content) "+tof(content)),"stop";var tn,c,n,contentLength=content.length(),res=new Array(contentLength),arr=content._arr,l=arr.length;for(c=0;c<l;c++)if(n=arr[c],"string"==(tn=tof(n))&&res.push(jsgui.output_processors.string(n)),"data_value"==tn)res.push(n._);else{if("data_object"==tn)throw"stop";res.push(n.all_html_render())}return res.join("")}all_html_render_internal_controls(){return this.render_content()}pre_all_html_render(){}compose(){}wait(callback){setTimeout(function(){callback()},0)}visible(callback){this.style("display","block",callback)}transparent(callback){this.style("opacity",0,callback)}opaque(callback){return this.style({opacity:1},callback)}chain(arr_chain,callback){var pos_in_chain=0,that=this,process_chain=function(){if(pos_in_chain<arr_chain.length){var item=arr_chain[pos_in_chain];if("array"==tof(item)){var count=item.length,cb=function(){0==--count&&(pos_in_chain++,process_chain())};each(item,function(i,v){that.fn_call(v,function(){cb()})})}else that.fn_call(item,function(){pos_in_chain++,process_chain()})}else callback&&callback.call(that)};process_chain()}fn_call(call,callback){var fn,params,t=tof(call),that=this;if("string"==t)return fn=this[call],params=[],callback?fn.call(this,callback):fn.call(this);if("array"==t)return fn=this[call[0]],params=call.slice(1),callback&&params.push(callback),fn.apply(this,params);if("object"==t){var count=0;each(call,function(i,v){count++}),each(call,function(i,v){var cb=function(){0==--count&&callback.call(that)};that.fn_call([i,v],cb)})}}transition(value,callback){return this.style({transition:value},callback)}transit(){var a=arguments;a.l=arguments.length;var sig=get_a_sig(a,1),that=this;if("[[n,s],o]"==remove_sig_from_arr_shell(sig))return this.transit(a[0][0],a[0][1]);if("[[[n,s],o],f]"===sig){var transit=a[0],callback=a[1],duration_and_tf=transit[0],map_values=transit[1];this.transit(duration_and_tf,map_values,callback)}else if("[[n,s],o,f]"===sig){var duration_and_tf=a[0],map_values=a[1],callback=a[2],transition={};each(map_values,function(i,v){transition[i]=duration_and_tf}),that.transition(transition),each(map_values,function(i,v){that.style(i,v)})}else if(2===a.length){var duration_and_tf=a[0],duration_and_tf=a[0],map_values=a[1],transition={};each(map_values,function(i,v){transition[i]=duration_and_tf}),that.transition(transition),each(map_values,function(i,v){that.style(i,v)})}}add(new_content){var tnc=tof(new_content);if("array"==tnc){var res=[],that=this;return each(new_content,function(i,v){res.push(that.add(v))}),res}if(new_content){"string"===tnc||new_content.context||this.context&&(new_content.context=this.context);var inner_control=this.inner_control;return inner_control?inner_control.content.add(new_content):this.content.add(new_content)}}insert_before(target){var target_parent=target.parent,target_index=target._index;target_parent.content.insert(this,target_index)}toJSON(){var res=[];return res.push("Control("+stringify(this._)+")"),res.join("")}style(){var a=arguments;a.l=arguments.length;var sig=get_a_sig(a,1);if("[s]"==sig){var styleName=a[0],el=this.dom.el;return getComputedStyle(el)[styleName]}if("[s,s,b]"==sig){var styleName=a[0],styleValue=a[1];a[2]}if("[s,s]"==sig||"[s,n]"==sig)var styleName=a[0],styleValue=a[1];if(styleName&&void 0!==styleValue){this._icss[styleName]=styleValue;var str_css="";each(this._icss,function(item_style_value,item_style_name){str_css=str_css+item_style_name+":"+item_style_value+";"})}var that=this;if("[o]"==sig){each(a[0],function(v,i){that.style(i,v,!1)});var style=this.dom.attributes.style;(el=this.value("dom.el"))&&(el.style.cssText=style)}}active(){var id=this._id(),dom=this.dom,dom_attributes=dom.attributes;dom_attributes||(dom_attributes=dom.get("attributes")),dom_attributes["data-jsgui-id"]=new Data_Value({value:id}),dom_attributes["data-jsgui-type"]=new Data_Value({value:this.__type_name});var el;dom.el&&(el=dom.el),el&&1===el.nodeType&&(el.setAttribute("data-jsgui-id",id),el.setAttribute("data-jsgui-type",this.__type_name));var tCtrl;this.content.each(function(ctrl){"control"===(tCtrl=tof(ctrl))&&ctrl.active()})}find_selection_scope(){var res=this.selection_scope;return res||(this.parent?this.parent.find_selection_scope():void 0)}click(handler){this.add_event_listener("click",handler)}hover(fn_in,fn_out){this.add_event_listener("mouseover",function(e){fn_in()}),this.add_event_listener("mouseout",function(e){fn_out()})}add_class(class_name){var cls=this.dom.attrs.class;this.dom.el;if(cls){var tCls=tof(cls);if("object"==tCls){cls[class_name]=!0;var arr_class=[];each(cls,function(i,v){v&&arr_class.push(i)});arr_class.join(" ");this.dom.attrs.set("class",str_cls)}else if("data_value"==tCls){for(var already_has_class=!1,l=(arr_classes=cls.value().split(" ")).length,c=0;c<l&!already_has_class;)arr_classes[c]==class_name&&(already_has_class=!0),c++;already_has_class||arr_classes.push(class_name);str_cls=arr_classes.join(" ");this.dom.attrs.set("class",str_cls)}else if("string"==tCls){for(var arr_classes=cls.split(" "),already_has_class=!1,l=arr_classes.length,c=0;c<l&!already_has_class;)arr_classes[c]==class_name&&(already_has_class=!0),c++;already_has_class||arr_classes.push(class_name);var str_cls=arr_classes.join(" ");this.dom.attrs.set("class",str_cls)}}else this.dom.attrs.set("class",str_cls)}remove_class(class_name){var cls=this.dom.attributes.class;this.dom.el;if(cls){var tCls=tof(cls);if("object"==tCls){var arr_class=[];each(cls,function(i,v){i==class_name&&(cls[i]=!1),cls[i]&&arr_class.push(i)});arr_class.join(" ");this.dom.attrs.set("class",str_cls)}if("string"==tCls){for(var arr_res=[],l=(arr_classes=cls.split(" ")).length,c=0;c<l;)console.log("arr_classes[c]",arr_classes[c]),arr_classes[c]!=class_name&&arr_res.push(arr_classes[c]),c++;str_cls=arr_res.join(" ");console.log("str_cls",str_cls),this.dom.attrs.set("class",str_cls)}if("data_value"==tCls){for(var arr_classes=cls.value().split(" "),arr_res=[],l=arr_classes.length,c=0;c<l;)arr_classes[c]!=class_name&&arr_res.push(arr_classes[c]),c++;var str_cls=arr_res.join(" ");this.dom.attrs.set("class",str_cls)}}}hover_class(class_name){var that=this;that.hover(function(e_in){that.add_class(class_name)},function(e_out){that.remove_class(class_name)})}matches_selector(selector){}is_ancestor_of(target){var t_target=tof(target),el=this.dom.el,inner=function(target2){if(target2==el)return!0;var parent=target2.parentNode;return!!parent&&inner(parent)};if("object"==t_target&&el!=target){var parent=target.parentNode;if(parent)return inner(parent)}}find_selected_ancestor_in_scope(){if(this.selection_scope===this.parent.selection_scope){var psel=parent.selected;return psel&&psel.value&&1==psel.value()?parent:parent.find_selected_ancestor_in_scope()}}remove(){var el=this.dom.el;el&&el.parentNode&&el.parentNode.removeChild(el)}shallow_copy(){console.log("Control shallow_copy");var res=new Control({context:this.context}),cl=this.dom.attributes.class,map_class_exclude={"bg-light-yellow":!0,selected:!0};each(cl.split(" "),function(i,v){i&&!map_class_exclude[i]&&res.add_class(i)});var res_content=res.content;return this.content.each(function(v,i){"data_value"==tof(v)?res_content.add(v.value()):res_content.add(v.shallow_copy())}),res}get color(){}set color(value){var input_processor=jsgui.input_processors.color,output_processor=jsgui.output_processors.color,processed=input_processor(value);this.set("color",processed,!1);var html_color=output_processor(processed),color_property_name=this.color_property_name||"background-color";this.style(color_property_name,html_color)}get offset(){var el=this.dom.el;return[el.offsetLeft,el.offsetTop]}set offset(value){this.style({left:a[0]+"px",top:a[1]+"px"})}clear(){return this.content.clear()}activate(){}}Control_Core.prototype.connect_fields=!0,module.exports=Control_Core},{"../lang/lang":94}],82:[function(require,module,exports){var jsgui=require("../lang/lang"),is_ctrl=jsgui.is_ctrl,get_a_sig=jsgui.get_a_sig,each=(jsgui.fp,jsgui.each),Control_Core=require("./control-core"),tof=jsgui.tof,desc=function(ctrl,callback){if(ctrl.get){var content=ctrl.get("content"),t_content=typeof content;if("string"===t_content||"number"===t_content);else{var c,t_item,arr=content._arr,l=arr.length;for(c=0;c<l;c++)"string"===(t_item=typeof arr[c])||"numbers"===t_item||(callback(arr[c]),desc(arr[c],callback))}}},dom_desc=function(el,callback){callback(el);for(var cns=el.childNodes,l=cns.length,c=0;c<l;c++)dom_desc(cns[c],callback)},mapDomEventNames={change:!0,click:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,blur:!0,focus:!0,keydown:!0,keyup:!0,keypress:!0,contextmenu:!0,touchstart:!0,touchmove:!0,touchend:!0,abort:!0,canplay:!0,canplaythrough:!0,durationchange:!0,emptied:!0,ended:!0,error:!0,loadeddata:!0,loadedmetadata:!0,loadstart:!0,pause:!0,play:!0,playing:!0,progress:!0,ratechange:!0,seeked:!0,seeking:!0,stalled:!0,suspend:!0,timeupdate:!0,volumechange:!0,waiting:!0};class Control extends Control_Core{constructor(spec){if(spec.el){var jgf=spec.el.getAttribute("data-jsgui-fields");if(jgf){var s_pre_parse=jgf.replace(/\[DBL_QT\]/g,'"').replace(/\[SNG_QT\]/g,"'");s_pre_parse=s_pre_parse.replace(/\'/g,'"');var props=JSON.parse(s_pre_parse);Object.assign(spec,props)}}if(super(spec),void 0!==spec.selection_scope){this.selection_scope=selection_scope;var scrollbars=this.scrollbars;console.log("scrollbars",scrollbars);if("both"===scrollbars||"horizontal"===scrollbars||"vertical"===scrollbars){!0;var scroll_view=new Scroll_View({context:this.context});this.add(scroll_view)}}spec.is_selectable&&this.selectable()}bcr(){var a=arguments;a.l=arguments.length;var sig=get_a_sig(a,1);if("[]"==sig){var bcr=this.dom.el.getBoundingClientRect();return[[bcr.left,bcr.top],[bcr.right,bcr.bottom],[bcr.width,bcr.height]]}if("[a]"==sig){console.log("bcr sig arr");var bcr_def=a[0],pos=bcr_def[0],size=(bcr_def[1],bcr_def[2]);this.style({position:"absolute",left:pos[0]+"px",top:pos[1]+"px",width:size[0]+"px",height:size[1]+"px"})}}add_text(value){var tn=new Text_Node({context:this.context,text:value+""});return this.add(tn),tn}computed_style(){var a=arguments;a.l=arguments.length;var y;if("[s]"==get_a_sig(a,1)){var property_name=a[0],el=this.dom.el;return el.currentStyle?y=el.currentStyle[styleProp]:window.getComputedStyle&&(y=document.defaultView.getComputedStyle(el,null).getPropertyValue(property_name)),y}}padding(){var a=arguments;if(a.l=arguments.length,"[]"==get_a_sig(a,1)){var top,right,bottom,s_c_padding=this.computed_style("padding").split(" ");if(3==s_c_padding.length)return top=parseInt(s_c_padding[0],10),right=parseInt(s_c_padding[1],10),bottom=parseInt(s_c_padding[2],10),[0,top,right,bottom]}}border(){var a=arguments;if(a.l=arguments.length,"[]"==get_a_sig(a,1)){var c_border=this.computed_style("border");throw console.log("c_border",c_border),"stop"}}border_thickness(){var a=arguments;if(a.l=arguments.length,"[]"==get_a_sig(a,1)){var c_border=this.computed_style("border");console.log("c_border",c_border);var s_c_border=c_border.split(", ").join("").split(" ");return console.log("s_c_border",s_c_border),parseInt(s_c_border[0],10)}}cover(){}ghost(){}absolute_ghost_clone(){var type_name=this.__type_name,id=this._id(),context=this.context;console.log("context",context);var ctrl_document=context.ctrl_document;console.log("ctrl_document",ctrl_document),console.log("type_name",type_name);var Cstr=context.map_Controls[type_name];console.log("Cstr",Cstr);var new_id=id+"_clone";if(!context.map_controls[new_id]){var new_ctrl=new Cstr({context:context,id:new_id});console.log("new_ctrl",new_ctrl);var body=ctrl_document.content().get(1),css_class=this.get("dom.attributes.class");new_ctrl.set("dom.attributes.class",css_class);var my_contents=this.content;each(my_contents,function(v,i){console.log("i",i),console.log("v",v);var v_clone=v.clone();console.log("v_clone",v_clone),v_clone instanceof jsgui.Data_Value?new_ctrl.add(v_clone.value()):new_ctrl.add(v_clone)}),console.log("this",this);var my_bcr=this.bcr();console.log("my_bcr",my_bcr);var my_padding=this.padding();console.log("my_padding",my_padding),my_bcr[2][0]=my_bcr[2][0]-my_padding[0],my_bcr[2][1]=my_bcr[2][1]-my_padding[1],my_bcr[2][0]=my_bcr[2][0]-my_padding[2],my_bcr[2][1]=my_bcr[2][1]-my_padding[3];var my_border_thickness=this.border_thickness();console.log("my_border_thickness",my_border_thickness),"number"==tof(my_border_thickness)&&(my_bcr[2][0]=my_bcr[2][0]-2*my_border_thickness,my_bcr[2][1]=my_bcr[2][1]-2*my_border_thickness),new_ctrl.bcr(my_bcr),console.log("new_ctrl",new_ctrl),body.add(new_ctrl);var new_el=new_ctrl.dom.el;console.log("new_el",new_el)}}set(name,value){void 0!==value?(is_ctrl(value)&&((this._ctrl_fields=this._ctrl_fields||{})[name]=value),Control_Core.prototype.set.call(this,name,value)):Control_Core.prototype.set.call(this,name)}one_mousedown_anywhere(callback){var that=this;this.context.body().one("mousedown",function(e_mousedown){that.dom.el;var e_el=e_mousedown.srcElement||e_mousedown.target,iao=that.is_ancestor_of(e_el);e_mousedown.within_this=iao,callback(e_mousedown)})}activate_recursive(){var el=this.dom.el,map_controls=this.context.map_controls;recursive_dom_iterate_depth(el,function(el2){if(1==el2.nodeType){var jsgui_id=el2.getAttribute("data-jsgui-id");if(console.log("jsgui_id "+jsgui_id),jsgui_id){var ctrl=map_controls[jsgui_id];console.log("jsgui_id",jsgui_id),console.log("!!ctrl",!!ctrl),ctrl.__active||ctrl.activate(el2)}}})}add_dom_event_listener(event_name,fn_handler){console.log("add_dom_event_listener",event_name,this.__id);var listener=this._bound_events[event_name],el=this.dom.el;if(console.log("el",el),console.trace(),el){console.log("listener",listener);var t_listener=tof(listener);console.log("t_listener",t_listener),console.log("pre el addEventListener"),"array"===t_listener?(console.log("listener.length",listener.length),each(listener,listener=>{el.addEventListener(event_name,listener,!1)})):el.addEventListener(event_name,listener,!1)}}add_event_listener(){var a=arguments;a.l=arguments.length;var sig=get_a_sig(a,1);if(console.log("control-enh add_event_listener sig",sig),2===a.l&&super.add_event_listener(a[0],a[1]),3===a.l&&super.add_event_listener(a[0],a[2]),"[s,f]"===sig||"[s,b,f]"===sig){var event_name=a[0],using_dom=!0;3===a.l&&!1===a[1]&&(using_dom=!1);var fn_handler;2===a.l&&(fn_handler=a[1]),3===a.l&&(fn_handler=a[2]),mapDomEventNames[a[0]]&&using_dom&&(console.log("pre call add_dom_event_listener from add_event_listener"),console.log("this.dom.el",!!this.dom.el),this.add_dom_event_listener(event_name,fn_handler))}}activate(el){this.__active||(this.__active=!0,el&&(this.dom.el=el),this.activate_dom_attributes(),this.activate_content_controls(),this.activate_content_listen(),this.activate_other_changes_listen())}activate_other_changes_listen(){var dom_attributes=this.dom.attrs,el=this.dom.el;dom_attributes.on("change",function(e_change){var property_name=e_change.name||e_change.key,dval=e_change.value||e_change.new,t_dval=tof(dval);"string"==t_dval||"number"==t_dval||(dval=dval.value()),el&&1===el.nodeType&&el.setAttribute(property_name,dval)})}activate_content_listen(){var content=this.content,that=this,context=this.context;context.map_controls;content.on("change",function(e_change){var itemDomEl,el,dv_el=that.dom.el;dv_el&&(el=dv_el);var type=e_change.type;if("insert"===type){var item=e_change.item,retrieved_item_dom_el=item.dom.el;if("string"===tof(retrieved_item_dom_el))itemDomEl=retrieved_item_dom_el;else if(retrieved_item_dom_el&&console.log("keys dv_item_dom_el",Object.keys(retrieved_item_dom_el)),retrieved_item_dom_el&&(itemDomEl=dv_item_dom_el.value()),itemDomEl||context.map_els[item._id()]&&(itemDomEl=context.map_els[item._id()]),!itemDomEl){var item_tag_name="div",dv_tag_name=item.dom.tagName;dv_tag_name&&(item_tag_name=dv_tag_name);var temp_el;if("circle"==item_tag_name||"line"==item_tag_name||"polyline"==item_tag_name){var temp_svg_container=e_change.item.context.document.createElement("div");temp_svg_container.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" version="1.1">'+e_change.item.all_html_render()+"</svg>",itemDomEl=temp_svg_container.childNodes[0].childNodes[0]}else(temp_el=e_change.item.context.document.createElement("div")).innerHTML=e_change.item.all_html_render(),itemDomEl=temp_el.childNodes[0];e_change.item.dom.el=itemDomEl,item.active()}"string"===tof(itemDomEl)&&(itemDomEl=document.createTextNode(itemDomEl)),el.appendChild(itemDomEl)}"clear"===type&&el&&(el.innerHTML="")})}rec_desc_ensure_ctrl_el_refs(el){el=el||this.dom.el;var context=this.context,that=this;if(el){var jsgui_id,map_els={};dom_desc(el,function(el){el.getAttribute&&(jsgui_id=el.getAttribute("data-jsgui-id"))&&(map_els[jsgui_id]=el,context.map_els[jsgui_id]=el)}),desc(this,function(ctrl){var t_ctrl=tof(ctrl);if(ctrl!==that&&"control"===t_ctrl){var id=ctrl._id();map_els[id]&&ctrl.dom.el!==map_els[id]&&(ctrl.dom.el=map_els[id])}})}}rec_desc_activate(){desc(this,function(ctrl){"control"===tof(ctrl)&&ctrl.activate()})}activate_content_controls(){var el=this.dom.el;if(el){var c,l,context=this.context,ctrl_fields={},that=this,my_content=this.content,str_ctrl_fields=el.getAttribute("data-jsgui-ctrl-fields");str_ctrl_fields&&(ctrl_fields=JSON.parse(str_ctrl_fields.replace(/'/g,'"')));var key,value,ctrl_fields_keys=Object.keys(ctrl_fields),l_ctrl_fields_keys=ctrl_fields_keys.length;for(c=0;c<l_ctrl_fields_keys;c++){value=ctrl_fields[key=ctrl_fields_keys[c]];var referred_to_control=context.map_controls[value];that[key]=referred_to_control}var cns=el.childNodes,content=this.content;for(c=0,l=cns.length;c<l;c++){var cn=cns[c];if(cn){var nt=cn.nodeType;if(1==nt){var cn_jsgui_id=cn.getAttribute("data-jsgui-id"),cctrl=context.map_controls[cn_jsgui_id],found=!1;if(cctrl){var ctrl_id=cctrl.__id;ctrl_id&&content.each(function(v,i){v.__id&&v.__id==ctrl_id&&(found=!0)}),found||my_content.add(cctrl)}}if(3==nt){var val=cn.nodeValue;content.push(val)}}}}this.rec_desc_activate()}activate_dom_attributes(){var el=this.dom.el,dom_attributes=this.dom.attributes;if(el)for(var i=0,attrs=el.attributes,l=attrs.length;i<l;i++){var item=attrs.item(i),name=item.name,value=item.value;if("data-jsgui-id"==name);else if("data-jsgui-type"==name);else if("style"==name)for(var map_inline_css=this._icss,arr_style_items=value.split(";"),c=0,l2=arr_style_items.length;c<l2;c++){var arr_style_item=arr_style_items[c].split(":");arr_style_item[0]&&(map_inline_css[arr_style_item[0]]=arr_style_item[1])}else dom_attributes[name]=value}}attach_dom_events(){console.log("attach_dom_events");var that=this;each(this._bound_events,(handlers,name)=>{each(handlers,handler=>{console.log("event name",name);that.add_dom_event_listener(name,handler)})})}hide(){console.log("hide"),this.add_class("hidden")}show(){console.log("show"),this.remove_class("hidden")}descendants(search){var recursive_iterate=function(ctrl,item_callback){var content=ctrl.content;"collection"==tof(content)&&content.length()>0&&content.each(function(item,i){item_callback(item),recursive_iterate(item,item_callback)})},arr_matching=[];return recursive_iterate(this,function(item){item.__type_name==search&&arr_matching.push(item)}),arr_matching}ancestor(search){if(this._parent){var ctrl_parent=this._parent._parent;return!!ctrl_parent&&(ctrl_parent.__type_name==search?ctrl_parent:ctrl_parent.ancestor(search))}return!1}draggable(){var a=arguments;a.l=arguments.length;var mode,handle_mousedown,handle_dragstart,handle_dragmove,sig=get_a_sig(a,1),that=this,options={};"[o]"==sig&&(options=a[0]),"[f,f,f,f]"==sig&&(handle_mousedown=a[0],handle_dragstart=a[1],handle_dragmove=a[2],a[3]),options.mode&&(mode=options.mode),options.move&&(handle_dragmove=options.move),options.start&&(handle_dragstart=options.start),"ghost-copy"==mode&&console.log("ghost-copy drag");var is_dragging,pos_mousedown,ghost_clone,body=that.context.body(),fn_mousemove=function(e_mousemove){var pos=[e_mousemove.pageX,e_mousemove.pageY],pos_offset=[pos[0]-pos_mousedown[0],pos[1]-pos_mousedown[1]];is_dragging||Math.round(Math.sqrt(pos_offset[0]*pos_offset[0]+pos_offset[1]*pos_offset[1]))>=4&&(is_dragging=!0,"ghost-copy"==mode&&(ghost_clone=that.absolute_ghost_clone()),handle_dragstart&&(e_mousemove.control=that,body.add_class("no-text-select"),body.add_class("default-cursor"),handle_dragstart(e_mousemove))),is_dragging&&handle_dragmove&&(e_mousemove.control=that,handle_dragmove(e_mousemove))},fn_mouseup=function(e_mouseup){body.off("mousemove",fn_mousemove),body.off("mouseup",fn_mouseup),body.remove_class("no-text-select"),body.remove_class("default-cursor")};this.on("mousedown",function(e_mousedown){pos_mousedown=[e_mousedown.pageX,e_mousedown.pageY],body.on("mousemove",fn_mousemove),body.on("mouseup",fn_mouseup),body.add_class("no-text-select"),is_dragging=!1,handle_mousedown&&handle_mousedown(e_mousedown)})}drag_handle_to(ctrl){var mousedown_offset_from_ctrl_lt,ctrl_el=ctrl.dom.el;this.draggable(function(e_mousedown){var target=e_mousedown.target,el_ctrl=(findPos(target),ctrl.value("dom.el")),ctrl_el_pos=findPos(el_ctrl),e_pos_on_page=[e_mousedown.pageX,e_mousedown.pageY];mousedown_offset_from_ctrl_lt=jsgui.v_subtract(e_pos_on_page,ctrl_el_pos)},function(e_begin){ctrl.size();ctrl.anchored_to&&ctrl.unanchor()},function(e_move){var clientX=e_move.clientX,clientY=e_move.clientY,window_size=get_window_size(),ctrl_pos=jsgui.v_subtract([clientX,clientY],mousedown_offset_from_ctrl_lt),offset_adjustment=ctrl.offset_adjustment;offset_adjustment&&(ctrl_pos=jsgui.v_add(ctrl_pos,offset_adjustment)),ctrl_pos[0]<0&&(ctrl_pos[0]=0),ctrl_pos[1]<0&&(ctrl_pos[1]=0);var ow=ctrl_el.offsetWidth,oh=ctrl_el.offsetHeight;ctrl_pos[0]>window_size[0]-ow&&(ctrl_pos[0]=window_size[0]-ow),ctrl_pos[1]>window_size[1]-oh&&(ctrl_pos[1]=window_size[1]-oh);var style_vals={left:ctrl_pos[0]+"px",top:ctrl_pos[1]+"px"};ctrl.style(style_vals),ctrl.context.move_drag_ctrl(e_move,ctrl)},function(e_end){var uo1=ctrl.unanchored_offset;ctrl.context.end_drag_ctrl(e_end,ctrl);var uo2=ctrl.unanchored_offset;uo1&&uo2&&(ctrl.unanchored_offset=null),ctrl.offset_adjustment=null})}resize_handle_to(ctrl,handle_position){if("right-bottom"==handle_position){var doc=ctrl.context.ctrl_document,fn_move=function(e_move){},fn_up=function(e_up){doc.off("mousemove",fn_move),doc.off("mouseup",fn_up)};ctrl.on("mousedown",function(e_mousedown){doc.on("mousemove",fn_move),doc.on("mouseup",fn_up)})}}selectable(ctrl){var that=this;ctrl=ctrl||this,"undefined"==typeof document?that.is_selectable=!0:that.click(function(e){var ctrl_key=e.ctrlKey,meta_key=e.metaKey;ctrl_key||meta_key?ctrl.action_select_toggle():ctrl.action_select_only()})}action_select_only(){this.find_selection_scope().select_only(this)}action_select_toggle(){this.find_selection_scope().select_toggle(this)}find_selection_scope(){var res=this.selection_scope;return res||(this.parent?this.parent.find_selection_scope():void 0)}make_full_height(){var el=this.dom.el,viewportHeight=document.documentElement.clientHeight,rect=el.getBoundingClientRect();console.log(rect.top,rect.right,rect.bottom,rect.left);var h=viewportHeight-rect.top;this.style("height",h+"px",!0)}unanchor(){this.get("anchored_to")[0].unanchor_ctrl(this)}}module.exports=Control},{"../lang/lang":94,"./control-core":81}],83:[function(require,module,exports){var jsgui=require("../lang/lang"),str_arr_mapify=jsgui.str_arr_mapify,get_a_sig=jsgui.get_a_sig,each=jsgui.each,Control=jsgui.Control=require("./control-enh"),tof=jsgui.tof,map_Controls=jsgui.map_Controls={},core_extension=str_arr_mapify(function(tagName){jsgui[tagName]=class extends Control{constructor(spec){super(spec),this.dom.tagName=tagName}},jsgui[tagName].prototype._tag_name=tagName,map_Controls[tagName]=jsgui[tagName]}),core_extension_no_closing_tag=str_arr_mapify(function(tagName){jsgui[tagName]=class extends Control{constructor(spec){super(spec),this.dom.tagName=tagName,this.dom.noClosingTag=!0}},jsgui[tagName].prototype._tag_name=tagName,map_Controls[tagName]=jsgui[tagName]}),recursive_dom_iterate=function(el,callback){callback(el);for(var cns=el.childNodes,c=0,l=cns.length;c<l;c++)recursive_dom_iterate(cns[c],callback)},recursive_dom_iterate_depth=function(el,callback){for(var cns=el.childNodes,c=0,l=cns.length;c<l;c++)recursive_dom_iterate_depth(cns[c],callback);callback(el)},activate=function(context){if(!context)throw"jsgui-html-enh activate(context) - need to supply context parameter.";var map_jsgui_els={},map_jsgui_types={},arr_controls=[],max_typed_ids={},id_before__=function(id){var pos1=id.lastIndexOf("_");return id.substr(0,pos1)},num_after=function(id){return parseInt(id.substr(id.lastIndexOf("_")+1),10)};recursive_dom_iterate(document,function(el){if(1==el.nodeType){var jsgui_id=el.getAttribute("data-jsgui-id");if(jsgui_id){var ib=id_before__(jsgui_id),num=num_after(jsgui_id);max_typed_ids[ib]?num>max_typed_ids[ib]&&(max_typed_ids[ib]=num):max_typed_ids[ib]=num,map_jsgui_els[jsgui_id]=el;var jsgui_type=el.getAttribute("data-jsgui-type");map_jsgui_types[jsgui_id]=jsgui_type}}}),context.set_max_ids(max_typed_ids);var map_controls=context.map_controls;each(map_jsgui_els,function(el,jsgui_id){var l_tag_name=el.tagName.toLowerCase();if(jsgui_id){var type=map_jsgui_types[jsgui_id];if(console.log("!!map_controls[jsgui_id]",!!map_controls[jsgui_id]),console.log("map_controls",map_controls),map_controls[jsgui_id])console.log("found control in map",jsgui_id),(ctrl=map_controls[jsgui_id]).dom.el=el,ctrl.attach_dom_events&&ctrl.attach_dom_events();else{var Cstr=context.map_Controls[type];if(Cstr){console.log("creating constructor of type",type,"jsgui_id",jsgui_id);var ctrl=new Cstr({context:context,_id:jsgui_id,el:el});arr_controls.push(ctrl),"html"===l_tag_name&&(context.ctrl_document=ctrl),map_controls[jsgui_id]=ctrl}else console.log("Missing context.map_Controls for type "+type+", using generic Control"),(ctrl=new Control({context:context,_id:jsgui_id,el:el})).__type_name=type,arr_controls.push(ctrl),map_controls[jsgui_id]=ctrl}}}),recursive_dom_iterate_depth(document,function(el){if(1==el.nodeType){var jsgui_id=el.getAttribute("data-jsgui-id");if(jsgui_id){var ctrl=map_controls[jsgui_id];ctrl.__activating=!0,ctrl.activate(),ctrl.__activating=!1}}})},escape_html_replacements=[[/&/g,"&amp;"],[/</g,"&lt;"],[/>/g,"&gt;"],[/"/g,"&quot;"],[/'/g,"&#x27;"],[/\//g,"&#x2F;"]],escape_html=function(str){"data_value"==tof(str)&&(str=str.get());for(var single_replacement,c=0,l=escape_html_replacements.length;c<l;c++)single_replacement=escape_html_replacements[c],str=str.replace(single_replacement[0],single_replacement[1]);return str};jsgui.activate=activate,core_extension("html head title body div span h1 h2 h3 h4 h5 h6 label p a script button form img ul li audio video table tr td caption thead colgroup col"),core_extension_no_closing_tag("link input");class textNode extends Control{constructor(spec){super(spec),"string"==typeof(spec=spec||{})&&(spec={text:spec}),spec.nodeType=3,this._={},void 0!==spec.text&&(this.text=spec.text)}get text(){return this._.text}set text(value){this._.text=value,this.raise("change",{name:"text",value:value})}all_html_render(){return this.nx?this.text||"":escape_html(this.text||"")||""}}class HTML_Document extends jsgui.Control{constructor(spec){super(spec)}render_dtd(){return'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">\n'}}class Blank_HTML_Document extends HTML_Document{constructor(spec){console.log("Blank_HTML_Document"),super(spec);var context=this.context;if(!spec.el){this.dom.tagName="html";var head=new jsgui.head({context:context});this.content.add(head);var title=new jsgui.title({context:context});head.content.add(title);var body=new jsgui.body({context:context});this.content.add(body),this.head=head,this.title=title,this.body=body}}body(){var a=arguments;if(a.l=arguments.length,"[]"==get_a_sig(a,1))return this.content.get(1)}}class Client_HTML_Document extends Blank_HTML_Document{constructor(spec){console.log("Client_HTML_Document"),super(spec),this.active()}include_js(url){var head=this.get("head"),script=new jsgui.script({context:this.context}),domAttributes=script.dom.attributes;domAttributes.type="text/javascript",domAttributes.src=url,head.content.add(script)}include_css(url){var head=this.get("head"),link=new jsgui.link({context:this.context}),domAttributes=link.get("dom").get("attributes");domAttributes.set("rel","stylesheet"),domAttributes.set("type","text/css"),domAttributes.set("href",url),head.content().add(link)}include_jsgui_client(js_file_require_data_main){js_file_require_data_main=js_file_require_data_main||"/js/web/jsgui-html-client";var head=this.head,script=new jsgui.script({context:this.context});script.dom.attributes.set({type:"text/javascript",src:"/js/web/require.js","data-main":js_file_require_data_main}),head.add(script)}include_jsgui_resource_client(path){var js_file_require_data_main=path||"/js/web/jsgui-html-resource-client";this.include_jsgui_client(js_file_require_data_main)}include_client_css(){var head=this.get("head"),link=new jsgui.link({context:this.context}),domAttributes=link.dom.attributes;domAttributes.rel="stylesheet",domAttributes.type="text/css",domAttributes.href="/css/basic.css",head.content.add(link)}}jsgui.textNode=textNode,jsgui.HTML_Document=HTML_Document,jsgui.Blank_HTML_Document=Blank_HTML_Document,jsgui.Client_HTML_Document=Client_HTML_Document,jsgui.Page_Context=require("./../html-core/page-context"),module.exports=jsgui},{"../lang/lang":94,"./../html-core/page-context":84,"./control-enh":82}],84:[function(require,module,exports){var jsgui=require("../lang/lang"),each=(jsgui.stringify,jsgui.each),is_defined=(jsgui.tof,jsgui.is_defined),Control=jsgui.Control,get_a_sig=(jsgui.Class,jsgui.fp,jsgui.group,jsgui.get_a_sig),get_window_size=jsgui.get_window_size;class Page_Context extends jsgui.Evented_Class{constructor(spec){super(spec=spec||{}),spec.browser_info&&(this.browser_info=spec.browser_info),spec.resource_pool&&(this.resource_pool=spec.resource_pool),this.get_vector_methodology=function(){return this.browser_info.ie?"vml":"svg"};var map_new_ids={},_get_new_typed_object_id=function(type_name){is_defined(map_new_ids[type_name])||(map_new_ids[type_name]=0);var res=type_name+"_"+map_new_ids[type_name];return map_new_ids[type_name]++,res};this.new_id=_get_new_typed_object_id,this.set_max_ids=function(map_max_ids){each(map_max_ids,function(v,i){map_new_ids[i]=v+1})};var map_Controls=this.map_Controls={};this.map_controls={};map_Controls.control=Control}make(abstract_object){if(abstract_object._abstract){var constructor=abstract_object.constructor,aos=abstract_object._spec;return aos.abstract=null,aos.context=this,new constructor(abstract_object._spec)}throw"Object must be abstract, having ._abstract == true"}update_Controls(){var a=arguments;a.l=arguments.length;var sig=get_a_sig(a,1);if("[o]"==sig){var o=a[0],map_Controls=this.map_Controls;each(o,function(name,Constructor){name=name.toLowerCase(),map_Controls[name]=Constructor})}if("[s,f]"==sig){var name=a[0],Constructor=a[1];name=name.toLowerCase(),this.map_Controls[name]=Constructor}}register_control(control){var id=control._id();this.map_controls[id]=control}first_ctrl_matching_type(type_name){var res;return each(this.map_controls,function(ctrl,ctrl_id,fn_stop){ctrl.__type_name===type_name&&(fn_stop(),res=ctrl)}),res}begin_drag_ctrl(e_begin,ctrl){this.raise("drag-ctrl-begin",e_end,ctrl)}move_drag_ctrl(e_move,ctrl){var window_size=get_window_size(),clientX=e_move.clientX,clientY=e_move.clientY,is_left=clientX<=64,is_top=clientY<=64,is_right=clientX>=window_size[0]-64,is_bottom=clientY>=window_size[1]-64;is_top?this.raise("drag-ctrl-top"):is_bottom?this.raise("drag-ctrl-bottom"):is_left?this.raise("drag-ctrl-left"):is_right?this.raise("drag-ctrl-right"):this.raise("drag-ctrl-no-zone")}end_drag_ctrl(e_end,ctrl){this.raise("drag-ctrl-end",e_end,ctrl)}drop_ctrl(ctrl,zone){this.full_window&&this.anchor(ctrl,zone)}anchor(ctrl,zone){if(console.log("page context anchor "),this.full_window){var fw=this.full_window,g9=fw.get("grid_9");g9&&g9.anchor_ctrl(ctrl,zone);fw.__type_name}}begin_drag_selection_scope(e_begin,selection_scope){var map_selected_controls=selection_scope.map_selected_controls,arr_selected=jsgui.true_vals(map_selected_controls),shallow_copies_selected=jsgui.shallow_copy(arr_selected);this.drag_selected=arr_selected;var ctrl_abs=this.make(Control({}));ctrl_abs.add(shallow_copies_selected);e_begin.screenX,e_begin.screenY;var clientX=e_begin.clientX,clientY=e_begin.clientY;ctrl_abs.set("dom.attributes.style","position: absolute; left: "+clientX+"px; top:"+clientY+"px; height: 200px; width: 320px; background-color: #EEEEEE");var html=ctrl_abs.all_html_render(),el_ctr=document.createElement("div");el_ctr.innerHTML=html;var el_abs=el_ctr.childNodes[0];document.body.appendChild(el_abs),this.ctrl_abs=ctrl_abs}move_drag_selection_scope(e_move){console.log("page context move_drag_selection_scope");var style="position: absolute; left: "+e_move.clientX+"px; top:"+e_move.clientY+"px; height: 200px; width: 320px; background-color: #EEEEEE";this.ctrl_abs.dom.el.style.cssText=style}end_drag_selection_scope(e_end){this.ctrl_abs&&(this.ctrl_abs.remove(),this.ctrl_abs=null)}}module.exports=Page_Context},{"../lang/lang":94}],85:[function(require,module,exports){var jsgui=require("../html-core/html-core"),Controls=(jsgui.str_arr_mapify,jsgui.get_a_sig,jsgui.each,jsgui.Control,jsgui.map_Controls={},require("../controls/controls"));Object.assign(jsgui,Controls),module.exports=jsgui},{"../controls/controls":36,"../html-core/html-core":83}],86:[function(require,module,exports){var StiffArray=require("./stiffarray"),B_Plus_Node=function(nodeCapacity){return{isLeaf:!1,parent:null,keys:new StiffArray(nodeCapacity+1),children:new StiffArray(nodeCapacity+2)}},B_Plus_Leaf=function(nodeCapacity){return{isLeaf:!0,parent:null,keys:new StiffArray(nodeCapacity+1),values:new StiffArray(nodeCapacity+1),prevLeaf:null,nextLeaf:null}},FindInfo=(key,value,isPrefixSearch)=>{isPrefixSearch=!!isPrefixSearch;var isKeyPresent=void 0!=key;var isValuePresent=void 0!=value;var prefixLength=0;isPrefixSearch&&("string"!=typeof key?isPrefixSearch=!1:prefixLength=key.length);return{key:key,value:value,isPrefixSearch:isPrefixSearch,leaf:null,index:-1,isKeyPresent:isKeyPresent,isValuePresent:isValuePresent,foundKey:function(){return this.leaf.keys.items[this.index]},foundValue:function(){return this.leaf.values.items[this.index]},prefix_length:prefixLength,check_prefix:function(){if(!isPrefixSearch)return!1;if(this.index>=this.leaf.keys.count)return!1;var keyToCheck=this.foundKey();return!(this.prefix_length>keyToCheck.length)&&keyToCheck.substr(0,this.prefix_length)==this.key}}},B_Plus_Tree=function(nodeCapacity){if(void 0===nodeCapacity&&(nodeCapacity=10),nodeCapacity<4)throw"B_Plus_Tree(): node capacity must be >= 4";var m_public={root:new B_Plus_Leaf(nodeCapacity),firstLeaf:null,lastLeaf:null,clear:function(){p_Clear()},insert:function(key,value){return 2==arguments.length?p_Insert(key,value):p_Insert(key[0],key[1])},remove:function(key,value){if(2==arguments.length)return p_Remove(key,value);p_RemoveKey(key)},findFirst:function(key,value){return p_FindFirst(key,value)},findFirstPrefix:function(prefix){return p_FindFirst(prefix,void 0,!0)},findNext:function(findInfo){return p_FindNext(findInfo)},findLast:function(key,value){return p_FindLast(key,value)},findLastPrefix:function(prefix){return p_FindLast(prefix,void 0,!0)},findPrevious:function(findInfo){return p_FindPrev(findInfo)},getValue:function(key){return p_GetValue(key)},setValue:function(key,value){p_SetValue(key,value)},count:function(key){return 1==arguments.length?p_CountKey(key):p_Count()},getCapacity:function(){return m_nodeMaxCount},each:function(callback){return p_each(callback)},keys:function(){return p_keys()},keys_and_values:function(){return p_keys_and_values()},get_by_prefix:function(prefix){return p_get_by_prefix(prefix)},get_keys_by_prefix:function(prefix){return p_get_keys_by_prefix(prefix)},get_values_by_key:function(key){return p_get_values_by_key(key)}};m_public.firstLeaf=m_public.root,m_public.lastLeaf=m_public.root;var m_nodeMaxCount=nodeCapacity,m_nodeMinCount=Math.floor(m_nodeMaxCount/2),p_Clear=function(){m_public.root=new B_Plus_Leaf(m_nodeMaxCount),m_public.firstLeaf=m_public.root,m_public.lastLeaf=m_public.root},p_keys=function(){var res=[];return _p_each_key(function(key){res.push(key)}),res},p_keys_and_values=function(){var res=[];return p_each(function(key,value){res.push([key,value])}),res},_p_each_key=function(callback){for(var findInfo=p_FindFirst();null!=findInfo;)callback(findInfo.foundKey()),findInfo=p_FindNext(findInfo)},p_each=function(callback){for(var findInfo=p_FindFirst(),doStop=!1;null!=findInfo;)callback(findInfo.foundKey(),findInfo.foundValue(),function(){doStop=!0}),findInfo=doStop?null:p_FindNext(findInfo)},p_Insert=function(key,value){var searchResult=searchLeaf(key),leaf=searchResult.node;leaf.keys.insert(searchResult.index,key),leaf.values.insert(searchResult.index,value),leaf.keys.count>m_nodeMaxCount&&(null!=leaf.prevLeaf&&leaf.prevLeaf.keys.count<m_nodeMaxCount&&leaf.prevLeaf.parent==leaf.parent?rotateAmongLeavesToLeft(leaf.prevLeaf,leaf):null!=leaf.nextLeaf&&leaf.nextLeaf.keys.count<m_nodeMaxCount&&leaf.nextLeaf.parent==leaf.parent?rotateAmongLeavesToRight(leaf,leaf.nextLeaf):splitLeaf(leaf))},splitLeaf=function(leaf){var leftCount=m_nodeMinCount,rightCount=leaf.keys.count-leftCount,newRightLeaf=new B_Plus_Leaf(m_nodeMaxCount);if(newRightLeaf.parent=leaf.parent,newRightLeaf.keys.copy_from(leaf.keys,leftCount,rightCount),newRightLeaf.values.copy_from(leaf.values,leftCount,rightCount),leaf.keys.count=leftCount,leaf.values.count=leftCount,newRightLeaf.nextLeaf=leaf.nextLeaf,null!=newRightLeaf.nextLeaf&&(newRightLeaf.nextLeaf.prevLeaf=newRightLeaf),newRightLeaf.prevLeaf=leaf,leaf.nextLeaf=newRightLeaf,m_public.lastLeaf==leaf&&(m_public.lastLeaf=newRightLeaf),null!=leaf.parent){var leafIndex=calcChildIndex(leaf.parent,leaf);insertToParent(leaf.parent,newRightLeaf,newRightLeaf.keys.first(),leafIndex+1)}else createNewRoot(leaf,newRightLeaf,newRightLeaf.keys.first())},createNewRoot=function(nodeLeft,nodeRight,key){var newRoot=new B_Plus_Node(m_nodeMaxCount);newRoot.keys.add(key),newRoot.children.add(nodeLeft),newRoot.children.add(nodeRight),nodeLeft.parent=newRoot,nodeRight.parent=newRoot,m_public.root=newRoot},insertToParent=function(parentNode,newChildNode,newChildFirstKey,newChildIndex){parentNode.keys.insert(newChildIndex-1,newChildFirstKey),parentNode.children.insert(newChildIndex,newChildNode),newChildNode.parent=parentNode,parentNode.keys.count>m_nodeMaxCount&&splitNode(parentNode)},splitNode=function(node){var newLeftCount=m_nodeMinCount,newRightCount=m_nodeMaxCount-newLeftCount,middleKey=node.keys.items[newLeftCount],newRightNode=new B_Plus_Node(m_nodeMaxCount);newRightNode.keys.copy_from(node.keys,newLeftCount+1,newRightCount),newRightNode.children.copy_from(node.children,newLeftCount+1,newRightCount+1),node.keys.count=newLeftCount,node.children.count=newLeftCount+1;for(var i=0;i<newRightNode.children.count;i++)newRightNode.children.items[i].parent=newRightNode;if(null==node.parent)createNewRoot(node,newRightNode,middleKey);else{var nodeIndex=calcChildIndex(node.parent,node);insertToParent(node.parent,newRightNode,middleKey,nodeIndex+1)}},p_Remove=function(key,value){var searchResult=searchLeafValue(key,value);return!!searchResult.found&&(removeFromLeaf(searchResult.node,searchResult.index),!0)},p_RemoveKey=function(key){for(;;){var searchResult=searchLeaf(key);if(!searchResult.found)break;removeFromLeaf(searchResult.node,searchResult.index)}},removeFromLeaf=function(leaf,index){return leaf.keys.removeAt(index),leaf.values.removeAt(index),leaf.keys.count<m_nodeMinCount&&(null!=leaf.prevLeaf&&leaf.parent==leaf.prevLeaf.parent&&leaf.prevLeaf.keys.count>m_nodeMinCount?rotateAmongLeavesToRight(leaf.prevLeaf,leaf):null!=leaf.nextLeaf&&leaf.parent==leaf.nextLeaf.parent&&leaf.nextLeaf.keys.count>m_nodeMinCount?rotateAmongLeavesToLeft(leaf,leaf.nextLeaf):mergeLeaf(leaf)),!0},mergeLeaf=function(leaf){if(null!=leaf.parent){var leftCount=m_nodeMaxCount+1,rightCount=m_nodeMaxCount+1;if(null!=leaf.prevLeaf&&leaf.prevLeaf.parent==leaf.parent&&(leftCount=leaf.prevLeaf.keys.count),null!=leaf.nextLeaf&&leaf.nextLeaf.parent==leaf.parent&&(rightCount=leaf.nextLeaf.keys.count),leftCount<rightCount){if(leftCount+leaf.keys.count>m_nodeMaxCount)throw"B_Plus_Tree.mergeLeaf(): leftCount";mergeLeaves(leaf.prevLeaf,leaf)}else{if(rightCount+leaf.keys.count>m_nodeMaxCount)throw"B_Plus_Tree.mergeLeaf(): rightCount";mergeLeaves(leaf,leaf.nextLeaf)}}},mergeLeaves=function(leafLeft,leafRight){leafLeft.keys.add_from(leafRight.keys),leafLeft.values.add_from(leafRight.values),leafLeft.nextLeaf=leafRight.nextLeaf,null!=leafLeft.nextLeaf&&(leafLeft.nextLeaf.prevLeaf=leafLeft),m_public.lastLeaf==leafRight&&(m_public.lastLeaf=leafLeft);var parent=leafRight.parent,leafRightIndex=calcChildIndex(parent,leafRight);parent.keys.removeAt(leafRightIndex-1),parent.children.removeAt(leafRightIndex),parent.keys.count<m_nodeMinCount&&mergeNode(parent)},mergeNode=function(node){var parent=node.parent;if(null!=node.parent){var nodeIndex=calcChildIndex(parent,node),leftSibling=nodeIndex>0?parent.children.items[nodeIndex-1]:null,rightSibling=nodeIndex+1<parent.children.count?parent.children.items[nodeIndex+1]:null;if(null!=leftSibling&&leftSibling.keys.count>m_nodeMinCount)rotateAmongNodesToRight(leftSibling,node);else if(null!=rightSibling&&rightSibling.keys.count>m_nodeMinCount)rotateAmongNodesToLeft(node,rightSibling);else{var leftCount=m_nodeMaxCount+1,rightCount=m_nodeMaxCount+1;if(null!=leftSibling&&(leftCount=leftSibling.keys.count),null!=rightSibling&&(rightCount=rightSibling.keys.count),leftCount<rightCount){if(null==leftSibling)throw"B_Plus_Tree.mergeNode(): leftSibling";mergeNodes(leftSibling,node,nodeIndex)}else{if(null==rightSibling)throw"B_Plus_Tree.mergeNode(): rightSibling";mergeNodes(node,rightSibling,nodeIndex+1)}}}else 0==node.keys.count&&(m_public.root=node.children.items[0],m_public.root.parent=null)},mergeNodes=function(nodeLeft,nodeRight,nodeRightIndex){for(var parent=nodeLeft.parent,i=0;i<nodeRight.children.count;i++)nodeRight.children.items[i].parent=nodeLeft;nodeLeft.keys.add(nodeLeft.parent.keys.items[nodeRightIndex-1]),nodeLeft.keys.add_from(nodeRight.keys),nodeLeft.children.add_from(nodeRight.children),parent.keys.removeAt(nodeRightIndex-1),parent.children.removeAt(nodeRightIndex),parent.keys.count<m_nodeMinCount&&mergeNode(parent)},p_FindFirst=function(key,value,isPrefixSearch){var findInfo=FindInfo(key,value,isPrefixSearch);if(findInfo.isKeyPresent){if(findInfo.isPrefixSearch&&findInfo.isValuePresent)throw"B_Plus_Tree.p_FindFirst(): arguments error: isPrefixSearch, but value is present";var searchResult=findInfo.isValuePresent?searchLeafValue(key,value):searchLeaf(key);if(findInfo.leaf=searchResult.node,findInfo.index=searchResult.index,!searchResult.found&&!findInfo.check_prefix())return null}else{if(findInfo.isValuePresent)throw"B_Plus_Tree.findFirst(): arguments error: key is not present, but value is present";if(findInfo.leaf=m_public.firstLeaf,findInfo.index=0,findInfo.leaf.keys.count<=0)return null}return findInfo},p_FindLast=function(key,value,isPrefixSearch){var findInfo=new FindInfo(key,value,isPrefixSearch);if(findInfo.isKeyPresent){if(findInfo.isPrefixSearch&&findInfo.isValuePresent)throw"B_Plus_Tree.p_FindLast(): arguments error: isPrefixSearch, but value is present";if(findInfo.isPrefixSearch){searchResult=searchLastLeafByPrefix(key);if(findInfo.leaf=searchResult.node,findInfo.index=searchResult.index,!searchResult.found)return null}else{var searchResult=findInfo.isValuePresent?searchLastLeafValue(key,value):searchLastLeaf(key);if(findInfo.leaf=searchResult.node,findInfo.index=searchResult.index,!searchResult.found)return null}}else{if(findInfo.isValuePresent)throw"B_Plus_Tree.findLast(): arguments error: key is not present, but value is present";if(findInfo.leaf=m_public.lastLeaf,findInfo.index=findInfo.leaf.keys.count-1,findInfo.index<0)return null}return findInfo},findGoToNext=function(findInfo){return++findInfo.index>=findInfo.leaf.keys.count&&(findInfo.leaf=findInfo.leaf.nextLeaf,findInfo.index=0),null!=findInfo.leaf},findGoToPrev=function(findInfo){if(--findInfo.index<0){if(findInfo.leaf=findInfo.leaf.prevLeaf,null==findInfo.leaf)return!1;findInfo.index=findInfo.leaf.keys.count-1}return!0},p_FindNext=function(findInfo){for(;;){if(!findGoToNext(findInfo))return null;if(findInfo.isPrefixSearch){if(!findInfo.check_prefix())return null}else if(findInfo.isKeyPresent&&findInfo.key!=findInfo.foundKey())return null;if(!findInfo.isValuePresent)return findInfo;if(findInfo.value==findInfo.foundValue())return findInfo}},p_FindPrev=function(findInfo){for(;;){if(!findGoToPrev(findInfo))return null;if(findInfo.isPrefixSearch){if(!findInfo.check_prefix())return null}else if(findInfo.isKeyPresent&&findInfo.key!=findInfo.foundKey())return null;if(!findInfo.isValuePresent)return findInfo;if(findInfo.value==findInfo.foundValue())return findInfo}},p_get_values_by_key=function(key){for(var res=[],findInfo=p_FindFirst(key);null!=findInfo;)res.push(findInfo.foundValue()),findInfo=p_FindNext(findInfo);return res},p_get_by_prefix=function(prefix){for(var res=[],findInfo=m_public.findFirstPrefix(prefix);null!=findInfo;)res.push([findInfo.foundKey(),findInfo.foundValue()]),findInfo=m_public.findNext(findInfo);return res},p_get_keys_by_prefix=function(prefix){for(var res=[],findInfo=m_public.findFirstPrefix(prefix);null!=findInfo;)res.push(findInfo.foundKey()),findInfo=m_public.findNext(findInfo);return res},p_GetValue=function(key){var searchResult=searchLeaf(key);return searchResult.found?searchResult.node.values.items[searchResult.index]:null},p_SetValue=function(key,value){var searchResult=searchLeaf(key);searchResult.found&&removeFromLeaf(searchResult.node,searchResult.index),p_Insert(key,value)},p_Count=function(){for(var result=0,leaf=m_public.firstLeaf;null!=leaf;)result+=leaf.keys.count,leaf=leaf.nextLeaf;return result},p_CountKey=function(key){for(var result=0,findInfo=m_public.findFirst(key);null!=findInfo;)result++,findInfo=m_public.findNext(findInfo);return result},rotateAmongNodesToLeft=function(leftNode,rightNode){var parent=rightNode.parent,rightIndex=calcChildIndex(parent,rightNode);leftNode.keys.add(parent.keys.items[rightIndex-1]),parent.keys.items[rightIndex-1]=rightNode.keys.first(),rightNode.keys.removeFirst(),rightNode.children.first().parent=leftNode,leftNode.children.add(rightNode.children.first()),rightNode.children.removeFirst()},rotateAmongNodesToRight=function(leftNode,rightNode){var parent=rightNode.parent,rightIndex=calcChildIndex(parent,rightNode);rightNode.keys.insert(0,parent.keys.items[rightIndex-1]),parent.keys.items[rightIndex-1]=leftNode.keys.last(),leftNode.keys.removeLast(),rightNode.children.insert(0,leftNode.children.last()),rightNode.children.first().parent=rightNode,leftNode.children.removeLast()},rotateAmongLeavesToLeft=function(leftLeaf,rightLeaf){var rightIndex=calcChildIndex(rightLeaf.parent,rightLeaf);leftLeaf.keys.add(rightLeaf.keys.first()),leftLeaf.values.add(rightLeaf.values.first()),rightLeaf.keys.removeFirst(),rightLeaf.values.removeFirst(),rightLeaf.parent.keys.items[rightIndex-1]=rightLeaf.keys.first()},rotateAmongLeavesToRight=function(leftLeaf,rightLeaf){var rightIndex=calcChildIndex(rightLeaf.parent,rightLeaf);rightLeaf.keys.insert(0,leftLeaf.keys.last()),rightLeaf.values.insert(0,leftLeaf.values.last()),leftLeaf.keys.removeLast(),leftLeaf.values.removeLast(),rightLeaf.parent.keys.items[rightIndex-1]=rightLeaf.keys.first()},calcChildIndex=function(node,child){var key=child.keys.first(),searchResult=node.keys.search_first(key);if(!searchResult.found){if(node.children.items[searchResult.index]!=child)throw"B_PlusTree.calcChildIndex(): 1";return searchResult.index}for(var index=searchResult.index;;){if(node.children.items[index]==child)return index;if(++index>=node.children.count)break;if(node.keys.items[index-1]!=key)break}throw"B_PlusTree.calcChildIndex(): 2"},searchLeaf=function(key){var doSearchLeaf=function(node,key){var searchResult=node.keys.search_first(key);if(node.isLeaf)return{node:node,found:searchResult.found,index:searchResult.index};if(searchResult.found){var resultLeft=doSearchLeaf(node.children.items[searchResult.index],key);return resultLeft.found?resultLeft:doSearchLeaf(node.children.items[searchResult.index+1],key)}return doSearchLeaf(node.children.items[searchResult.index],key)};return doSearchLeaf(m_public.root,key)},searchLastLeaf=function(key){var doSearchLastLeaf=function(node,key){var searchResult=node.keys.search_last(key);if(node.isLeaf)return{node:node,found:searchResult.found,index:searchResult.index};if(searchResult.found){var resultRight=doSearchLastLeaf(node.children.items[searchResult.index+1],key);return resultRight.found?resultRight:doSearchLastLeaf(node.children.items[searchResult.index],key)}return doSearchLastLeaf(node.children.items[searchResult.index],key)};return doSearchLastLeaf(m_public.root,key)},searchLastLeafByPrefix=function(prefix){var doSearchLastLeafByPrefix=function(node,prefix){var searchResult=node.keys.search_last_prefix(prefix);if(node.isLeaf)return{node:node,found:searchResult.found,index:searchResult.index};if(searchResult.found){var resultRight=doSearchLastLeafByPrefix(node.children.items[searchResult.index+1],prefix);return resultRight.found?resultRight:doSearchLastLeafByPrefix(node.children.items[searchResult.index],prefix)}return doSearchLastLeafByPrefix(node.children.items[searchResult.index],prefix)};return doSearchLastLeafByPrefix(m_public.root,prefix)},searchLeafValue=function(key,value){var searchResult=searchLeaf(key);if(!searchResult.found)return searchResult;for(var valueFound=!1,leaf=searchResult.node,index=searchResult.index;;){if(index>=leaf.values.count){if(null==(leaf=leaf.nextLeaf))break;index=0}if(leaf.keys.items[index]!=key)break;if(leaf.values.items[index]==value){valueFound=!0;break}index++}return{node:leaf,found:valueFound,index:index}},searchLastLeafValue=function(key,value){var searchResult=searchLastLeaf(key);if(!searchResult.found)return searchResult;for(var valueFound=!1,leaf=searchResult.node,index=searchResult.index;;){if(index<0){if(null==(leaf=leaf.prevLeaf))break;index=leaf.values.count-1}if(leaf.keys.items[index]!=key)break;if(leaf.values.items[index]==value){valueFound=!0;break}index--}return{node:leaf,found:valueFound,index:index}};return m_public};B_Plus_Tree.FindInfo=FindInfo,module.exports=B_Plus_Tree},{"./stiffarray":87}],87:[function(require,module,exports){var StiffArray=function(capacity){return{items:new Array(capacity),count:0,first:function(){if(0==this.count)throw"StiffArray.first()";return this.items[0]},last:function(){if(0==this.count)throw"StiffArray.last()";return this.items[this.count-1]},add:function(item){if(this.count>=capacity)throw"StiffArray.add()";this.items[this.count++]=item},add_from:function(source){if(this.count+source.count>capacity)throw"StiffArray.add_from()";for(var i=0;i<source.count;i++)this.items[this.count++]=source.items[i]},insert:function(index,item){if(index<0||index>this.count)throw"StiffArray.insert(): index";if(this.count>=capacity)throw"StiffArray.insert(): overflow";for(var i=this.count;i>index;i--)this.items[i]=this.items[i-1];this.items[index]=item,this.count++},removeAt:function(index){if(index<0||index>=this.count)throw"StiffArray.removeAt()";this.count--;for(var i=index;i<this.count;i++)this.items[i]=this.items[i+1]},removeFirst:function(){this.removeAt(0)},removeLast:function(){this.removeAt(this.count-1)},copy_from:function(source,index,count){for(var i=0;i<count;i++)this.items[i]=source.items[i+index];this.count=count},search_first:function(item){for(var cnt=this.count,first=0;cnt>0;){var step=Math.floor(cnt/2),index=first+step;this.items[index]<item?(first=index+1,cnt-=step+1):cnt=step}return first<this.count?{found:this.items[first]==item,index:first}:{found:!1,index:first}},search_last:function(item){for(var cnt=this.count,first=0;cnt>0;){var step=Math.floor(cnt/2),index=first+step;item>=this.items[index]?(first=index+1,cnt-=step+1):cnt=step}return first>0&&first<=this.count&&this.items[first-1]==item?{found:!0,index:first-1}:{found:!1,index:first}},search_last_prefix:function(prefix){for(var prefix_length=prefix.length,check_prefix=function(item){return!(prefix_length>item.length)&&item.substr(0,prefix_length)==prefix},cnt=this.count,first=0;cnt>0;){var step=Math.floor(cnt/2),index=first+step,item=this.items[index];prefix>item||check_prefix(item)?(first=index+1,cnt-=step+1):cnt=step}return first>0&&first<=this.count&&check_prefix(this.items[first-1])?{found:!0,index:first-1}:{found:!1,index:first}},toString:function(){return this.items.slice(0,this.count).toString()}}};module.exports=StiffArray},{}],88:[function(require,module,exports){var jsgui=require("./essentials"),Data_Value=require("./data-value"),Data_Object=require("./data-object"),Sorted_KVS=require("./sorted-kvs"),j=(Data_Object.dobj,Data_Object.Constraint,jsgui),each=(j.Class,j.each),tof=(j.eac,j.is_array,j.is_dom_node,j.is_ctrl,j.extend,j.clone,j.x_clones,j.get_truth_map_from_arr,j.get_map_from_arr,j.arr_like_to_arr,j.tof),is_defined=j.is_defined,stringify=j.stringify,get_a_sig=(j.functional_polymorphism,j.fp,j.arrayify,j.mapify,j.are_equal,j.get_item_sig,j.set_vals,j.truth,j.trim_sig_brackets,j.iterate_ancestor_classes,j.is_constructor_fn,j.get_a_sig),native_constructor_tof=(j.is_arr_of_strs,j.is_arr_of_arrs,j.input_processors,jsgui.native_constructor_tof);Data_Object.prototype;class Collection extends Data_Object{constructor(spec,arr_values){super(spec),spec=spec||{},this.__type="collection",this.__type_name="collection";var t_spec=tof(spec=spec||{});if(!0===spec.abstract)"function"===t_spec&&this.constraint(spec);else{if(this._relationships=this._relationships||{},this._arr_idx=0,this._arr=[],this.index=new Sorted_KVS,this.fn_index=spec.fn_index,"array"==t_spec)spec={load_array:spec};else if("function"==t_spec)!0===spec.abstract&&(this._abstract=!0);else if("string"==t_spec){var nc={array:Array,boolean:Boolean,number:Number,string:String,object:Object}[spec];nc&&(spec={constraint:nc},nc==String&&(spec.index_by="value"))}is_defined(spec.items)&&(spec.load_array=spec.load_array||spec.items),arr_values&&(spec.load_array=arr_values),is_defined(spec.accepts)&&(this._accepts=spec.accepts),"init"===jsgui.__data_id_method&&this.context&&(this.__id=this.context.new_id(this.__type_name||this.__type),this.context.map_objects[this.__id]=this),this.__type,spec.load_array&&this.load_array(spec.load_array)}}set(value){var tval=tof(value),that=this;if("data_object"==tval)return this.clear(),this.push(value);if("array"!=tval){if("collection"==tval)throw"stop";return this._super(value)}this.clear(),each(value,function(v,i){that.push(v)})}clear(){this._arr_idx=0,this._arr=[],this.index.clear(),this.raise("change",{type:"clear"})}stringify(){var res=[];if(this._abstract){var ncto=native_constructor_tof(this._type_constructor);res.push("~Collection("),ncto&&res.push(ncto),res.push(")")}else{res.push("Collection(");var first=!0;this.each(function(v,i){first?first=!1:res.push(", "),res.push(stringify(v))}),res.push(")")}return res.join("")}toString(){return stringify(this._arr)}toObject(){var res=[];return this.each(function(v,i){res.push(v.toObject())}),res}each(){var a=arguments;a.l=arguments.length;var sig=get_a_sig(a,1);if("[f]"==sig)return each(this._arr,a[0]);if("[X,f]"==sig){var index=a[0],callback=a[1];return index.each(callback)}return 2==a.l?each(this._arr,a[0],a[1]):void 0}_id(){return this.context?this.__id=this.context.new_id(this.__type_name||this.__type):is_defined(this.__id),this.__id}length(){return this._arr.length}find(){var a=arguments;a.l=arguments.length;var sig=get_a_sig(a,1);if(1==a.l){var pos=this.index.get(a[0])[0];return this._arr[pos]}if("[o,s]"==sig)return this.index_system.find(a[0],a[1]);if("[s,s]"==sig)return this.index_system.find(a[0],a[1]);if("[a,s]"==sig)return this.index_system.find(a[0],a[1]);if("[s,o]"==sig){var propertyName=a[0],query=a[1],foundItems=[];return each(this,function(item,index){if(item.get)itemProperty=item.get(propertyName);else var itemProperty=item[propertyName];var tip2,tip=tof(itemProperty);if("data_value"===tip){var ip2=itemProperty.value();tip2=tof(ip2)}else ip2=itemProperty,tip2=tip;"array"===tip2&&each(ip2,function(v,i){obj_matches_query_obj(v,query)&&foundItems.push(v)})}),new Collection(foundItems)}}get(){var a=arguments;a.l=arguments.length;var sig=get_a_sig(a,1);if("[n]"==sig||"[i]"==sig)return this._arr[a[0]];if("[s]"==sig){var res,ix_sys=this.index_system;return ix_sys&&(res=ix_sys._primary_unique_index.get(a[0])[0]),res||Data_Object.prototype.get.apply(this,a)}}insert(item,pos){this._arr.splice(pos,0,item),this.trigger("change",{name:"insert",item:item,pos:pos})}remove(){var a=arguments;a.l=arguments.length;var sig=get_a_sig(a,1),that=this;if("[n]"==sig){var own_id=this._id(),pos=a[0],o_item=item=this._arr[pos],spliced_pos=pos;this._arr.splice(pos,1),this._arr_idx--;for(var length=this._arr.length;pos<length;)(item=this._arr[pos]).relationships[own_id]=[that,pos],pos++;this.index_system.remove(o_item);e={target:this,item:item,position:spliced_pos};this.raise_event(that,"remove",e)}if("[s]"==sig){var key=a[0],obj=this.index_system.find([["value",key]]),my_id=this.__id,item_pos_within_this=obj[0]._relationships[my_id];this.index_system.remove(key),this._arr.splice(item_pos_within_this,1);for(var c=item_pos_within_this,l=this._arr.length;c<l;c++){var item=this._arr[c];item._relationships[my_id]--}var e={target:this,item:obj[0],position:item_pos_within_this};this.raise(that,"remove",e)}}has(obj_key){}get_index(){var a=arguments;if(a.l=arguments.length,"[s]"===get_a_sig(a,1))return this.index_system.search(a[0])}index_by(){var a=arguments;a.l=arguments.length;get_a_sig(a,1)}push(value){var idx_key,pos,tv=tof(value),fn_index=this.fn_index,has_idx_key=!1;if(fn_index&&(idx_key=fn_index(value),has_idx_key=!0),"object"===tv||"function"===tv){pos=this._arr.length,this._arr.push(value),this._arr_idx++;e={target:this,item:value,position:pos,type:"insert"};this.raise("change",e)}if("data_object"==tv||"control"==tv){pos=this._arr.length,this._arr.push(value),this._arr_idx++;e={target:this,item:value,position:pos,type:"insert"};this.raise("change",e)}if("array"===tv){var new_coll=new Collection(value);console.log("new_coll",new_coll),pos=this._arr.length,this._arr.push(new_coll);e={target:this,item:new_coll,position:pos,type:"insert"};this.raise("change",e)}if("string"==tv||"number"==tv){var dv=new Data_Value({value:value});pos=this._arr.length,this._arr.push(dv);var e={target:this,item:dv,position:pos,type:"insert"};this.raise("change",e)}return has_idx_key&&this.index.put(idx_key,pos),value}load_array(arr){var that=this;console.log("load_array arr ",arr);for(var c=0,l=arr.length;c<l;c++)that.push(arr[c]);this.raise("load")}values(){var a=arguments;a.l=arguments.length;get_a_sig(a,1);if(0==a.l)return this._arr;(new Error).stack;throw"not yet implemented"}value(){var res=[];return this.each(function(v,i){"function"==typeof v.value?res.push(v.value()):res.push(v)}),res}}var p=Collection.prototype;p.add=p.push,module.exports=Collection},{"./data-object":89,"./data-value":90,"./essentials":92,"./sorted-kvs":97}],89:[function(require,module,exports){var jsgui=require("./essentials"),Evented_Class=require("./evented-class"),Data_Value=require("./data-value"),j=jsgui,each=(j.Class,j.each),tof=(j.is_array,j.is_dom_node,j.is_ctrl,j.extend,j.get_truth_map_from_arr,j.get_map_from_arr,j.arr_like_to_arr,j.tof),is_defined=j.is_defined,get_a_sig=(j.stringify,j.functional_polymorphism,j.fp,j.arrayify,j.mapify,j.are_equal,j.get_item_sig,j.get_a_sig),ll_get=(j.set_vals,j.truth,j.trim_sig_brackets,j.ll_set,j.ll_get);j.input_processors,j.iterate_ancestor_classes,j.is_arr_of_arrs,j.is_arr_of_strs,j.is_arr_of_t,jsgui.clone;jsgui.__data_id_method="init";require("./ordered-string-list");class Mini_Context{constructor(spec){var typed_id=function(str_type){throw"stop Mini_Context typed id"};this.new_id=typed_id}make(abstract_object){if(abstract_object._abstract){var constructor=abstract_object.constructor,aos=abstract_object._spec;return aos.abstract=null,aos.context=this,new constructor(aos)}throw"Object must be abstract, having ._abstract == true"}}var is_js_native=function(obj){var t=tof(obj);return"number"==t||"string"==t||"boolean"==t||"array"==t};class Data_Object extends Evented_Class{constructor(spec){if(super(spec),this.__data_object=!0,spec||(spec={}),!0===spec.abstract){this._abstract=!0;var tSpec=tof(spec);"function"==tSpec&&(this._type_constructor=spec),"object"==tSpec&&(this._spec=spec)}else{var that=this;this._initializing=!0;var t_spec=tof(spec);this.__type||(this.__type="data_object"),this.__type_name=spec.__type_name||"data_object","object"==t_spec&&(spec.context&&(this.context=spec.context),spec._id&&(this.__id=spec._id)),"data_object"==t_spec&&(spec.context&&(this.context=spec.context),each(spec_keys,function(i,key){that.set(key,spec.get(key))})),is_defined(this.__id)||"init"!=jsgui.__data_id_method||this.context&&(this.__id=this.context.new_id(this.__type_name||this.__type)),is_defined(spec.parent)&&this.set("parent",spec.parent),this.context&&this.init_default_events(),this._initializing=!1}}init_default_events(){}keys(){return Object.keys(this._)}toJSON(){var res=[];return res.push("Data_Object("+JSON.stringify(this._)+")"),res.join("")}toObject(){return{}}parent(){var a=arguments;a.l=arguments.length;var obj,index;get_a_sig(a,1);if(0===a.l)return this._parent;if(1==a.l){obj=a[0],!this.context&&obj.context&&(this.context=obj.context);!function(that){that._parent=obj}(this)}2==a.l&&(obj=a[0],index=a[1],!this.context&&obj.context&&(this.context=obj.context),this._parent=obj,this._index=index),is_defined(index)}_id(){if(this.__id)return this.__id;if(this.context)this.__id=this.context.new_id(this.__type_name||this.__type);else{if(this._abstract)return;if(!is_defined(this.__id))throw"stop, currently unsupported."}return this.__id}each(callback){each(this._,callback)}position_within(parent){var p_id=parent._id();if(this._parents&&is_defined(this._parents[p_id]))return this._parents[p_id][1]}remove_from(parent){var p_id=parent._id();if(this._parents&&is_defined(this._parents[p_id])){var parent=this._parents[p_id][0],pos_within=this._parents[p_id][1];parent._arr[pos_within];parent.remove(pos_within),delete this._parents[p_id]}}load_from_spec(spec,arr_item_names){var that=this;each(arr_item_names,function(v,i){var spec_item=spec[v];is_defined(spec_item)&&that.set(v,spec_item)})}get(){var a=arguments;a.l=arguments.length;var sig=get_a_sig(a,1);if("[s,f]"==sig){throw"Asyncronous access not allowed on Data_Object get.";var res}return"[s]"==sig?((res=ll_get(this._,a[0]))||(res=this[a[0]]),res):0===a.l?this._:void 0}set(){var a=arguments;a.l=arguments.length;var sig=get_a_sig(a,1);if(this._abstract)return!1;var res,that=this,input_processors=jsgui.input_processors;if(2==a.l||3==a.l){var source,property_name=a[0],value=a[1],ta2=tof(a[2]),silent=!1;if("string"!=ta2&&"boolean"!=ta2||(silent=a[2]),"control"==ta2&&(source=a[2]),!this._initializing&&this._map_read_only&&this._map_read_only[property_name])throw'Property "'+property_name+'" is read-only.';var split_pn=property_name.split(".");if(!(split_pn.length>1&&"."!=property_name)){var data_object_next=this.get(property_name);if(console.log("data_object_next",data_object_next),data_object_next){var field=this.field(property_name);field&&(data_object_next.__type_name=field[1]||data_object_next.__type_name),data_object_next.set(value)}if(is_defined(data_object_next)){if(is_js_native(data_object_next)?(this._[property_name]=value,res=value):(res=data_object_next,this._[property_name]=data_object_next),!silent){e_change={name:property_name,value:data_object_next.value()};source&&(e_change.source=source),this.trigger("change",e_change)}return res}var dv,tv=typeof value;return dv="string"===tv||"number"===tv||"boolean"===tv||"date"===tv?new Data_Value({value:value}):"array"===tv?new Data_Value({value:value}):"object"===tv?value.__data_object||value.__data_value||value.__data_grid?value:new Data_Value({value:value}):value,this._[property_name]=dv,silent||(e_change={name:property_name,value:dv},source&&(e_change.source=source),this.raise_event("change",e_change)),value}var spn_first=split_pn[0],spn_arr_next=split_pn.slice(1);if(!(data_object_next=this.get(spn_first)))throw"No data object at this level.";if(res=data_object_next.set(spn_arr_next.join("."),value),!silent){var e_change={name:property_name,value:value,bubbled:!0};source&&(e_change.source=source),this.raise_event("change",e_change)}}else{var value=a[0],property_name=a[1],input_processor=input_processors[this.__type_name];if(input_processor)return value=input_processor(value),this._[property_name]=value,this.raise_event("change",{value:value}),value;if("[D]"==sig)return this._[property_name]=value,this.raise_event("change",[property_name,value]),value;if("[o]"==sig)return res={},each(a[0],function(v,i){res[i]=that.set(i,v)}),res;if("[c]"==sig)return this._[property_name]=value,this.raise_event("change",[property_name,value]),value}}has(property_name){return is_defined(this.get(property_name))}}jsgui.map_classes={};var dobj=(obj,data_def)=>{var cstr=Data_Object;var res;res=new cstr(data_def?{data_def:data_def}:{});var tobj=tof(obj);if("object"==tobj){var res_set=res.set;each(obj,function(v,i){res_set.call(res,i,v)})}return res};Data_Object.dobj=dobj,Data_Object.Mini_Context=Mini_Context,module.exports=Data_Object},{"./data-value":90,"./essentials":92,"./evented-class":93,"./ordered-string-list":96}],90:[function(require,module,exports){var jsgui=require("./essentials"),Evented_Class=require("./evented-class"),j=jsgui,is_defined=(j.Class,j.each,j.is_array,j.is_dom_node,j.is_ctrl,j.extend,j.get_truth_map_from_arr,j.get_map_from_arr,j.arr_like_to_arr,j.tof,j.is_defined),input_processors=(j.stringify,j.functional_polymorphism,j.fp,j.arrayify,j.mapify,j.are_equal,j.get_item_sig,j.set_vals,j.truth,j.trim_sig_brackets,j.ll_set,j.ll_get,j.input_processors),input_processors=(j.iterate_ancestor_classes,j.is_arr_of_arrs,j.is_arr_of_strs,j.is_arr_of_t,jsgui.clone,jsgui.input_processors);class Data_Value extends Evented_Class{constructor(spec){super(spec),this.__data_value=!0,spec&&spec.context&&(this.context=spec.context),spec&&is_defined(spec.value)&&(this._=spec.value),this.__type="data_value",this._relationships={}}get(){return this._}value(){return this._}toObject(){return this._}set(val){var input_processor=input_processors[this.__type_name];input_processor&&(val=input_processor(val));var old_val=this._;return this._=val,this.raise("change",{old:old_val,value:val}),val}toString(){return this.get()}toJSON(){var val=this.get();return"string"==typeof val?'"'+val+'"':val}clone(){return new Data_Value({value:this._})}_id(){if(this.__id)return this.__id;if(this.context)this.__id=this.context.new_id(this.__type_name||this.__type);else if(!is_defined(this.__id))throw"DataValue should have context";return this.__id}parent(){var a=arguments;a.l=arguments.length;var obj,index;get_a_sig(a,1);if(0==a.l)return this._parent;if(1==a.l){obj=a[0],!this.context&&obj.context&&(this.context=obj.context);!function(that){that._parent=obj}(this)}2==a.l&&(obj=a[0],index=a[1],!this.context&&obj.context&&(this.context=obj.context),this._parent=obj,this._index=index),is_defined(index)}}module.exports=Data_Value},{"./essentials":92,"./evented-class":93}],91:[function(require,module,exports){class Node{constructor(spec){this.neighbours=spec.neighbours||[],this.value=spec.value}previous(){return this.neighbours[0]}next(){return this.neighbours[1]}}class Doubly_Linked_List{constructor(spec){this.first=null,this.last=null,this.length=0}each_node(callback){for(var node=this.first,ctu=!0,stop=function(){ctu=!1};node&&ctu;)callback(node,stop),node=node.neighbours[1]}each(callback){this.each_node(function(node,stop){callback(node.value,stop)})}remove(node){node.neighbours[0]?node.neighbours[0].neighbours[1]=node.neighbours[1]:this.first=node.neighbours[1],node.neighbours[1]?node.neighbours[1].neighbours[0]=node.neighbours[0]:this.last=node.neighbours[0],node.neighbours=[],node.parent==this&&(delete node.parent,this.length--)}insert_beginning(val){if(val instanceof Node)return null==this.first?(this.first=val,this.last=val,val.neighbours=[],val.parent!=this&&(val.parent=this,this.length++)):this.insert_before(val,this.first),val;var node=new Node({value:val});return this.insert_beginning(node)}insert_before(val,node){if(val instanceof Node)return val.neighbours=[node.neighbours[0],node],null==node.neighbours[0]?this.first=val:node.neighbours[0].neighbours[1]=val,node.neighbours[0]=val,val.parent!=this&&(val.parent=this,this.length++),val;var new_node=new Node({value:val});return this.insert_before(new_node,node)}insert_after(val,node){if(val instanceof Node)return val.neighbours=[node,node.neighbours[1]],null==node.neighbours[1]?this.last=val:node.neighbours[1].neighbours[0]=val,node.neighbours[1]=val,val.parent!=this&&(val.parent=this,this.length++),val;var new_node=new Node({value:val});return this.insert_after(new_node,node)}push(val){if(val instanceof Node)return null!=this.last?this.insert_after(val,this.last):(this.insert_beginning(val),val);var new_node=new Node({value:val});return this.push(new_node)}}Doubly_Linked_List.Node=Node,module.exports=Doubly_Linked_List},{}],92:[function(require,module,exports){(function(Buffer){if("undefined"==typeof window)var Stream=require("stream");var each=(collection,fn,context)=>{if(collection){if("collection"==collection.__type)return collection.each(fn,context);var ctu=!0,stop=function(){ctu=!1};if(is_array(collection)){for(var res_item,res=[],c=0,l=collection.length;c<l&&0!=ctu;c++)res_item=context?fn.call(context,collection[c],c,stop):fn(collection[c],c,stop),res.push(res_item);return res}var name,res={};for(name in collection){if(0==ctu)break;res[name]=context?fn.call(context,collection[name],name,stop):fn(collection[name],name,stop)}return res}},jq_class2type={},is_array=(obj=>{if(null==obj)return String(obj);var s=Object.prototype.toString.call(obj);return jq_class2type[s]||"object"},Array.isArray),is_dom_node=function(obj){return!!obj&&void 0!==obj.nodeType&&void 0!==obj.childNodes},get_truth_map_from_arr=function(arr){var res={};return each(arr,function(v,i){res[v]=!0}),res},get_map_from_arr=function(arr){for(var res={},c=0,l=arr.length;c<l;c++)res[arr[c]]=c;return res},arr_like_to_arr=function(arr_like){for(var res=new Array(arr_like.length),c=0,l=arr_like.length;c<l;c++)res[c]=arr_like[c];return res},is_ctrl=function(obj){return void 0!==obj&&null!=obj&&is_defined(obj.__type_name)&&is_defined(obj.content)&&is_defined(obj.dom)},tof=(obj,t1)=>{var res=t1||typeof obj;if("number"===res||"string"===res||"function"===res||"boolean"===res)return res;if("object"===res)return void 0!==obj?null===obj?"null":obj.__type?obj.__type:is_ctrl(obj)?"control":obj instanceof Date?"date":is_array(obj)?"array":(obj instanceof RegExp&&(res="regex"),"undefined"==typeof window&&(obj instanceof Buffer&&(res="buffer"),obj instanceof Stream.Readable&&(res="readable_stream"),obj instanceof Stream.Writable&&(res="writable_stream")),res):"undefined";return res},atof=arr=>{var res=new Array(arr.length);for(var c=0,l=arr.length;c<l;c++)res[c]=tof(arr[c]);return res},is_defined=value=>void 0!==value,stringify=JSON.stringify,get_a_sig=a=>{var c=0,l=a.length;var res="[";var first=!0;for(c=0;c<l;c++)first?first=!1:res+=",",res+=get_item_sig(a[c]);res+="]";return res},get_item_sig=(i,arr_depth)=>{var res;var t1=typeof i;if("string"===t1)res="s";else if("number"===t1)res="n";else if("boolean"===t1)res="b";else if("function"===t1)res="f";else{var t=tof(i,t1);if("array"===t)if(arr_depth){res="[";for(var c=0,l=i.length;c<l;c++)c>0&&(res+=","),res+=get_item_sig(i[c],arr_depth-1);res+="]"}else res="a";else if("control"===t)res="c";else if("date"===t)res="d";else if("regex"===t)res="r";else if("buffer"===t)res="B";else if("readable_stream"===t)res="R";else if("writable_stream"===t)res="W";else if("object"===t)res="o";else if("undefined"===t)res="u";else{if("collection_index"==t)return"X";if("data_object"===t)res=i._abstract?"~D":"D";else if("data_value"===t)res=i._abstract?"~V":"V";else if("null"===t)res="!";else if("collection"===t)res=i._abstract?"~C":"C";else{if("data_grid"!==t)throw"Unexpected object type "+t;res=i._abstract?"~G":"G"}}}return res},trim_sig_brackets=function(sig){if("string"===tof(sig))return"["==sig.charAt(0)&&"]"==sig.charAt(sig.length-1)?sig.substring(1,sig.length-1):sig},arr_trim_undefined=function(arr_like){for(var v,res=[],last_defined=-1,c=0,l=arr_like.length;c<l;c++)v=arr_like[c],"undefined"==tof(v)||(last_defined=c);for(var c=0,l=arr_like.length;c<l;c++)c<=last_defined&&res.push(arr_like[c]);return res},functional_polymorphism=function(options,fn){var a0=arguments;1===a0.length&&(fn=a0[0]);var arr,sig,a2,l,a,arr_slice=Array.prototype.slice;return function(){return a=arguments,l=a.length,1===l?(sig=get_item_sig([a[0]],1),a2=[a[0]],a2.l=1,fn.call(this,a2,sig)):l>1?(arr=arr_trim_undefined(arr_slice.call(a,0)),sig=get_item_sig(arr,1),arr.l=arr.length,fn.call(this,arr,sig)):0===a.length?(arr=new Array(0),arr.l=0,fn.call(this,arr,"[]")):void 0}},fp=functional_polymorphism,arrayify=fp(function(a,sig){var param_index,fn,num_parallel=1,delay=0,process_as_fn=function(){res=function(){var a=arr_like_to_arr(arguments),ts=atof(a),t=this,last_arg=a[a.length-1];if("function"!=tof(last_arg)){if(void 0!==param_index&&"array"==ts[param_index]){for(var res=[],c=0,l=a[param_index].length;c<l;c++){a[param_index]=arguments[param_index][c];var result=fn.apply(t,a);res.push(result)}return res}return fn.apply(t,a)}if(void 0===param_index||"array"!=ts[param_index])return fn.apply(t,a);var res=[],fns=[];each(a[param_index],function(v,i){var new_params=a.slice(0,a.length-1);new_params[param_index]=v,fns.push([t,fn,new_params])}),call_multiple_callback_functions(fns,num_parallel,delay,function(err,res){if(err)throw err;var a=[];a=a.concat.apply(a,res),last_arg(null,a)})}};if("[o]"==sig){var res=[];each(a[0],function(v,i){res.push([v,i])})}else"[f]"==sig?(param_index=0,fn=a[0],process_as_fn()):"[n,f]"==sig?(param_index=a[0],fn=a[1],process_as_fn()):"[n,n,f]"==sig?(param_index=a[0],num_parallel=a[1],fn=a[2],process_as_fn()):"[n,n,n,f]"==sig&&(param_index=a[0],num_parallel=a[1],delay=a[2],fn=a[3],process_as_fn());return res}),mapify=target=>{var tt=tof(target);if("function"==tt)return res=fp(function(a,sig){var that=this;if("[o]"==sig){map=a[0];each(map,function(v,i){target.call(that,v,i)})}else if("[o,f]"==sig){var map=a[0],callback=a[1],fns=[];each(map,function(v,i){fns.push([target,[v,i]])}),call_multi(fns,function(err_multi,res_multi){err_multi?callback(err_multi):callback(null,res_multi)})}else a.length>=2&&target.apply(this,a)});if("array"==tt){var res={};if(1==arguments.length)is_arr_of_strs(target)?each(target,function(v,i){res[v]=!0}):each(target,function(v,i){res[v[0]]=v[1]});else{var by_property_name=arguments[1];each(target,function(v,i){res[v[by_property_name]]=v})}return res}},clone=fp((a,sig)=>{var obj=a[0];if(1==a.l){var t=tof(obj);if("array"==t){res=[];return each(obj,function(v){res.push(clone(v))}),res}return"undefined"==t?void 0:"string"==t?obj:"number"==t?obj:"function"==t?obj:"boolean"==t?obj:"null"==t?obj:Object.assign({},obj)}if(2==a.l&&"number"==tof(a[1])){for(var res=[],c=0;c<a[1];c++)res.push(clone(obj));return res}}),are_equal=require("deep-equal"),set_vals=function(obj,map){each(map,function(v,i){obj[i]=v})},ll_set=function(obj,prop_name,prop_value){for(var s,arr=prop_name.split("."),c=0,l=arr.length,i=obj._||obj;c<l;)void 0===i[s=arr[c]]?i[s]=c-l==-1?prop_value:{}:c-l==-1&&(i[s]=prop_value),i=i[s],c++;return prop_value},ll_get=function(a0,a1){if(a0&&a1){var i=a0._||a0;if("."==a1)return void 0===i["."]?void 0:i["."];for(var s,arr=a1.split("."),c=0,l=arr.length;c<l;){if(s=arr[c],void 0===i[s]){if(c-l!=-1)throw"object "+s+" not found"}else if(c-l==-1)return i[s];i=i[s],c++}}},truth=function(value){return!0===value},iterate_ancestor_classes=function(obj,callback){var ctu=!0;callback(obj,function(){ctu=!1}),obj._superclass&&ctu&&iterate_ancestor_classes(obj._superclass,callback)},is_arr_of_t=function(obj,type_name){var tv;if("array"==tof(obj)){var res=!0;return each(obj,function(v,i){(tv=tof(v))!=type_name&&(res=!1)}),res}return!1},is_arr_of_arrs=function(obj){return is_arr_of_t(obj,"array")},is_arr_of_strs=function(obj){return is_arr_of_t(obj,"string")},input_processors={},output_processors={},call_multiple_callback_functions=fp(function(a,sig){var arr_functions_params_pairs,callback,delay,return_params=!1,num_parallel=1;2==a.l&&(arr_functions_params_pairs=a[0],callback=a[1]),3==a.l&&("[a,n,f]"==sig&&(arr_functions_params_pairs=a[0],num_parallel=a[1],callback=a[2]),"[n,a,f]"==sig&&(arr_functions_params_pairs=a[1],num_parallel=a[0],callback=a[2]),"[a,f,b]"==sig&&(arr_functions_params_pairs=a[0],callback=a[1],return_params=a[2])),4==a.l&&("[a,n,n,f]"==sig&&(arr_functions_params_pairs=a[0],num_parallel=a[1],delay=a[2],callback=a[3]),"[n,n,a,f]"==sig&&(arr_functions_params_pairs=a[2],num_parallel=a[0],delay=a[1],callback=a[3]));var res=[],l=arr_functions_params_pairs.length,c=0,that=this,count_unfinished=l,num_currently_executing=0,process=function(delay){num_currently_executing++;var main=function(){var context,fn,params,fn_callback,pair=arr_functions_params_pairs[c];get_item_sig(pair);"function"==tof(pair)?(fn=pair,params=[]):pair&&(pair.length,2==pair.length&&("function"==tof(pair[1])?(context=pair[0],fn=pair[1],params=[]):(fn=pair[0],params=pair[1])),3==pair.length&&("function"===tof(pair[0])&&"array"===tof(pair[1])&&"function"===tof(pair[2])&&(fn=pair[0],params=pair[1],fn_callback=pair[2]),"function"===tof(pair[1])&&"array"===tof(pair[2])&&(context=pair[0],fn=pair[1],params=pair[2])),4==pair.length&&(context=pair[0],fn=pair[1],params=pair[2],fn_callback=pair[3]));var i=c;c++;var cb=function(err,res2){if(num_currently_executing--,count_unfinished--,err){(new Error).stack;callback(err)}else res[i]=return_params?[params,res2]:res2,fn_callback&&fn_callback(null,res2),c<l?num_currently_executing<num_parallel&&process(delay):count_unfinished<=0&&callback(null,res)},arr_to_call=params||[];arr_to_call.push(cb),fn&&(context?fn.apply(context,arr_to_call):fn.apply(that,arr_to_call))};arr_functions_params_pairs[c]&&(delay?setTimeout(main,delay):main())};if(arr_functions_params_pairs.length>0)for(;c<l&&num_currently_executing<num_parallel;)delay?process(delay*c):process()}),call_multi=call_multiple_callback_functions,jsgui={each:each,is_array:is_array,is_dom_node:is_dom_node,is_ctrl:is_ctrl,clone:clone,get_truth_map_from_arr:get_truth_map_from_arr,arr_trim_undefined:arr_trim_undefined,get_map_from_arr:get_map_from_arr,arr_like_to_arr:arr_like_to_arr,tof:tof,atof:atof,is_defined:is_defined,stringify:stringify,functional_polymorphism:functional_polymorphism,fp:fp,arrayify:arrayify,mapify:mapify,str_arr_mapify:function(fn){var res=fp(function(a,sig){if(1==a.l){if("[s]"==sig){var s_pn=a[0].split(" ");return s_pn.length>1?res.call(this,s_pn):fn.call(this,a[0])}if("array"==tof(a[0])){var res2={},that=this;return each(a[0],function(v,i){res2[v]=fn.call(that,v)}),res2}}});return res},are_equal:are_equal,get_a_sig:get_a_sig,get_item_sig:get_item_sig,set_vals:set_vals,truth:truth,trim_sig_brackets:trim_sig_brackets,ll_set:ll_set,ll_get:ll_get,iterate_ancestor_classes:iterate_ancestor_classes,is_arr_of_t:is_arr_of_t,is_arr_of_arrs:is_arr_of_arrs,is_arr_of_strs:is_arr_of_strs,input_processors:input_processors,output_processors:output_processors,call_multiple_callback_functions:call_multiple_callback_functions,call_multi:call_multi,multi:call_multi,native_constructor_tof:function(value){return value===String?"String":value===Number?"Number":value===Boolean?"Boolean":value===Array?"Array":value===Object?"Object":void 0},Fns:function(){var fns=[];return fns.go=function(parallel,delay,callback){var al=arguments.length;1==al&&call_multi(fns,parallel),2==al&&call_multi(parallel,fns,delay),3==al&&call_multi(parallel,delay,fns,callback)},fns},sig_match:function(sig1,sig2){var sig1_inner=sig1.substr(1,sig1.length-2),sig2_inner=sig2.substr(1,sig2.length-2);if(sig1_inner.indexOf("[")>-1||sig1_inner.indexOf("]")>-1||sig2_inner.indexOf("[")>-1||sig2_inner.indexOf("]")>-1)throw"sig_match only supports flat signatures.";var sig1_parts=sig1_inner.split(","),sig2_parts=sig2_inner.split(","),res=!0;if(sig1_parts.length==sig2_parts.length){for(var i1,c=0,l=sig1_parts.length;res&&c<l;)(i1=sig1_parts[c])===sig2_parts[c]||"?"!==i1&&(res=!1),c++;return res}return!1},remove_sig_from_arr_shell:function(sig){return"["==sig[0]&&"]"==sig[sig.length-1]?sig.substring(1,sig.length-1):sig}};jsgui.data_types_info=jsgui.data_types_info||{},module.exports=jsgui}).call(this,require("buffer").Buffer)},{buffer:3,"deep-equal":99,stream:25}],93:[function(require,module,exports){var jsgui=require("./essentials"),j=jsgui,tof=(j.Class,j.each,j.is_array,j.is_dom_node,j.is_ctrl,j.extend,j.get_truth_map_from_arr,j.get_map_from_arr,j.arr_like_to_arr,j.tof),get_item_sig=(j.is_defined,j.stringify,j.functional_polymorphism,j.fp,j.arrayify,j.mapify,j.are_equal,j.get_item_sig);j.set_vals,j.truth,j.trim_sig_brackets,j.ll_set,j.ll_get,j.input_processors,j.iterate_ancestor_classes,j.is_arr_of_arrs,j.is_arr_of_strs,j.is_arr_of_t,jsgui.clone;class Evented_Class{constructor(){this._bound_events={}}raise_event(){var a=Array.prototype.slice.call(arguments),sig=get_item_sig(a,1);a.l=a.length;var c,l,target=this;if("[s]"==sig){var target=this,event_name=a[0],bgh=this._bound_general_handler,be=this._bound_events,res=[];if(bgh)for(c=0,l=bgh.length;c<l;c++)res.push(bgh[c].call(target,event_name));if(be){bei=be[event_name];if("array"==tof(bei)){for(c=0,l=bei.length;c<l;c++)res.push(bei[c].call(target));return res}}}if("[s,a]"==sig){var be=this._bound_events,bgh=this._bound_general_handler,event_name=a[0],res=[];if(bgh)for(c=0,l=bgh.length;c<l;c++)res.push(bgh[c].call(target,event_name,a[1]));if(be){bei=be[event_name];if("array"===tof(bei))for(c=0,l=bei.length;c<l;c++)res.push(bei[c].call(target,a[1]))}}if("[s,o]"==sig){var be=this._bound_events,bgh=this._bound_general_handler,event_name=a[0];a[1].target||(a[1].target=target);res=[];if(bgh)for(c=0,l=bgh.length;c<l;c++)res.push(bgh[c].call(target,event_name,a[1]));if(be){bei=be[event_name];if("array"===tof(bei))for(c=0,l=bei.length;c<l;c++)res.push(bei[c].call(target,a[1]))}}else if(a.l>2){var additional_args=[],bgh_args=[event_name=a[0]];for(c=1,l=a.l;c<l;c++)additional_args.push(a[c]),bgh_args.push(a[c]);var be=this._bound_events,res=[];if(bgh=this._bound_general_handler)for(c=0,l=bgh.length;c<l;c++)res.push(bgh[c].apply(target,bgh_args));if(be){var bei=be[event_name];if("array"==tof(bei)){if(bei.length>0){for(c=0,l=bei.length;c<l;c++)bei[c]&&res.push(bei[c].apply(target,additional_args));return res}return res}}}return res}add_event_listener(){var a=Array.prototype.slice.call(arguments),sig=get_item_sig(a,1);if(a.l=a.length,"[f]"==sig&&(this._bound_general_handler=this._bound_general_handler||[],Array.isArray(this._bound_general_handler)&&this._bound_general_handler.push(a[0])),"[s,f]"==sig){var event_name=a[0],fn_listener=a[1];this._bound_events=this._bound_events||{},this._bound_events[event_name]||(this._bound_events[event_name]=[]);var bei=this._bound_events[event_name];Array.isArray(bei)&&bei.push(fn_listener)}}on(){return this.add_event_listener.apply(this,arguments)}remove_event_listener(event_name,fn_listener){if(this._bound_events){var bei=this._bound_events[event_name]||[];if(Array.isArray(bei)){for(var c=0,l=bei.length,found=!1;!found&&c<l;)bei[c]===fn_listener?found=!0:c++;found&&bei.splice(c,1)}}}off(){return this.remove_event_listener.apply(this,arguments)}one(event_name,fn_handler){var inner_handler=function(e){fn_handler.call(this,e),this.off(event_name,inner_handler)};this.on(event_name,inner_handler)}}var p=Evented_Class.prototype;p.raise=p.raise_event,p.trigger=p.raise_event,module.exports=Evented_Class},{"./essentials":92}],94:[function(require,module,exports){var jsgui=require("./essentials"),B_Plus_Tree=require("./b-plus-tree/b-plus-tree"),Collection=require("./collection"),Data_Object=require("./data-object"),Data_Value=require("./data-value"),Doubly_Linked_List=require("./doubly-linked-list"),Evented_Class=require("./evented-class"),Ordered_KVS=require("./ordered-kvs"),Ordered_String_List=require("./ordered-string-list"),Sorted_KVS=require("./sorted-kvs");require("./util");jsgui.B_Plus_Tree=B_Plus_Tree,jsgui.Collection=Collection,jsgui.Data_Object=Data_Object,jsgui.Data_Value=Data_Value,jsgui.Doubly_Linked_List=Doubly_Linked_List,jsgui.Evented_Class=Evented_Class,jsgui.Ordered_KVS=Ordered_KVS,jsgui.Ordered_String_List=Ordered_String_List,jsgui.Sorted_KVS=Sorted_KVS,module.exports=jsgui},{"./b-plus-tree/b-plus-tree":86,"./collection":88,"./data-object":89,"./data-value":90,"./doubly-linked-list":91,"./essentials":92,"./evented-class":93,"./ordered-kvs":95,"./ordered-string-list":96,"./sorted-kvs":97,"./util":98}],95:[function(require,module,exports){var Doubly_Linked_List=require("./doubly-linked-list");class Ordered_KVS{constructor(){this.dll=new Doubly_Linked_List,this.node_map={}}length(){return this.dll.length}put(key,value){return this.push(key,value)}get(key){var kvs_node=this.node_map[key];return kvs_node?kvs_node.value:void 0}push(key,value){var node=this.dll.push(value);node.key=key,this.node_map[key]=node}out(key){var node=this.node_map[key];delete this.node_map[key],this.dll.remove(node)}each(callback){this.dll.each_node(function(node,stop){callback(node.key,node.value,stop)})}values(){var res=[];return this.each(function(key,value){res.push(value)}),res}keys(){var res=[];return this.each(function(key,value){res.push(key)}),res}keys_and_values(){var res=[];return this.each(function(key,value){res.push([key,value])}),res}}module.exports=Ordered_KVS},{"./doubly-linked-list":91}],96:[function(require,module,exports){class Ordered_String_List{constructor(){var arr=[],dict_indexes={},reindex_dict_indexes=function(){dict_indexes={};for(var c=0,l=arr.length;c<l;c++)dict_indexes[arr[c]]=c};this.has=function(value){return void 0!==dict_indexes[value]},this.put=function(value){if(this.has(value));else{var index=arr.length;arr.push(value),dict_indexes[value]=index}},this.out=function(value){if(this.has(value)){var idx=dict_indexes[value];arr.splice(idx,1),delete dict_indexes[value];for(var c=idx,l=arr.length;c<l;c++){var i=arr[c];dict_indexes[i]--}}},this.toggle=function(value){this.has(value)?this.out(value):this.put(value)},this.move_value=function(value,index){if(this.has(value)&&dict_indexes[value]!=index){var old_index=dict_indexes[value];if(arr.splice(old_index,1),arr.splice(index,0,value),index<old_index){dict_indexes[arr[index]]=index;for(c=index+1;c<=old_index;c++)dict_indexes[arr[c]]++}else if(index>old_index){dict_indexes[arr[index]]=index;for(var c=old_index;c<index;c++)dict_indexes[arr[c]]--}}},this._index_scan=function(){for(var c=0,l=arr.length;c<l;c++)console.log("c "+c+" arr[c] "+arr[c]+" idx "+dict_indexes[arr[c]])},this.toString=function(){return arr.join(" ")},this.toString.stringify=!0,this.set=function(val){"string"==typeof val&&(arr=val.split(" "),reindex_dict_indexes())};var a=arguments;if(1==a.length){var spec=a[0];"string"==typeof spec&&this.set(spec)}}}module.exports=Ordered_String_List},{}],97:[function(require,module,exports){var mapify=require("./essentials").mapify,B_Plus_Tree=require("./b-plus-tree/b-plus-tree");class Sorted_KVS{constructor(spec){void 0!==(spec=spec||{}).unique_keys&&(this.unique_keys=spec.unique_keys),this.tree=B_Plus_Tree(12)}clear(){this.tree.clear()}out(key){this.tree.remove(key)}get(key){return this.tree.get_values_by_key(key)}has(key){return this.key_count(key)>0}get_cursor(){}keys(){return this.tree.keys()}keys_and_values(){return this.tree.keys_and_values()}key_count(key){return void 0!==key?this.tree.count(key):this.tree.count()}get_keys_by_prefix(prefix){return this.tree.get_keys_by_prefix(prefix)}each(callback){return this.tree.each(callback)}get_by_prefix(prefix){return this.tree.get_by_prefix(prefix)}}Sorted_KVS.prototype.put=mapify(function(key,value){this.tree.insert(key,value)}),module.exports=Sorted_KVS},{"./b-plus-tree/b-plus-tree":86,"./essentials":92}],98:[function(require,module,exports){var jsgui=require("./essentials"),Collection=require("./collection"),j=jsgui,each=j.each,tof=j.tof,atof=j.atof,fp=(j.is_defined,j.fp),arrayify=j.arrayify,mapify=j.mapify,get_item_sig=j.get_item_sig,vectorify=function(n_fn){var fn_res=fp(function(a,sig){if(a.l>2){for(var res=a[0],c=1,l=a.l;c<l;c++)res=fn_res(res,a[c]);return res}if("[n,n]"==sig)return n_fn(a[0],a[1]);var ats=atof(a);if("array"==ats[0]){if("number"==ats[1]){var res=[],n=a[1];return each(a[0],function(i,v){res.push(fn_res(v,n))}),res}if("array"==ats[1]){if(ats[0].length!=ats[1].length)throw"vector array lengths mismatch";var res=[],arr2=a[1];return each(a[0],function(i,v){res.push(fn_res(v,arr2[i]))}),res}}});return fn_res},n_subtract=function(n1,n2){return n1-n2},n_multiply=function(n1,n2){return n1*n2},n_divide=function(n1,n2){return n1/n2},v_add=vectorify(function(n1,n2){return n1+n2}),v_subtract=vectorify(n_subtract),v_multiply=vectorify(n_multiply),v_divide=vectorify(n_divide),vector_magnitude=function(vector){return Math.sqrt(Math.pow(vector[0],2)+Math.pow(vector[1],2))},distance_between_points=function(points){var offset=v_subtract(points[1],points[0]);return vector_magnitude(offset)},execute_on_each_simple=function(items,fn){var res=[],that=this;return each(items,function(i,v){res.push(fn.call(that,v))}),res},filter_map_by_regex=function(map,regex){var res={};return each(map,function(i,v){i.match(regex)&&(res[i]=v)}),res},npx=arrayify(function(value){var res,a=arguments,t=tof(a[0]);return"string"===t?res=a[0]:"number"===t&&(res=a[0]+"px"),res}),no_px=arrayify(fp(function(a,sig){var re=/px$/;return"[s]"==sig&&re.test(a[0])?parseInt(a[0]):a[0]})),arr_ltrb=["left","top","right","bottom"],str_arr_mapify=function(fn){var res=fp(function(a,sig){if(1==a.l){if("[s]"==sig){var s_pn=a[0].split(" ");return s_pn.length>1?res.call(this,s_pn):fn.call(this,a[0])}if("array"==tof(a[0])){var res2={},that=this;return each(a[0],function(i,v){res2[v]=fn.call(that,v)}),res2}}});return res},arr_hex_chars=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],dict_hex_to_bin={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15},str_hex_to_int=function(str_hex){for(var i=(str_hex=str_hex.toUpperCase()).length,res=0,exp=1;i--;)res+=dict_hex_to_bin[str_hex.charAt(i)]*exp,exp*=16;return res},byte_int_to_str_hex_2=function(byte_int){var a=Math.floor(byte_int/16),b=byte_int%16;return arr_hex_chars[a]+arr_hex_chars[b]},arr_rgb_to_str_hex_6=function(arr_rgb){return byte_int_to_str_hex_2(arr_rgb[0])+byte_int_to_str_hex_2(arr_rgb[1])+byte_int_to_str_hex_2(arr_rgb[2])},arr_rgb_to_css_hex_6=function(arr_rgb){return"#"+arr_rgb_to_str_hex_6(arr_rgb)},input_processors={},validators={number:function(value){return"number"==tof(value)}},fp=(jsgui.extend,jsgui.fp),stringify=jsgui.stringify,tof=jsgui.tof,color_preprocessor_parser=fp(function(a,sig){if("[s]"==sig){var rx_hex=/(#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2}))/,m=a[0].match(rx_hex);if(m)return[jsgui.str_hex_to_int(m[2]),jsgui.str_hex_to_int(m[3]),jsgui.str_hex_to_int(m[4])]}});input_processors.optional_array=fp(function(a,sig){if(2==a.l){var oa_params=a[0],input=a[1];if("array"!=tof(input))return input;if(input.length<=oa_params.length)return input}if(3==a.l){var oa_params=a[0],items_data_type_name=a[1],input=a[2],input_processor_for_items=jsgui.input_processors[items_data_type_name];if("array"!=tof(input))return input_processor_for_items(input);if(input.length<=oa_params.length){var res=[];return each(input,function(i,v){res.push(input_processor_for_items(v))}),res}}}),input_processors.indexed_array=fp(function(a,sig){if(console.log("indexed_array sig",sig),2==a.l){var ia_params=a[0],input=a[1];if("array"==tof(input)&&input.length<=ia_params.length)return input}if(3==a.l){var ia_params=a[0],items_data_type_name=a[1],input=a[2],input_processor_for_items=jsgui.input_processors[items_data_type_name];if("array"==tof(input)&&input.length<=ia_params.length){var res=[];return each(input,function(i,v){res.push(input_processor_for_items(v))}),res}}}),input_processors.n_units=function(str_units,input){if("number"==tof(input))return[input,str_units];if("string"==tof(input)){var rx_n_units=/^(\d+)(\w+)$/,match=input.match(rx_n_units);if(match)return[parseInt(match[1]),match[2]];if(rx_n_units=/^(\d*\.\d+)(\w+)$/,match=input.match(rx_n_units))return[parseFloat(match[1]),match[2]]}};jsgui.data_types_info.color;input_processors.color=function(input){var res;console.log("processing color input: "+stringify(input));var input_sig=get_item_sig(input,2);return"[s]"==input_sig&&(res=color_preprocessor_parser(input[0])),"[n,n,n]"==input_sig&&(res=input),console.log("res "+stringify(res)),console.log("color input_processors output",res),res},jsgui.output_processors.color=function(jsgui_color){return jsgui.arr_rgb_to_css_hex_6(jsgui_color)};var group=function(){var a=arguments;if(1==a.length&&"array"==tof(a[0]))return group.apply(this,a[0]);for(var res,c=0,l=a.length;c<l;c++){var item=a[c];0==c&&(res=new Collection({context:item.context})),res.push(item)}var i,p=a[0].constructor.prototype;for(i in p)"function"==tof(p[i])&&function(i){"each"!=i&&"get"!=i&&"add_event_listener"!=i&&(res[i]=function(){var a=arguments;res.each(function(v,i2){v[i].apply(v,a)})})}(i);return res},util={vectorify:vectorify,v_add:v_add,v_subtract:v_subtract,v_multiply:v_multiply,v_divide:v_divide,vector_magnitude:vector_magnitude,distance_between_points:distance_between_points,execute_on_each_simple:execute_on_each_simple,mapify:mapify,filter_map_by_regex:filter_map_by_regex,atof:atof,npx:npx,no_px:no_px,str_arr_mapify:str_arr_mapify,arr_ltrb:arr_ltrb,true_vals:function(map){var res=[];for(var i in map)map[i]&&res.push(map[i]);return res},validators:validators,__data_id_method:"lazy",str_hex_to_int:str_hex_to_int,arr_rgb_to_css_hex_6:arr_rgb_to_css_hex_6,group:group};module.exports=util},{"./collection":88,"./essentials":92}],99:[function(require,module,exports){function isUndefinedOrNull(value){return null===value||void 0===value}function isBuffer(x){return!(!x||"object"!=typeof x||"number"!=typeof x.length)&&("function"==typeof x.copy&&"function"==typeof x.slice&&!(x.length>0&&"number"!=typeof x[0]))}function objEquiv(a,b,opts){var i,key;if(isUndefinedOrNull(a)||isUndefinedOrNull(b))return!1;if(a.prototype!==b.prototype)return!1;if(isArguments(a))return!!isArguments(b)&&(a=pSlice.call(a),b=pSlice.call(b),deepEqual(a,b,opts));if(isBuffer(a)){if(!isBuffer(b))return!1;if(a.length!==b.length)return!1;for(i=0;i<a.length;i++)if(a[i]!==b[i])return!1;return!0}try{var ka=objectKeys(a),kb=objectKeys(b)}catch(e){return!1}if(ka.length!=kb.length)return!1;for(ka.sort(),kb.sort(),i=ka.length-1;i>=0;i--)if(ka[i]!=kb[i])return!1;for(i=ka.length-1;i>=0;i--)if(key=ka[i],!deepEqual(a[key],b[key],opts))return!1;return typeof a==typeof b}var pSlice=Array.prototype.slice,objectKeys=require("./lib/keys.js"),isArguments=require("./lib/is_arguments.js"),deepEqual=module.exports=function(actual,expected,opts){return opts||(opts={}),actual===expected||(actual instanceof Date&&expected instanceof Date?actual.getTime()===expected.getTime():!actual||!expected||"object"!=typeof actual&&"object"!=typeof expected?opts.strict?actual===expected:actual==expected:objEquiv(actual,expected,opts))}},{"./lib/is_arguments.js":100,"./lib/keys.js":101}],100:[function(require,module,exports){function supported(object){return"[object Arguments]"==Object.prototype.toString.call(object)}function unsupported(object){return object&&"object"==typeof object&&"number"==typeof object.length&&Object.prototype.hasOwnProperty.call(object,"callee")&&!Object.prototype.propertyIsEnumerable.call(object,"callee")||!1}var supportsArgumentsClass="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();(exports=module.exports=supportsArgumentsClass?supported:unsupported).supported=supported,exports.unsupported=unsupported},{}],101:[function(require,module,exports){function shim(obj){var keys=[];for(var key in obj)keys.push(key);return keys}(module.exports="function"==typeof Object.keys?Object.keys:shim).shim=shim},{}],102:[function(require,module,exports){var jsgui=require("../lang/lang"),each=(jsgui.stringify,jsgui.each),tof=(jsgui.arrayify,jsgui.tof),get_a_sig=jsgui.get_a_sig,Evented_Class=(jsgui.filter_map_by_regex,jsgui.Evented_Class),Collection=(jsgui.Data_Object,jsgui.fp,jsgui.is_defined,jsgui.Collection);class Resource_Pool extends Evented_Class{constructor(spec){super(spec),this.resources=new Collection({fn_index:item=>{var key=item.name;return key}})}_get_resources_by_interface(i_name){var res=[];return this.resources.each(function(i,resource){console.log("resource "+resource);var i=resource.get("interface");if("string"==tof(i))i==i_name&&res.push(resource);else if("array"==tof(i)){var done=!0;each(i,function(i2,v){done||(i==i_name&&res.push(resource),done=!0)})}}),res.length>1?res:res[0]}index_resource(obj){}receive_resource_event(){var a=arguments;a.l=arguments.length;var sig=get_a_sig(a,1);if("[D,s,[s,s]]"==sig)a[0];if("[D,s]"==sig)a[0],a[1]}add(obj){var obj_name=obj.name;if(console.log("** obj_name "+obj_name),this.has_resource(obj_name))throw"Resource pool already has resource with name "+obj_name;this.resources.add(obj),obj.pool=this,this.raise_event("added",obj)}push(obj){return this.add(obj)}has_resource(){var a=arguments;if(a.l=arguments.length,"[s]"==get_a_sig(a,1)){var obj_lookup_val=a[0];return this.resources.has(obj_lookup_val)}}get_resource_names(){var res=[];return each(this.resources,resource=>{res.push(resource.name)}),res}get_resource(){var a=arguments;if(a.l=arguments.length,"[s]"==get_a_sig(a,1)){var obj_lookup_val=a[0],find_result=this.resources.find(obj_lookup_val);if(find_result)var res=find_result;return res}}count(){return this.resources.length}start(callback){var arr_resources_meeting_requirements=[];this.resources.each(function(v,i){v.meets_requirements()&&arr_resources_meeting_requirements.push(v)});var l_resources=this.resources.length();if(arr_resources_meeting_requirements.length==l_resources){var num_to_start=arr_resources_meeting_requirements.length,num_starting=0,num_started=0,cb=function(err,start_res){num_starting--,++num_started==num_to_start&&callback&&callback(null,!0)};each(arr_resources_meeting_requirements,function(resource_ready_to_start){resource_ready_to_start.start(cb),num_starting++})}}}module.exports=Resource_Pool},{"../lang/lang":94}]},{},[80]);